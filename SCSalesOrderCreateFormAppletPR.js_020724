if (typeof(SiebelAppFacade.SCSalesOrderCreateFormAppletPR) === "undefined") {

 SiebelJS.Namespace("SiebelAppFacade.SCSalesOrderCreateFormAppletPR");
 define("siebel/custom/SelectComfort/SCSalesOrderCreateFormAppletPR", ["siebel/phyrenderer", "siebel/custom/SelectComfort/bootstrap.min.js", "siebel/custom/SelectComfort/jquery.validate.min","siebel/custom/SelectComfort/SCSalesOrderMarkup","siebel/custom/SelectComfort/SC_OUI_Methods","siebel/custom/SelectComfort/SC_OUI_Markups","siebel/custom/SelectComfort/SCOrderShipToLineItemMarkup","siebel/custom/SelectComfort/SCErrorCodes"],
  function () {
   SiebelAppFacade.SCSalesOrderCreateFormAppletPR = (function () {
   
		var pm="",Appletid="",RecordSet="",mainmarkup="",markup="",headermarkup="",storechangemarkup,Lov,AccountOrder=false,a="",b="",billAddList="";
		var selectstoreid="",c="",StoreLocation,LoginId,storeNumber,BService,billToContactRecordSet,responsibilityadmin,humancapitalresp,taxExeChange='N',Reason="";
		var InPut = SiebelApp.S_App.NewPropertySet();
		var OutPut = SiebelApp.S_App.NewPropertySet();
		var SiebelConstant = SiebelJS.Dependency("SiebelApp.Constants");
		var SCSalesCreateMarkup = SiebelJS.Dependency("SiebelApp.SCSalesOrderMarkup");
		var SC_OUI_Markups = SiebelJS.Dependency("SiebelApp.SC_OUI_Markups");
		var SC_OUI_Methods = SiebelJS.Dependency("SiebelApp.SC_OUI_Methods");
		 var SCErrorCodes = SiebelJS.Dependency("SiebelApp.SCErrorCodes");
		var SCOrderShipMarkup = SiebelJS.Dependency("SiebelAppFacade.SCOrderShipToLineItemMarkup");
		var SCProducts = SiebelJS.Dependency("SiebelAppFacade.SCProductsPR");
		var parentJSON={};
		var parentAddrJSON={};
		var OrderId="",conId="",OrderDate,fvalue="",revision;
		var isCouponApplied="Y";

    function SCSalesOrderCreateFormAppletPR(pm) {
     SiebelAppFacade.SCSalesOrderCreateFormAppletPR.superclass.constructor.apply(this, arguments);
    }

    SiebelJS.Extend(SCSalesOrderCreateFormAppletPR, SiebelAppFacade.PhysicalRenderer);

    SCSalesOrderCreateFormAppletPR.prototype.Init = function () {
		SiebelAppFacade.SCSalesOrderCreateFormAppletPR.superclass.Init.apply(this, arguments);
		pm = this.GetPM();
		$('#_sweview').hide();
		SiebelJS.Log("In SalesOrder PR init");
		revision=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Revision");
		if(revision>1)
			localStorage.setItem("comingfrom","revise");
		else
		   localStorage.setItem("comingfrom","");
		   localStorage.setItem("flowfrom","");
		//storeNumber = SiebelApp.S_App.GetProfileAttr("SC Store Number");
		//LoginId = SiebelApp.S_App.GetProfileAttr("Login Name");
		storeNumber = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Store Number");
		LoginId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Login Name");
		$('#CommunicationPanelContainer').css("padding-top","77px");
    }

    SCSalesOrderCreateFormAppletPR.prototype.ShowUI = function () {
     SiebelAppFacade.SCSalesOrderCreateFormAppletPR.superclass.ShowUI.apply(this, arguments);
		//SHARATH added below code for terminal popup.
		setTimeout(function(){
			var poleDisplayFlg = SiebelApp.S_App.GetProfileAttr('PoleDisplayOUI');
			var fitFlag = SiebelApp.S_App.GetProfileAttr('FeatureFlag');
			var resumeOrderflag = SiebelApp.S_App.GetProfileAttr('ResumeOrder');
			
			if(fitFlag == "Y" && poleDisplayFlg == "Y" && resumeOrderflag != "Y")
			SC_OUI_Methods.SCnGetDisplayTerminals();
		
			if(resumeOrderflag == "Y")
			SC_OUI_Methods.SCnGetDisplayTerminals();
			
			var isTerminalPresent = $('#SC-terminal-tile').css('display');
			var terminalValue = SiebelApp.S_App.GetProfileAttr('TerminalSelected');
			if(isTerminalPresent == "none" && terminalValue != ""){
				$('#SC-terminal-tile span').text(terminalValue);
				$('#SC-terminal-tile').css('display','');
			}
			
		}, 5);
		
		$('#_sweview').show();
		//hiding tool tip.
		$('div[title="Line Items"]').attr("title","");
		
		
		
		//a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Employee List Applet"].GetPModel().Get("GetFullId");
		//$("#"+a).append(mainmarkup);
		//$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Management Products"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Category List Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Order Item List Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Order List Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Payments List Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Report Output List Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Contact Shipping List OUI"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["Order Entry - Attachment Applet"].GetPModel().Get("GetFullId");
		$("#"+a).hide();
        a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC LOY Member List Applet"].GetPModel().Get("GetFullId");		
		$("#"+a).hide();
		a=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Account Contact Shipping List OUI"].GetPModel().Get("GetFullId");		
		$("#"+a).hide();		
		
		
		 var sccreateorderSrchSpec = [],
             sccreateorderSortSpec = [];
		  sccreateorderSrchSpec[0] = "[Type]= 'SC_SUB_TYPE' and [Active] = 'Y' and [Parent]='Sales Order'";
          sccreateorderSortSpec[0] = "Order By";
		  sccreateorderSrchSpec[1] = "[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y'";
          sccreateorderSortSpec[1] = "Order By";
		  sccreateorderSrchSpec[2] = "[Type]= 'SAP_SO_HEADER_DELIV_BLOCK' and [Active] = 'Y'";
          sccreateorderSortSpec[2] = "Order By";
		  sccreateorderSrchSpec[3] = "[Type]= 'SC_CUSTOMER_CATEGORY' and [Active] = 'Y' and [Name]='Insider'";
          sccreateorderSortSpec[3] = "Order By";
		  sccreateorderSrchSpec[4] = "[Type]= 'SC_MANUAL_DISCOUNT_REASON' and [Active] = 'Y'";
          sccreateorderSortSpec[4] = "Order By";
		  sccreateorderSrchSpec[5] = "[Type]= 'DISCNT_PERCENT' and [Active] = 'Y'";
          sccreateorderSortSpec[5] = "Order By";
		  sccreateorderSrchSpec[6] = "[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y' and [Name]='In Progress'";
          sccreateorderSortSpec[6] = "";
		  sccreateorderSrchSpec[7] = "[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y' and [Name]='Siebel Error'";
          sccreateorderSortSpec[7] = "";
		  sccreateorderSrchSpec[8]="[Type]= 'DIVISION_TYPE' and [Active] = 'Y' and [Name]='DIRECT'";
		  sccreateorderSortSpec[8]="Order By";
		  sccreateorderSrchSpec[9]="[Type]= 'DIVISION_TYPE' and [Active] = 'Y' and [Name]='ECOM'";
		  sccreateorderSortSpec[9]="Order By";
		  sccreateorderSrchSpec[10]="[Type]= 'PROD_CD' and [Active] = 'Y' and [Name]='Promotion'";
	      sccreateorderSortSpec[10]="Order By";
		  sccreateorderSrchSpec[11]="[Type]= 'SC_DISA_ENABLE_FLAG' and [Active] = 'Y' and [Name]='Enable Disa Flag'";
		  sccreateorderSortSpec[11]="Order By";
		  sccreateorderSrchSpec[12]="[Active]='Y' AND [Type]='CANCEL_REASON_TYPE'";
		  sccreateorderSortSpec[12]="";
		  
		 
		//var firstTime="";
		//firstTime=SiebelApp.S_App.GetProfileAttr("LoginFirstTimeOUI");
		//if(firstTime=="Y"){
			//SC_OUI_Methods.SCSetOrderLoVs(sccreateorderSrchSpec, sccreateorderSortSpec);
			//SC_OUI_Methods.SCGetProfileAttr("SC Primary Division Type,SC Store Number,MachineInfo,SC Store User,LoginFirstTimeOUI,DISALocFound,PoleDisplayOUI,SC Store Name OUI");
		//}
		Appletid=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().Get("GetFullId");
	 	mainmarkup=SCSalesCreateMarkup.SalesOrderCreateMarkup();
		$('#s_'+Appletid+'_div').hide();
		$('#'+Appletid).append(mainmarkup);
		SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
		RecordSet=pm.Get("GetRecordSet");
		var divsubtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Sub Type');
		headermarkup=SC_OUI_Markups.SalesOrderCreateHeader_block(RecordSet,divsubtype);
		$('.nav-header').html(headermarkup);
		storechangemarkup=SC_OUI_Markups.StoreChange();
		$('#SC-add-storelocation').html(storechangemarkup);
		//Adding CustomerMarkup 
		customtimermarkup=SC_OUI_Markups.CustomTimer();
		$('#applet1').append(customtimermarkup);
		
		$("#SC_Order_ship_markup").hide();
		$("#SC_Order_ship_markup1").hide();
		$("#SC_Order_ship_markup2").hide();
		$("#footerbutton").hide();
		SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
		RecordSet=pm.Get("GetRecordSet");
		
		Contact_Id=RecordSet[0]["Bill To Contact Id"];
		Account_Id=RecordSet[0]["Bill To Account Id"];
		responsibilityadmin=RecordSet[0]["SC Admin Responsibility"];
		humancapitalresp=RecordSet[0]["SC Human Capital OIC Resp"];
		
		
		//NGOLLA defect#756
		var in_progress_value = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y' and [Name]='In Progress'");
		var siebel_error_value = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y' and [Name]='Siebel Error'");
	
		if(RecordSet[0]["SC Sub-Type"]=="Wholesale"||RecordSet[0]["SC Sub-Type"]=="Commercial" || RecordSet[0]["SC Sub-Type"]=="QVC"|| RecordSet[0]["SC Sub-Type"]=="Internal" || RecordSet[0]["SC Sub-Type"]=="HSN"){
		  $("#ponumber").addClass("SC_WholeSale_edit");
          $("#shiptoaccount").addClass("SC_WholeSale_edit");		  
			
		}
		//based on subtype value order is determined if it is account order or contact order
		if(RecordSet[0]["SC Sub-Type"]=="Wholesale"||RecordSet[0]["SC Sub-Type"]=="QVC"||RecordSet[0]["SC Sub-Type"]=="Commercial" || RecordSet[0]["SC Sub-Type"] == "Internal" || RecordSet[0]["SC Sub-Type"] == "HSN"){
		//if(RecordSet[0]["Bill To Account Id"]!=null&&RecordSet[0]["Bill To Account Id"]!=""){
			AccountOrder=true;
			document.getElementById("viewcontact").innerHTML="View Account";
			if(RecordSet[0]["SC Store User"]=="Y")
				$("#sc-cr-view-account").hide();
		}
		else
			AccountOrder=false;
		//NGOLLA Defect #710
		if(AccountOrder){
			$("#SC_OM_USE").text('Comments');
			
		}
		if((RecordSet[0]["Status"]=="In Progress"&&RecordSet[0]["Payment Record Count"]==0&&localStorage.getItem('comingfrom')!='revise'))
			document.getElementById("deleteordermark").style.display = "block";
		else
			document.getElementById("deleteordermark").style.display = "none";
		//SNARRA 26-07-2018 Added for performance POC
		if(localStorage.getItem('isNewSalesOrder')!="Y"){
		//sandeep
		  var cancelorder = SCSalesCreateMarkup.CancelOrderPopup();
		  $("#SC-SO-Cancel-order").html(cancelorder);
		  var refundmarkup = SCSalesCreateMarkup.GetRefundDetails();
		  $("#SC-refund-popup").html(refundmarkup);
		//sandeep
		}
		//SNARRA Added code for CTItoolbar Issue
		if($("#CommunicationPanelContainer").is(":visible")){
				    $("#sc-orange").show();
			   }
		markup="";
		markup+='						<div class="SC-SO-panel-head">';
		markup+='                            <div class="SC-SO-panel-title">';
		if(localStorage.getItem('comingfrom')=="revise")
			markup+='                                <button data-toggle="collapse" data-target="#sales-info" id="expand-collapse" class="sc-icon iconClosed" aria-expanded="true"></button>';
		else
			markup+='                                <button data-toggle="collapse" data-target="#sales-info" id="expand-collapse" class="sc-icon iconOpen OrderDetailsclose" aria-expanded="false"></button>';
		markup+='                                 <div class="SC-title-button">';
		markup+='                                     <p class="no-margin">Order Details</p>';
		markup+='                                 </div>';
		markup+='                            </div>';
		markup+='                            <div class="SC-SO-details-items" id="sales-header" style="display: none">';
		markup+='                                <div class="SC-SO-detail-item">';
		markup+='                                    <label class="item-label">Order Date:</label>';
		markup+='                                    <label class="item-value overflow" title="'+RecordSet[0]["Order Date"]+'" id="corderdate">'+RecordSet[0]["Order Date"]+'</label>';
		markup+='                                </div>';
		markup+='                                <div class="SC-SO-detail-item">';
		markup+='                                    <label class="item-label">Subtype:</label>';
		markup+='                                    <label class="item-value" id="csubtype" >'+RecordSet[0]["SC Sub-Type"]+'</label>';
		markup+='                                </div>';
		markup+='                                <div class="SC-SO-detail-item">';
		markup+='                                    <label class="item-label">Status:</label>';
		markup+='                                    <label class="item-value pending" id="cstatus">'+RecordSet[0]["Status"]+'</label>';
		markup+='                                </div>';
		markup+='                                <div class="SC-SO-detail-item">';
		markup+='                                    <label class="item-label">Sales Order Team:</label>';
		markup+='                                    <label class="item-value" id="csalesteam">'+RecordSet[0]["SC Sales Team Login"]+'</label>';
		markup+='                                </div>';
		markup+='                                <div class="SC-SO-detail-item">';
		markup+='                                    <label class="item-label">Sub-Channel:</label>';
		markup+='                                    <label class="item-value" id="csubchan">'+RecordSet[0]["SC Location Sub-Channel"]+'</label>';
		markup+='                                </div>';
		markup+='                                <div class="SC-SO-detail-item">';
		markup+='                                    <label class="item-label">Sale Location:</label>';
		markup+='                                    <label class="item-value overflow" title="'+RecordSet[0]["SC Sale Location"]+'" id="clocation">'+RecordSet[0]["SC Sale Location"]+'</label>';
		markup+='                                </div>';
		markup+='                            </div>';
		markup+='                            <div class="edit-details cancel-title-head">';
		//edit details or Cancel order button
		markup+='              				</div>';
		markup+='                            <div class="save-details" id="SC-SO-save-block"  style="display:none">';
		markup+='                                <div class="save-edit-icon save" id="SC-SO-sales-save-changes">';
		markup+='                                    <img  src="images/custom/done_mini.png" />';
		markup+='                                </div>';
		markup+='                                <div class="save-edit-icon cancel" id="SC-SO-sales-cancel-changes">';
		markup+='                                    <img src="images/custom/close_mini.png" />';
		markup+='                                </div>';
		markup+='                            </div>';
		markup+='                        </div>';
		if(localStorage.getItem('comingfrom')=="revise")
			markup+='                        <div class="SC-SO-panel-body collapse clearfix" id="sales-info">';
		else
			markup+='                        <div class="SC-SO-panel-body collapse in clearfix" id="sales-info">';
		 //markup+='                            <form id="sc-SalesOrder-Details">';
		markup+='                            <div class="row no-margin">';
		markup+='                                <div class="SC-SO-details-items">';
		//RCHATHAR: For defect number 710
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Source Order:</label>';
		//SCHERKU: For defect number 710
		if(RecordSet[0]["SC Admin Responsibility"]== "Y")
		markup+='                                        <input type="text" name="" class="SC-SO-input read-mode read-mode-admin overflow" id="SC-source-order" title="'+RecordSet[0]["SC Ext Order Number"]+'" value="'+RecordSet[0]["SC Ext Order Number"]+'">';
		else
		{
			if(RecordSet[0]["SC Ext Order Number"] == undefined)
				markup+='                                        <label class="item-value" id="SC-source-order">'+RecordSet[0]["SC Ext Order Number"]+'</label>';
			else
				markup+='                                        <label class="item-value" id="SC-source-order"></label>';		
		//markup+='                                        <input type="text" name="" class="SC-SO-input read-mode read-mode-admin overflow" id="SC-source-order" title="" value="">';	
		}
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">order date:</label>';
		OrderDate=RecordSet[0]["Order Date"];
		//SBOORLA:Added code for 710 defect
		if(RecordSet[0]["SC Admin Responsibility"]=="Y")
		markup+='                                        <input type="text" name="" class="SC-SO-input read-mode read-mode-admin overflow" id="SC-order-date" title="'+RecordSet[0]["Order Date"]+'" value="'+RecordSet[0]["Order Date"]+'">';
		else
		markup+='                                        <input type="text" name="" class="SC-SO-input SC-readonly-date" id="SC-order-date" title="'+RecordSet[0]["Order Date"]+'" value="'+RecordSet[0]["Order Date"]+'">';	
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">subtype:</label>';
		markup+='                                        <select class="SC-SO-input inherit read-mode" id="subtype">';
		Lov=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_SUB_TYPE' and [Active] = 'Y' and [Parent]='Sales Order'");
		markup+='                                            <option class="SC-SO-Option" selected></option>';
		for(var i=0;i<Lov.length;i++){
			if(Lov[i]==RecordSet[0]["SC Sub-Type"]){
					markup+='                                            <option class="SC-SO-Option" selected>'+Lov[i]+'</option>';
			}
			else{
				markup+='                                            <option class="SC-SO-Option">'+Lov[i]+'</option>';
			}
		}
		markup+='                                        </select>';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Bill To:</label>';
		if(AccountOrder==true)
			markup+='                                        <label class="item-value overflow" id="scbillToaccdrilldown" title="'+RecordSet[0]["Bill To Account"]+'">'+RecordSet[0]["Bill To Account"]+'</label>';
		else
			//SVEMURI : Modified Record SET to FIRST NAME /LAST NAME from LAST NAME/FIRST NAME.
			markup+='                                        <label class="item-value overflow" title="'+RecordSet[0]["Contact First Name"]+" "+RecordSet[0]["Contact Last Name"]+'">'+RecordSet[0]["Contact First Name"]+" "+RecordSet[0]["Contact Last Name"]+'</label>';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Status:</label>';
		//markup+='                                        <label class="item-value pending">'+RecordSet[0]["Status"]+'</label>';
		//NGOLLA defect No:710
		markup+='										<span class=" pending" title="'+RecordSet[0]["Status"]+'"></span>';		
		markup+='                                        <select class="SC-SO-input read-mode-revise overflow" style="pointer-events:none" id="orderstatus" >';
		Lov=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y'");
		markup+='                                            <option class="SC-SO-Option" selected></option>';
		for(var i=0;i<Lov.length;i++){
			if(Lov[i]==RecordSet[0]["Status"]){
				markup+='                                            <option class="SC-SO-Option" value="'+Lov[i]+'" selected>'+Lov[i]+'</option>';
			}
			else{
				markup+='                                            <option class="SC-SO-Option" value="'+Lov[i]+'">'+Lov[i]+'</option>';
			}
		}
		markup+='                                        </select>';
		
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Sales Order Team:</label>';
		markup+='                                        <label class="item-value read-mode-human read-mode-revise" title="'+RecordSet[0]["SC Sales Team Login"]+'">'+RecordSet[0]["SC Sales Team Login"]+'</label>';
		markup+='                                        <img src="images/custom/search-icon.png" class="location-search-icon bottom" id="SC-sales-team-icon" style="display:none">';
		//markup+='                                        <img src="images/custom/search-icon.png" class="location-search-icon bottom" id="SC-sales-team-icon">';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Customer #:</label>';
		markup+='                                        <label class="item-value">'+RecordSet[0]["SC Ship To Customer Number"]+'</label>';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Channel:</label>';
		markup+='                                        <label class="item-value" id="SC-order-channel">'+RecordSet[0]["SC Location Type"]+'</label>';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Sub-Channel:</label>';
		markup+='                                        <label class="item-value" id="SC-order-subchannel">'+RecordSet[0]["SC Location Sub-Channel"]+'</label>';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Store/Show#:</label>';
			markup+='                                        <input type="text" name="" value="'+RecordSet[0]["SC Location Store Number"]+'" class="SC-SO-input read-mode-revise" title="'+RecordSet[0]["Comments"]+'"" id="SC-store-number">';
		//markup+='                                        <label class="item-value read-mode-revise" id="SC-store-number">'+RecordSet[0]["SC Location Store Number"]+'</label>';
		markup+='                                    </div>';
		markup+='                                     <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label" >Bill To Address:</label>';
		if(AccountOrder==true){
			markup+='										<span title="'+RecordSet[0]["Primary Bill To Address"]+'" id="sc-billtoaddr-tittle">';		
			markup+='                                        <select class="SC-SO-input inherit read-mode overflow" title="'+RecordSet[0]["Primary Bill To Address"]+'" id="addressto">';
			markup+='                                        <option class="SC-SO-Option">'+RecordSet[0]["Primary Bill To Address"]+'</option></select>';
		}
		else{
			markup+='										<span title="'+RecordSet[0]["SC Con Bill To Address"]+'" id="sc-billtoaddr-tittle">';		
			markup+='                                        <select class="SC-SO-input inherit read-mode overflow" title="'+RecordSet[0]["SC Con Bill To Address"]+'" id="addressto">';
			markup+='                                        <option class="SC-SO-Option">'+RecordSet[0]["SC Con Bill To Address"]+'</option></select>';
		}
		markup+='										 </select>';
		markup+='										</span>';
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Sale Location:</label>';
		markup+='                                        <label class="item-value read-mode-admin overflow read-mode-revise" title="'+RecordSet[0]["SC Sale Location"]+'" id="sc-cahnge-loaction">'+RecordSet[0]["SC Sale Location"]+'</label>';
		markup+='                                        <img src="images/custom/search-icon.png" class="location-search-icon bottom" id="SC-sales-location-icon" style="display:none">';		
		markup+='                                    </div>';
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Cancellation Reason:</label>';
		markup+=' 										 <label class="item-value" id="sc-cancelreason">'+RecordSet[0]["Cancel Reason"]+'</label>';
		markup+='                                    </div>';
		if(AccountOrder==true){
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">Preferred Contact Method:</label>';
			markup+='                                        <input type="text" name="" class="SC-SO-input read-mode" id="prefconmethod">';
			markup+='                                    </div>';
		}
		markup+='                                     <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Hold Reason:</label>';
		markup+='										<span title="'+RecordSet[0]["Delivery Block"]+'"></span>';		
		markup+='                                        <select class="SC-SO-input read-mode overflow" id="holdreason" >';
		Lov=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SAP_SO_HEADER_DELIV_BLOCK' and [Active] = 'Y'");
		markup+='                                            <option class="SC-SO-Option" selected></option>';
		for(var i=0;i<Lov.length;i++){
			if(Lov[i]==RecordSet[0]["Delivery Block"]){
				markup+='                                            <option class="SC-SO-Option" selected>'+Lov[i]+'</option>';
			}
			else{
				markup+='                                            <option class="SC-SO-Option">'+Lov[i]+'</option>';
			}
		}
		markup+='                                        </select>';
		markup+='                                    </div>';
		if(AccountOrder==true){
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">PO Number:</label>';
			markup+='                                        <input type="text" name="" value="'+RecordSet[0]["SC Purchase Order Number"]+'" class="SC-SO-input read-mode read-mode-revise" id="ponumber">';
			markup+='                                    </div>';
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">Ship To Account:</label>';
			markup+='                                        <input type="text" name="" value="'+RecordSet[0]["Ship To Account Id"]+'" class="SC-SO-input" id="shiptoaccount">';
			markup+='                                    </div>';
		}
		else{
			markup+='                                      <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label" id="SC_OM_USE">OM Use only:</label>';
			markup+='                                        <input type="text" name="" value="'+RecordSet[0]["Comments"]+'" class="SC-SO-input read-mode overflow read-mode-revise" title="'+RecordSet[0]["Comments"]+'"" id="omuseronly">';
			markup+='                                    </div>';
			markup+='                                     <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">Referred By Insider:</label>';
			if(RecordSet[0]["SC Referred By"] ==""){
				markup+='                                       <input type="text" name="" value="'+RecordSet[0]["SC Referred By"]+'" class="SC-SO-input SC-readonly SC-applets" id="referreby">';
			markup+='                                    <img src="images/custom/search-icon.png" class="location-search-icon SC-disabled" id="SC-search-icon-referreby" style="display: none">';
			}else{
			markup+='                                        <input type="text" name="" value="'+RecordSet[0]["SC Referred By"]+'" class="SC-SO-input  sc-referredby" id="referreby">';
			markup+='                                    <img src="images/custom/search-icon.png" class="location-search-icon SC-disabled" id="SC-search-icon-referreby" style="display: none">';
			}
			markup+='                                    </div>';
		}
		markup+='                                    <div class="SC-SO-detail-item m-bottom">';		
		markup+='                                        <label class="item-label">Tax Exempt:</label>';		
		markup+='											<div class="attachment">';
        markup+='                                   			 <p class="SC-checkbox-white-square SC-readonly">';
        markup+='                                        			<input type="checkbox" name="" id="teoh"/>';
        markup+='                                       			<label for="teoh" class="SC-360-cusin"></label>';
        markup+='                                    		    </p>';
        markup+='                                    			<div id="clip-img" class="attachment_img" style="display:none;">';
        markup+='                                       			 <div class="attach_drop" id="list_item">';
        markup+='                                           			<img src="images/custom/attachment-clips.png">';
        markup+='                                            			<div class="arrow-down" id="SC-contact-arrow"></div>';
        markup+='                                       			</div>';
        markup+='                                       			<div class="list_option" id="SC-Attachment-list">';
        markup+='                                        	    	</div>';
        markup+='                                    			</div>';
        markup+='                                			</div>';		
		markup+='                                    </div>';
		//SBOORLA:Added markup for defect 738
		//if(parseInt(RecordSet[0]["Revision"])>1){
		markup+='                                      <div class="SC-SO-detail-item m-bottom">';
		markup+='                                        <label class="item-label">Revision:</label>';
		markup+='                                        <input type="text" name="" value="'+RecordSet[0]["Revision"]+'" class="SC-SO-input SC-readonly" title="'+RecordSet[0]["Revision"]+'"">';
		markup+='                                    </div>';
		//}
		//Ngolla for defect NO:#756
		if(RecordSet[0]["SC Sub-Type"]=="QVC"){
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">QVC Notification Status:</label>';
			if(RecordSet[0]["SC QVC Notification Status"]!=undefined)
			markup+='                                        <input type="text" name="" class="SC-SO-input" style="pointer-events:none" value="'+RecordSet[0]["SC QVC Notification Status"]+'">';
		    else
			markup+='                                        <input type="text" name="" class="SC-SO-input" style="pointer-events:none" value="">';	
			markup+='                                    </div>';
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">Sold To First Name:</label>';
			if(RecordSet[0]["SC Pay To First Name"]!=undefined)
			markup+='                                        <input type="text" name="" class="SC-SO-input" style="pointer-events:none" id="SC-Sold-First-name" value="'+RecordSet[0]["SC Pay To First Name"]+'">';
		    else
			markup+='                                        <input type="text" name="" class="SC-SO-input" style="pointer-events:none" id="SC-Sold-First-name" value="">';
			markup+='                                    </div>';
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">Sold To Last Name:</label>';
			if(RecordSet[0]["SC Pay To Last Name"]!=undefined)
			markup+='                                        <input type="text" name="" class="SC-SO-input SC_QVC_edit" style="pointer-events:none" id="SC-Sold-last-name" value="'+RecordSet[0]["SC Pay To Last Name"]+'">';
		    else
				markup+='                                        <input type="text" name="" class="SC-SO-input SC_QVC_edit" style="pointer-events:none" id="SC-Sold-last-name" value="">';
		    markup+='                                    <img src="images/custom/search-icon.png" class="location-search-icon" style="display:none" id="SC-last-name-pickApplet" >';
	        markup+='                                    </div>';
			markup+='                                    <div class="SC-SO-detail-item m-bottom">';
			markup+='                                        <label class="item-label">Sold To Address:</label>';
			if(RecordSet[0]["SC Pay To Contact Address"]!=undefined)
			markup+='                                        <input type="text" name="" class="SC-SO-input SC_QVC_edit" style="pointer-events:none" value="'+RecordSet[0]["SC Pay To Contact Address"]+'">';
		    else
				markup+='                                        <input type="text" name="" class="SC-SO-input SC_QVC_edit" value="" style="pointer-events:none">';
			  markup+='                                    <img src="images/custom/mvg.png" class="location-search-icon" style="display:none" id="SC-Address-pickApplet" >';
	       markup+='                                    </div>';
			}
			//SNARRA:Added Fields for NFL Project
			markup+='                                            <div class="SC-SO-detail-item m-bottom">';
            markup+='                                                 <label class="item-label">coupon:</label>';
			if(RecordSet[0]["SC Coupon Name"]!=undefined)
            markup+='                                                 <input type="text" name="" class="SC-SO-input SC-readonly SC-applets" id="SC-coupon-name" value="'+RecordSet[0]["SC Coupon Name"]+'">';
            else
           markup+='                                                 <input type="text" name="" class="SC-SO-input SC-readonly SC-applets" id="SC-coupon-name" value="">';
          markup+='                                                 <img src="images/custom/search-icon.png" class="location-search-icon" id="SC-coupon-icon" style="display:none">';
            markup+='                                            </div>';
			//SPATIBAN:Show number
			markup+='                                            <div class="SC-SO-detail-item m-bottom">';
            markup+='                                                 <label class="item-label">Show#:</label>';
			if(RecordSet[0]["SC Show Number Readonly"]=="Y")
            markup+='                                                 <input type="text" name="" class="SC-SO-input SC-readonly" id="SC-show-num" value="'+RecordSet[0]["SC Sale Show#"]+'">';
            else{
           markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets SC-readonly" id="SC-show-num" value="'+RecordSet[0]["SC Sale Show#"]+'">';
          markup+='                                                 <img src="images/custom/search-icon.png" class="location-search-icon" id="SC-shownum-icon" style="display:none">';
			}
		   markup+='                                            </div>';
		   //SNARRA:Added Manual Discount CHG0034230 
		  /* markup+='                                            <div class="SC-SO-detail-item m-bottom">';
            markup+='                                                 <label class="item-label"></label>';
			 markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets" id="SC-show-num" value="'+RecordSet[0]["SC Manual Order Reason"]+'">';
           markup+='                                            </div>';*/
		markup+='                                    <div class="SC-SO-detail-item m-bottom" id="manualreasonblock">';
		markup+='                                        <label class="item-label">Manual Order Reason:</label>';
		var divtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Type');
		var divsubtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Sub Type');
		if(RecordSet[0]["SC Manual Order Reason"]!="")
			markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets" id="manualreason" value="'+RecordSet[0]["SC Manual Order Reason"]+'">';
		 else
			markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets" id="manualreason" value="">';
		markup+='                                    </div>';
		//NTHARRE: 13Aug2021: Added for SFSTRY0001059
		if((divtype == "STORE" && divsubtype == "STORE") || (divtype == "DIRECT" && divsubtype =="CSC")){
			markup+='                                    <div class="SC-SO-detail-item m-bottom" id="manualsubreasonblock">';
			markup+='                                        <label class="item-label">Manual Order Sub Reason:</label>';
			if(RecordSet[0]["SC Manual Order Sub Reason"]!="")
				markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets" id="manualsubreason" value="'+RecordSet[0]["SC Manual Order Sub Reason"]+'">';
			 else
				markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets" id="manualsubreason" value="">';
			markup+='                                    </div>';
			if(RecordSet[0]["SC Manual Order Sub Reason"] == "Coupon not Working"){
				markup+='                                    <div class="SC-SO-detail-item m-bottom" id="CouponNotWrkngblock">';
				markup+='                                        <label class="item-label">Coupon Not Working:</label>';
				if(RecordSet[0]["SC Coupon Not Working"]!="")
					markup+='                                                 <input type="text" name="notwrkngcoupon" class="SC-SO-input SC-applets" id="couponnotwrkng" value="'+RecordSet[0]["SC Coupon Not Working"]+'">';
				 else
					markup+='                                                 <input type="text" name="notwrkngcoupon" class="SC-SO-input SC-applets" id="couponnotwrkng" value="">';
				markup+='                                    </div>';
			}
			else{
				markup+='                                    <div class="SC-SO-detail-item m-bottom" id="CouponNotWrkngblock" style="display:none">';
				markup+='                                        <label class="item-label">Coupon Not Working:</label>';
				markup+='                                        <input type="text" name="" class="SC-SO-input SC-applets" id="couponnotwrkng" value="'+RecordSet[0]["SC Coupon Not Working"]+'">';
				markup+='                                    </div>';
			}
			if(RecordSet[0]["SC Manual Order Reason"]!="" && RecordSet[0]["SC Manual Order Sub Reason"]!=""){
				markup+='                                            <div class="SC-SO-detail-item m-bottom" id="manualreasoncomm">';
				markup+='                                                 <label class="item-label">Manual Order Comments:</label>';
				markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets SC-readonly" id="SC-manual-commnets" value="'+RecordSet[0]["SC Manual Comments"]+'">';
				markup+='                                            </div>';
			}
			else{
				markup+='                                            <div class="SC-SO-detail-item m-bottom" id="manualreasoncomm" style="display:none">';
				markup+='                                                 <label class="item-label">Manual Order Comments:</label>';
				markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets SC-readonly" id="SC-manual-commnets" value="'+RecordSet[0]["SC Manual Comments"]+'">';
				markup+='                                            </div>';
			}
		}
		else if(RecordSet[0]["SC Manual Order Reason"]!=""){
			markup+='                                            <div class="SC-SO-detail-item m-bottom" id="manualreasoncomm">';
			markup+='                                                 <label class="item-label">Manual Order Comments:</label>';
			markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets SC-readonly" id="SC-manual-commnets" value="'+RecordSet[0]["SC Manual Comments"]+'">';
			markup+='                                            </div>';
		}
		else{
			markup+='                                            <div class="SC-SO-detail-item m-bottom" id="manualreasoncomm" style="display:none">';
			markup+='                                                 <label class="item-label">Manual Order Comments:</label>';
			markup+='                                                 <input type="text" name="" class="SC-SO-input SC-applets SC-readonly" id="SC-manual-commnets" value="'+RecordSet[0]["SC Manual Comments"]+'">';
			markup+='                                            </div>';
		}
		markup+='                                </div>';
		markup+='                            </div>';
		//markup+='                            </form>';
		markup+='                        </div>';
		
		$("#_swescrnbar").hide();
		$("#_swethreadbar").hide();
		$("#_sweappmenu").hide();
		$("#s_vctrl_div").hide();
		$(".siebui-button-toolbar").hide();
		//$("#_swecontent").css("height","99%");
		$('#_sweview').css("overflow","auto"); 
		$('#sc-SalesOrder-Details').html(markup);
		//SPATIBAN: nov 15 2019: to hide catelogue category and products page
		if((RecordSet[0]["Status"] === "Booked")||(RecordSet[0]["Status"] === "Submitted")||(RecordSet[0]["Status"] === "Complete")||(RecordSet[0]["Status"] === "Cancelled")||(RecordSet[0]["Status"] === "Closed")){
				$("#browsecatalogdiv").hide();
				$("#sccataloguecategory").hide();
				$("#scproductstable").hide();
			}
		
															
		//SNARRA Added for CTI toolbar Issue
		if($("#CommunicationPanelContainer").is(":visible") && (localStorage.getItem('CTIToolbar')== "Y")){
				   $(".SC-data-container").css("position","inherit");
				   $("#sc-orange").show();
				   $("#sc-white").hide();
			   }
		 if($("#CommunicationPanelContainer").is(":visible")){
				    $("#sc-orange").show();
					$("#sc-white").hide();
			   }
		
		//for tax exempt flag
		if(RecordSet[0]["Tax Exempt"]=='Y'){
			$('#teoh').prop('checked', true);
			$("#clip-img").show();
		}
		else
			$('#teoh').prop('checked', false);
		
		//SBOORLA:Added code for defect 710
		$(".SC-readonly-date").css({
		   "pointer-events": 'none'
		});
		Lov=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_CUSTOMER_CATEGORY' and [Active] = 'Y' and [Name]='Insider'");
		//to disbale referredby icon
		/*if((RecordSet[0]["SC Referral Contact Id"] == null ) || (RecordSet[0]["SC Referral Contact Id"] == "No Match Row Id") || (RecordSet[0]["SC Customer Category"] == null) || (RecordSet[0]["Revision"] > 1) || (RecordSet[0]["SC Sub-Type"]!="Employee") || (RecordSet[0]["SC Customer Category"] != Lov[0])){
		//(RecordSet[0]["SC Customer Category"] != LookupValue("SC_CUSTOMER_CATEGORY", "Insider")) 
			$("#SC-search-icon-referreby").addClass("refer");
		}*/
		if((RecordSet[0]["Revision"] == 1) && (RecordSet[0]["SC Sub-Type"]!="Employee") && (RecordSet[0]["SC Customer Category"] != Lov[0])){
		//(RecordSet[0]["SC Customer Category"] != LookupValue("SC_CUSTOMER_CATEGORY", "Insider")) 
			$("#SC-search-icon-referreby").addClass("refer");
		}
		/*if (RecordSet[0]["Revision"] > 1 && RecordSet[0]["SC Con Bill To Address Readonly"] != "Y"){
			var BilltoMarkup=""
			BilltoMarkup='<div class="sn-edit-BA-icon" id="SC-BiitoAddress-Edit" title="Click here to edit Bill To Address"><img class="sn-image-size" src="images/custom/edit.png" class=""></div>';
			BilltoMarkup+='<div class="sn-SC-BA-icon" id="SC-BitoAddress-SC"> <img class="sn-image-size sn-save-BA-icon" src="images/custom/done_mini.png" id="SC-BitoAddress-Save"><img class="sn-image-size sn-cancel-BA-icon" src="images/custom/close_mini.png" id="SC-BitoAddress-Cancel"></div>';
			$('#sc-SalesOrder-Details').find("#addressto").parent().parent().append(BilltoMarkup);
			$('#sc-SalesOrder-Details').find("#addressto").parent().parent().addClass("sn-Billtoadd-div");
			$("#SC-BitoAddress-SC").hide();
			$("#addressto").addClass("revisionaddress");
		}*/
		var scaddrDropdown="N";
		
		$("#addressto").click(function(){
			//to make bill to address as a dropdown
			if(scaddrDropdown=='N'){
				$("#addressto").html(AttachAddresses());
				scaddrDropdown="Y";
				//$("#addressto").trigger("click");
				//$("#addressto").trigger("click");
			}
		});
		
		//Add store Location modal open
		$("#SC-add-store-location").click(function(){
			//StoreLocation = SC_OUI_Methods.StoreName(LoginId);
			StoreLocation = SC_OUI_Methods.SCGetProfileAttrValue("SC Store Name OUI");
			$("#SC-add-storelocation").modal({
				backdrop: 'static'
			});
			if(StoreLocation!=""){
				document.getElementById('StoreTitle').innerHTML = StoreLocation;
				$("#StoreTitle").attr("title",StoreLocation);
			}else{
				document.getElementById('StoreTitle').innerHTML = "Add Store Location";
			}
		});
		//Ngolla Defect #756
		/*$(document).on('change',"#csubtype",function () {
			if(this.value = "QVC")
			{  
             $(".QVC_fileds").show();		
			}else{
			 $(".QVC_fileds").show();	
				
			}
			});*/
		
		// on click of the enter in contact search
		$(".search-box").keyup(function(event) {
			if (event.keyCode === 13) {
				if(!$("#sc-search").hasClass("SC-disabled")){
					searchContact();
				}
			}
		});
		
		//on click of enter on store search
		$("#SC-Store-Search").keyup(function(event) {
			if (event.keyCode === 13) {
				var value=document.getElementById('SC-Store-Search').value;
				markup=SC_OUI_Markups.StoreChange2(value);
				$("#SC-storelocation").html(markup);
			}
		});
		
		
		//on selecting the store for change of store
		var selectstoreid="";
		$(document).on('click','#SC-storelocation tr',function(){
			$(this).addClass('cti-active').siblings().removeClass('cti-active');
			selectstoreid=$(this).attr('id');
		});
		
		//on click of the store
		$(document).on('click','#SC-selectstore',function(){
			$("#SC-Store-Search").val("");
		    selectstoreid=$("#"+selectstoreid+" td:first-child").text();
			if(selectstoreid.length!=0){
				SC_OUI_Methods.SetStore(selectstoreid);
				SC_OUI_Methods.SCGetProfileAttr("SC Primary Division Type,SC Store Number,MachineInfo,SC Store User,LoginFirstTimeOUI,PoleDisplayOUI,SC Store Name OUI,Login Name,Last Name,First Name,SC Primary Division Sub Type,DISALocFound,Primary responsibility Name,SC Primary Division Name,SCHCMerchantId,SCGEMerchantId,SC Primary Division Id,IP");
				//StoreLocation = SC_OUI_Methods.StoreName(LoginId);
				StoreLocation = SC_OUI_Methods.SCGetProfileAttrValue("SC Store Name OUI");
				if(StoreLocation!=""){
					document.getElementById('storename').innerHTML = selectstoreid.substring(0,10);
					$("#SC-add-store-location").attr("title","Change Store");
					$("#storename").attr("title",selectstoreid);
					StoreLocation = selectstoreid;
				}else{
					 $("#SC-add-store-location").attr("title","Add Store");
				}
			}
			$("#SC-add-storelocation").modal('hide');
			$("#SC-storelocation").html("");
			});
		
		
		//NGollA defect for 663
		$(document).on('click','#SC-Clear-store',function(){
				SC_OUI_Methods.SetStore("");
				SC_OUI_Methods.SCGetProfileAttr("SC Primary Division Type,SC Store Number,MachineInfo,SC Store User,LoginFirstTimeOUI,PoleDisplayOUI,SC Store Name OUI,Login Name,Last Name,First Name,SC Primary Division Sub Type,DISALocFound,Primary responsibility Name,SC Primary Division Name,SCHCMerchantId,SCGEMerchantId,SC Primary Division Id,IP");
				//StoreLocation = SC_OUI_Methods.StoreName(LoginId);
				StoreLocation = SC_OUI_Methods.SCGetProfileAttrValue("SC Store Name OUI");
				$("#storename").text('Add Store');
				$("#StoreTitle").text('Add Store Location');
				$("#StoreTitle").attr("title","Add Store Location");
			});
			
			//Start: SHARATH: added below code for terminal US
			$(document).on('click','#SC-save-terminal',function(){
				
				var terminalSelected = $('#terminal-list').val();
				if(terminalSelected == "Select Terminal")
				{
					$('p.sc-bg-red').text('Select a terminal to proceed.');
					$('#terminal-list').css('border-color','red');
					
				}
				else{
					var termId = $('#terminal-list option:selected').attr('term-id');
					$('#SC-terminal-tile span').text(termId);
					$('#SC-terminal-tile').css('display','');
					$("#SC-add-terminal-tile").modal('hide');
					$("#SC-storelocation").html("");
					var OrderResumeFlg	= SiebelApp.S_App.GetProfileAttr('ResumeOrder');
					if(OrderResumeFlg == "Y")
					{
						var vinPS = SiebelApp.S_App.NewPropertySet();
						var voutPS = SiebelApp.S_App.NewPropertySet();
						var vBservice = SiebelApp.S_App.GetService("SessionAccessService");
						
						vinPS.SetProperty('Name','ResumeOrder');
						vinPS.SetProperty('Value','N');

						if(vBservice)
						{
							voutPS = vBservice.InvokeMethod("SetProfileAttr", vinPS);
							
						}
					}
					var sBservice = SiebelApp.S_App.GetService("SessionAccessService");
					var sinPS = SiebelApp.S_App.NewPropertySet();
					var soutPS = SiebelApp.S_App.NewPropertySet();
					sinPS.SetProperty('Name','TerminalSelected');
					sinPS.SetProperty('Value',termId);
					if(sBservice)
						{
							soutPS = sBservice.InvokeMethod("SetProfileAttr", sinPS);
						}
						
						var inPS = SiebelApp.S_App.NewPropertySet();
						var outPS = SiebelApp.S_App.NewPropertySet();
						var Bservice = SiebelApp.S_App.GetService("SC Adyen Payment Service");
						var OrderNum = SiebelApp.S_App.GetActiveView().GetApplet('SC Sales Order Entry Form Applet OUI').GetBusComp().GetFieldValue('Order Number');
						inPS.SetProperty('Order Number',OrderNum);
						inPS.SetProperty('Terminal Id',termId);
						
						if(Bservice)
							{
								outPS = Bservice.InvokeMethod("UpdateTerminalId", inPS);
							}
							
							var inPS = SiebelApp.S_App.NewPropertySet();
							var outPS = SiebelApp.S_App.NewPropertySet();
							var Bservice = SiebelApp.S_App.GetService("FINS Teller UI Navigation");

							inPS.SetProperty('RefreshAll','Y');

							if(Bservice)
								{
									outPS = Bservice.InvokeMethod("RefreshCurrentApplet", inPS);
									
								}

							//Start SetInterval to check if terminal is active.
							if(window.terminalcheck != undefined && window.terminalcheck != "undefined")
							{
								clearInterval(window.terminalcheck);
								//SC_OUI_Methods.ResetTerminalProfileAttrib();
								SiebelJS.Log('Terminal Interval Cleared!!');
							}
							
							 window.terminalcheck = setInterval(function(){
									var inPS = SiebelApp.S_App.NewPropertySet();
									var outPS = SiebelApp.S_App.NewPropertySet();
									var Bservice = SiebelApp.S_App.GetService("SC Adyen Payment Service");

									inPS.SetProperty('Order Number',OrderNum);

									if(Bservice)
										{
											outPS = Bservice.InvokeMethod("GetTerminalId", inPS);
											var termId = outPS.GetChild(0).GetProperty('TerminalId');
											SiebelJS.Log("termId: "+termId);
											if(termId=="")
											{
												clearInterval(terminalcheck);
												$('#SC-terminal-tile').css('display','none');
												$("#SC-terminal-offline-popup").modal({
													backdrop: 'static'
												});
												$("#SC-terminal-offline-popup").css({
												"display": "flex",
												"justify-content": "center",
												"align-items": "center"
												});
												$(".modal-backdrop").css('background', '#ffffff');
												
												SC_OUI_Methods.ResetTerminalProfileAttrib();
												
											}
										}
									},5000);
				}
			});

			$(document).on('click','#SC-terminal-offline-ok',function(){
				$('#SC-terminal-offline-popup').css('display','');
				$("#SC-terminal-offline-popup").modal('hide');
				SC_OUI_Methods.SCnGetDisplayTerminals();
			});
			
			$(document).on('change','#terminal-list',function(){
				var optionSelected = $('#terminal-list').val();
				if(optionSelected == "Select Terminal")
				{
				}
				else{
					$('p.sc-bg-red').text('');
					$('#terminal-list').css('border-color','');
				}
			});
			//End: SHARATH: added above code for terminal US
		
		// Getting Store location
		StoreLocation = SC_OUI_Methods.SCGetProfileAttrValue("SC Store Name OUI");
		 
		if($("#SC-add-store-location").is(":visible")){
			if(StoreLocation!=""){
			document.getElementById('storename').innerHTML = StoreLocation.substring(0,10);
			$("#SC-add-store-location").attr("title","Change Store Location");
			$("#storename").attr("title",StoreLocation);
			 }else{
				$("#SC-add-store-location").attr("title","Add Store Location");
			 }
		}
		
		 //SPATIBAN:added code for update the user location with DISA Location
		var scdisaloc="";
		scdisaloc=SC_OUI_Methods.SCGetProfileAttrValue("DISALocFound");
		if(scdisaloc=="Y"){
			$("#SC-add-store-location").addClass("SC-readonly");
		}
		 // nullifying Store markup
		$(".SC-close-popup").click(function() {
			$("#SC-Store-Search").val('');
			$("#SC-storelocation").html("");
		});
	}//showui

    SCSalesOrderCreateFormAppletPR.prototype.BindData = function (bRefresh) {
     SiebelAppFacade.SCSalesOrderCreateFormAppletPR.superclass.BindData.apply(this, arguments);
	 localStorage.setItem('OrderId',RecordSet[0]["Id"]);
	 //to hide the edit details block
	 var status_val=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status");
	 if((responsibilityadmin=='Y')||(revision<2 && (status_val=="In Progress" || status_val=="Siebel Error"))){
		 /*if(RecordSet[0]["Revision"] > 1 && RecordSet[0]["SC Con Bill To Address Readonly"] != "Y"){
			 $("#SC-BitoAddress-SC").hide();
			$("#SC-BiitoAddress-Edit").hide();
		 }*/
		 $('#SC-SO-edit-block').show();
	 }
	 else{
		 $('#SC-SO-edit-block').hide();
	 }
    }

    SCSalesOrderCreateFormAppletPR.prototype.BindEvents = function () {
     SiebelAppFacade.SCSalesOrderCreateFormAppletPR.superclass.BindEvents.apply(this, arguments);
		//SPATIBAN: added below code for updating billtoaddress
		$("#SC-BiitoAddress-Edit").click(function() {
			$("#addressto").removeClass('read-mode');
			$("#addressto").css({
					"pointer-events": 'all',
					"border-bottom": "1px dashed #ffffff"
			});
			$("#SC-BitoAddress-SC").show();
			$("#SC-BiitoAddress-Edit").hide();
		});
		$("#SC-BitoAddress-Save").click(function() {
			$("#addressto").addClass('read-mode');
			$("#SC-BitoAddress-SC").hide();
			$("#SC-BiitoAddress-Edit").show();
			var val = $("#addressto").val();
			var addrid	= parentAddrJSON[val];
			SiebelJS.Log(addrid);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Bill To Address Id",addrid);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
			$("#sc-billtoaddr-tittle").attr("title", $(this).val());
			$("#addressto").css({
				"pointer-events": 'none',
				"border": "1px solid #194571"
			});
		});
		$("#SC-BitoAddress-Cancel").click(function() {
			$("#addressto").addClass('read-mode');
			$("#SC-BitoAddress-SC").hide();
			$("#SC-BiitoAddress-Edit").show();
			$("#addressto").html(AttachAddresses());
			$("#addressto").css({
				"pointer-events": 'none',
				"border": "1px solid #194571"
			});
		});
		//sushma 19-07-2018:Added for Resizing CTI Toolbar
	   $(document).on('click','#commPanelDockToShowUnpin',function(){
		  $("#CommunicationPanelContainer").css("cssText", "padding-top: 0px !important;");
	   })
	   $(document).on('click','#commPanelDockToShowPin',function(){
		  $("#CommunicationPanelContainer").css("cssText", "padding-top: 77px !important;");
	   })
	    
		$(document).on('change','#manualsubreason', function(event){
			if($("#manualreason").val()!=""){
				$("#manualreasoncomm").show();
				$("#SC-manual-commnets").removeClass("SC-readonly");
				$("#SC-manual-commnets").css({
						"pointer-events": 'all'
				});
				
				$("#SC-manual-commnets").attr('name','ordercomments');
				if($("#manualsubreason").val() == "Coupon not Working"){
					$("#CouponNotWrkngblock").show();
					var inPS="",outPS="",Bservice="";
					inPS = SiebelApp.S_App.NewPropertySet();
					outPS = SiebelApp.S_App.NewPropertySet();
					Bservice = SiebelApp.S_App.GetService("SC Order Coupons Validation Check"); //get service
					outPS = Bservice.InvokeMethod("GetOrderHeaderCoupons", inPS);
					if(outPS != "" && outPS != null){
						var Coupon_Names = outPS.GetChild(0).GetProperty("CouponName");
						if(Coupon_Names != "" && Coupon_Names != null && Coupon_Names != undefined){
							Coupon_Names = Coupon_Names.slice(0,Coupon_Names.length-4);
							Coupon_Names = Coupon_Names.split("____");
							var Coupnmarkup="";
							Coupnmarkup +='       <label class="item-label">Coupon Not Working:</label>';
							Coupnmarkup +='       <select class="SC-SO-input inherit read-mode" name="notwrkngcoupon" id="couponnotwrkng" >';
							Coupnmarkup +='  	  <option class="SC-SO-Option" selected></option>';
							for(var c=0;c<Coupon_Names.length;c++){
								Coupnmarkup +='		<option class="SC-SO-Option" value="'+Coupon_Names[c]+'">' + Coupon_Names[c] + '</option>';
							}
							Coupnmarkup += '</select>';
							$("#CouponNotWrkngblock").html(Coupnmarkup);
						}
						else{
							Coupnmarkup +='       <label class="item-label">Coupon Not Working:</label>';
							Coupnmarkup +='       <select class="SC-SO-input inherit read-mode" name="" id="couponnotwrkng" >';
							Coupnmarkup +='  	  <option class="SC-SO-Option" selected></option>';
							Coupnmarkup += '</select>';
							$("#CouponNotWrkngblock").html(Coupnmarkup);
						}
					}
					$("#couponnotwrkng").css({
						"pointer-events": 'all'
					});
					$("#couponnotwrkng").attr('name','notwrkngcoupon');
				}
				else
					$("#CouponNotWrkngblock").hide();
			}else{
				$("#SC-manual-commnets").addClass("SC-readonly");
				$("#SC-manual-commnets").css({
						"pointer-events": 'none'
				});
				$("#SC-manual-commnets").val("");
			}	
			
		});	
		//NTHARRE: 13Aug2021: Added for SFSTRY0001059
		$(document).on('change','#manualreason', function(event){
			var SCManualReason = $("#manualreason").val();
				var divtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Type');
				var divsubtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Sub Type');
				if((divtype == "STORE" && divsubtype == "STORE") || (divtype == "DIRECT" && divsubtype =="CSC")){
				
				var Lov1 = SC_OUI_Methods.SCGetOrderLoVs("[Type] = 'MANUAL_ORDER_SUB_REASON' AND [Active] = 'Y' AND [Parent] = 'Customer Appeasement'");
				var Lov2 = SC_OUI_Methods.SCGetOrderLoVs("[Type] = 'MANUAL_ORDER_SUB_REASON' AND [Active] = 'Y' AND [Parent] = 'System Issue'");
				var Lov3 = SC_OUI_Methods.SCGetOrderLoVs("[Type] = 'MANUAL_ORDER_SUB_REASON' AND [Active] = 'Y' AND [Parent] = 'Other'");
				var manualSubrsnmkup="";
				manualSubrsnmkup += '  <label class="item-label">Manual Order Sub Reason:</label>';
				manualSubrsnmkup += '<select class="SC-SO-input inherit read-mode" name="" id="manualsubreason" >';
				manualSubrsnmkup += ' <option class="SC-SO-Option" selected></option>';
				var SubRsnLOV="";
				if(SCManualReason === "Customer Appeasement"){
					SubRsnLOV = Lov1;
				}
				else if (SCManualReason == "System Issue"){
					SubRsnLOV = Lov2;
				}
				else
					SubRsnLOV = Lov3;
				var SCManualSubReason = $("#manualsubreason").val();
				if(SubRsnLOV != ""){
					for (var r = 0; r < SubRsnLOV.length; r++) {
						manualSubrsnmkup += '<option class="SC-SO-Option" value="'+SubRsnLOV[r]+'">' + SubRsnLOV[r] + '</option>';
					}
				}
				manualSubrsnmkup += '</select>';
				$('#manualsubreasonblock').html(manualSubrsnmkup);
				$("#manualsubreason").attr('name','OrderSubReason');
				$("#manualsubreason").css({
					"pointer-events": 'all'
				});
					
				}
				else{
					$('#manualsubreasonblock').hide();
					$("#manualreasoncomm").show();
					$("#SC-manual-commnets").removeClass("SC-readonly");
					$("#SC-manual-commnets").css({
							"pointer-events": 'all'
					});
					$("#SC-manual-commnets").attr('name','ordercomments');
				}
				$("#CouponNotWrkngblock").hide();
		});
		$(document).on("click","#SC-SO-cancel-block",function() {
		//$("#SC-SO-cancel-block").click(function() {
			var cancelrsn=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Cancel Reason");
			if(cancelrsn!=""){
				$('#SC-Cancel-SelectBox').val(cancelrsn);
				$('#cancelheadertext').text("Update the Cancel Reason?");
			}
			else{
				$('#cancelheadertext').text("Cancel Order?");
			}
			$("#SC-SO-Cancel-order").modal({
				backdrop: 'static'
			});
			$(".modal-backdrop").css('background', '#ffffff');

			$("#SC-SO-Cancel-order").css({
				"display": "flex",
				"justify-content": "center",
				"align-items": "center"
			});
			$("#SC-cancel-yes-button").addClass("SC-disabled");
		});
		
		
		//checkbox with image hide/show
		$("input").on('click', function() {
			if ($('#teoh').is(':checked')) {
				$("#clip-img").show();
			} else {
				$("#clip-img").hide();
			}
		});
		
		 $('#teoh').change(function() {
			 taxExeChange = "Y";
		});
		
		////on changing of Cancel reason popup
		/*$(document).on("click","#SC-Cancel-SelectBox",function() {
			if (!$("#SC-Cancel-SelectBox").val()) {
				$("#SC-cancel-yes-button").addClass("SC-disabled");
			} else {
				$("#SC-cancel-yes-button").removeClass("SC-disabled");
			}
		});*/
		//on change of the value in cancel reason of line
		$("#SC-Cancel-SelectBox").change(function() {
			$("#SC-cancel-yes-button").removeClass("SC-disabled");
		});
		
		
		//on click of yes of cancel order popup
		$(document).on("click","#SC-cancel-yes-button",function() {
		//$("#SC-cancel-yes-button").click(function() {
			$("#SC-SO-Cancel-order").modal('hide');
			$("#SC-SO-Cancel-order").css({
				"display": "",
				"justify-content": "",
				"align-items": ""
			});
			$("#custommaskoverlay").show();
			setTimeout(function() {
			billToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
			var orderId=billToContactRecordSet[0]["Id"];
			if($("#SC-Cancel-SelectBox").val()!=""){
				var SC_Cancel_Reason=$("#SC-Cancel-SelectBox").val();
				SiebelJS.Log("SC_Cancel_Reason"+SC_Cancel_Reason);
				
				/*var inPS="",outPS="",Bservice="",fieldnames,fieldvalues;
				fieldvalues=SC_Cancel_Reason;
				fieldnames="Cancel Reason"
				inPS = SiebelApp.S_App.NewPropertySet();
				outPS = SiebelApp.S_App.NewPropertySet();
				inPS.SetProperty("BO","Order Entry (Sales)");
				inPS.SetProperty("BC","Order Entry - Orders");
				inPS.SetProperty("FieldsArray",fieldnames );
				inPS.SetProperty("ValuesArray",fieldvalues);
				inPS.SetProperty("SearchSpecification","[Id] = '" + orderId +"'" );
				Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
				outPS = Bservice.InvokeMethod("Insert", inPS);
				
				var lineItemsPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM()
				var lineItemsRS = lineItemsPM.Get("GetRecordSet");
				var lineItemsId = lineItemsPM.Get("GetFullId");
				//var lineItemSeq = lineItemsId[lineItemsId.length -1];
				var lineItemSeq = lineItemsId.split("_A");
				lineItemSeq=lineItemSeq[1];
				var bNextRecSet = false;
				var recNum =0;
				var cancelControl = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetControls()["Cancel Reason"];
				do{
					for(recNum=0;recNum < lineItemsRS.length;recNum++){
						if(lineItemsRS[recNum]["Product Line"] != "DELIVERY" && lineItemsRS[recNum]["SC Cancel Reason Calc"] != 'Y'){
							SiebelJS.Log("Product Line:"+lineItemsRS[recNum]["Product Line"]);
							$("#s_"+lineItemSeq+"_l tr#"+(recNum+1)+"").trigger("click");
							SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().ExecuteMethod("SetFormattedValue", cancelControl,SC_Cancel_Reason);
						}
						lineItemsRS = lineItemsPM.Get("GetRecordSet");
					}
					bNextRecSet = lineItemsPM.ExecuteMethod("CanInvokeMethod","GotoNextSet");
					if(bNextRecSet){
						lineItemsRS = lineItemsPM.ExecuteMethod("InvokeMethod","GotoNextSet",null,false);
						recNum = 0;
					}
				}while(bNextRecSet);*/

				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Cancel Reason",SC_Cancel_Reason);
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
				
				$("#refundordernumber").html("Sales Order#"+billToContactRecordSet[0]["Order Number"]);
				var inPS  = SiebelApp.S_App.NewPropertySet();
				var outPS = SiebelApp.S_App.NewPropertySet();
				var Bservice="";
				inPS.SetProperty("OrderId",orderId)
				SiebelJS.Log("Invoking Business Service");
				//SBOORLA:Added condition for defect 782
				if(orderId!=null&&orderId!=""&&orderId!="undefined"){
				Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
				outPS = Bservice.InvokeMethod("Query",inPS); //invoke the method
				lineitemsmarkup=getlineitems(outPS);
				}
				$("#sc-refund-lineitems").html(lineitemsmarkup);
				$("#SC-refund-popup").modal({
					backdrop: 'static'
				});
			}
			else{
				billToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
				var orderId=billToContactRecordSet[0]["Id"];
				var inPS="",outPS="",Bservice="",fieldnames,fieldvalues;
				fieldvalues="";
				fieldnames="Cancel Reason"
				inPS = SiebelApp.S_App.NewPropertySet();
				outPS = SiebelApp.S_App.NewPropertySet();
				inPS.SetProperty("BO","Order Entry (Sales)");
				inPS.SetProperty("BC","Order Entry - Line Items");
				inPS.SetProperty("FieldsArray",fieldnames );
				inPS.SetProperty("ValuesArray",fieldvalues);
				inPS.SetProperty("SearchSpecification","[Id] = '" + orderId +"'" );
				Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
				outPS = Bservice.InvokeMethod("Insert", inPS);
				
				var lineItemsPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM();
				var lineItemsRS = lineItemsPM.Get("GetRecordSet");
				var lineItemsId = lineItemsPM.Get("GetFullId");
				//var lineItemSeq = lineItemsId[lineItemsId.length -1];
				var lineItemSeq = lineItemsId.split("_A");
				lineItemSeq=lineItemSeq[1];
				var bNextRecSet = false;
				var recNum =0;
				var cancelControl = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetControls()["Cancel Reason"];
				do{
					for(recNum=0;recNum<lineItemsRS.length;recNum++){
						if(lineItemsRS[recNum]["Product Line"] != "DELIVERY" && lineItemsRS[recNum]["SC Cancel Reason Calc"] != 'Y'){
							SiebelJS.Log("Product Line:"+lineItemsRS[recNum]["Product Line"]);
							$("#s_"+lineItemSeq+"_l tr#"+(recNum+1)+"").trigger("click");
							SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().ExecuteMethod("SetFormattedValue", cancelControl,"");
						}
						lineItemsRS = lineItemsPM.Get("GetRecordSet");
					}
					bNextRecSet = lineItemsPM.ExecuteMethod("CanInvokeMethod","GotoNextSet");
					if(bNextRecSet){
						lineItemsRS = lineItemsPM.ExecuteMethod("InvokeMethod","GotoNextSet",null,false);
						recNum = 0;
					}
				}while(bNextRecSet);
				
				//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Cancel Reason","");
				//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
				
				$("#sc-cancelreason").text("");
				var inPS  = SiebelApp.S_App.NewPropertySet();
				var outPS = SiebelApp.S_App.NewPropertySet();
				var Bservice="",Lov_Dis="",Lov_Per="";
				inPS.SetProperty("OrderId",billToContactRecordSet[0]["Id"])
				SiebelJS.Log("Invoking Business Service");
				Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
				outPS = Bservice.InvokeMethod("Query",inPS); //invoke the method
				Lov_Dis=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_MANUAL_DISCOUNT_REASON' and [Active] = 'Y'");
				Lov_Per=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'DISCNT_PERCENT' and [Active] = 'Y'");
				isStoreUser=RecordSet[0]["SC Store User"];
				SC_OUI_Markups.prodmarkup(outPS,Lov_Dis,Lov_Per,isStoreUser);

			}
			$("#custommaskoverlay").hide();
		}, 200);
		});
		
		//on click of no of cancel order popup
		$(document).on("click","#SC-cancel-no-button",function() {
			$("#SC-SO-Cancel-order").modal("hide");
		});
		
		//on click of issue refund
		$(document).on("click","#SC-issue-refund",function() {
			//to hide refund popup
			$("#SC-refund-popup").modal("hide");
			$("#SC-refund-popup").css({
				"display": "",
				"justify-content": "",
				"align-items": ""
			});
			
			$("body").trigger('Custom.Start');
			setTimeout(function(){
				var lineItemsPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM();
				var invokeFrieght = lineItemsPM.ExecuteMethod("CanInvokeMethod","SC Calculate Shipping");
				if(invokeFrieght){
					lineItemsPM.ExecuteMethod("InvokeMethod","SC Calculate Shipping",null,false);
				}
				
				var orderHeaderPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
				var invokeVerify = orderHeaderPM.ExecuteMethod("CanInvokeMethod","QuotesAndOrdersValidate");
				if(invokeVerify){
					orderHeaderPM.ExecuteMethod("InvokeMethod","QuotesAndOrdersValidate",null,false);
				}
				
				$("body").trigger('Custom.End');
				//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("QuotesAndOrdersValidate");
				SiebelApp.S_App.GotoView("SC Order Entry - Payment View Sales OUI");
			},100);
		});
		//sandeep
		 
		//on click of order date change
		$("#SC-order-date").click(function() {
			$("#SC-order-date").datetimepicker({
				maxDate: OrderDate,
				changeMonth: true,
				changeYear: true,
				dateFormat: 'mm/dd/yy',
				timeFormat: 'HH:mm:ss',
				use24hours: true,
				onSelect: function(dateText, inst) {
					$("#SC-order-date").val(dateText);
					if ($("#SC-order-date").val() != "")
					fvalue = $("#SC-order-date").val();
				},
				 showButtonPanel: true
			});
		});
		//Start:on scroll hiding the datepicker
			$("html, body").on("DOMMouseScroll MouseScrollEvent MozMousePixelScroll wheel scroll", function ()
			{
				if($("#SC-order-date").hasClass("hasDatepicker"))
			  $("#SC-order-date").datepicker("hide");
			});
		  //End:on scroll hiding the datepicker
		  //START SNARRA 28/05/2018 Added code for hiding DatePicker on tab
		    $("#SC-order-date").on('keydown', function(ev){
				if(ev.keyCode === 9){ //tab
					if($("#SC-order-date").hasClass("hasDatepicker"))
			          $("#SC-order-date").datepicker("hide");
				}
			});
			//END SNARRA 28/05/2018 Added code for hiding DatePicker on tab
		
		//on click of goto Contact
		$("#gotoContact").click(function() {
			//Start loader 
			$("body").trigger('Custom.Start');
			setTimeout(function(){
			//SBOORLA:Added code for Pole Display
			if(localStorage.getItem("InvokepoleDisplay")=="Y"){
				var poleJSON=[];
				SC_OUI_Methods.PoleDisplay(poleJSON,"P");
			}
			if(AccountOrder==true){
				InPut.SetProperty("View","SC Account 360 View OUI");
				InPut.SetProperty("Business Component","Account");
				InPut.SetProperty("Row Id",Account_Id);
			}
			else if(AccountOrder==false){
				InPut.SetProperty("View","SC Contact 360 Degree View OUI");
				InPut.SetProperty("Business Component","Contact");
				InPut.SetProperty("Row Id",Contact_Id);
			}
			BService = SiebelApp.S_App.GetService("CUT eSales Order Entry Toolkit Service");
			OutPut = BService.InvokeMethod("GotoView",InPut);
			//hiding the Loader
			$("body").trigger('Custom.End');
			},1000);
			
			//SHARATH: Clear Interval.
			if(window.terminalcheck != undefined && window.terminalcheck != "undefined")
			{
				clearInterval(window.terminalcheck);
				SC_OUI_Methods.ResetTerminalProfileAttrib();
				SiebelJS.Log('Terminal Interval Cleared on Go To Contact!!');
			}
		});
		/*$("#scbillToaccdrilldown").click(function(){
			$("body").trigger('Custom.Start');
			setTimeout(function(){
				localStorage.setItem('whitescreen', 1);
				var InPut_Bill="",OutPut_Bill="",AccBService;
				InPut_Bill=SiebelApp.S_App.NewPropertySet();
				OutPut_Bill=SiebelApp.S_App.NewPropertySet();
				InPut_Bill.SetProperty("View","Account Detail - Contacts View");
				InPut_Bill.SetProperty("Business Component","Account");
				InPut_Bill.SetProperty("Row Id",Account_Id);
				AccBService = SiebelApp.S_App.GetService("CUT eSales Order Entry Toolkit Service");
				OutPut_Bill = AccBService.InvokeMethod("GotoView",InPut_Bill);
			$("body").trigger('Custom.End');
			},100);
		});*/
		
		//on click of save and exit
		$("#savenexit").click(function() {
			//SBOORLA:Added code for Pole Display
			if(localStorage.getItem("InvokepoleDisplay")=="Y"){
				var poleJSON=[];
				SC_OUI_Methods.PoleDisplay(poleJSON,"P");
			}			
			InPut.SetProperty("View","SC Sales Order 360 Degree View OUI");
			InPut.SetProperty("Business Component","Order Entry - Orders");
			InPut.SetProperty("Row Id",localStorage.getItem('OrderId'));
			BService = SiebelApp.S_App.GetService("CUT eSales Order Entry Toolkit Service");
			OutPut = BService.InvokeMethod("GotoView",InPut);
			
			//SHARATH: Clear Interval.
			if(window.terminalcheck != undefined && window.terminalcheck != "undefined")
			{
				clearInterval(window.terminalcheck);
				SC_OUI_Methods.ResetTerminalProfileAttrib();
				SiebelJS.Log('Terminal Interval Cleared on Save & Exit!!');
			}
		});
		
		//on change of bill to address
		/*$(document).on('change','#addressto', function(){
			if(!$("#addressto").hasClass("revisionaddress")){
				var val = $("#addressto").val();
				var addrid	= parentAddrJSON[val];
				SiebelJS.Log(addrid);
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Bill To Address Id",addrid);
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
				$("#sc-billtoaddr-tittle").attr("title", $(this).val());
			}
		});*/
		//on click of delete Order
		$("#deleteorder").click(function() {	
			$("#SC-SO-Delete-order").modal({
				backdrop: 'static'
			})
			$("#SC-SO-Delete-order").css({
			"display": "flex",
			"justify-content": "center",
			"align-items": "center"
			})
			$(".modal-backdrop").css('background', '#ffffff');
		});
		
		$(document).on("click","#SC-delete-yes",function() {
			$("#SC-SO-Delete-order").modal('hide');
			$("#SC-SO-Delete-order").css({
			"display": "",
			"justify-content": "",
			"align-items": ""
			});
			//Start loader 
			$("body").trigger('Custom.Start');
			setTimeout(function(){
			//SBOORLA:Added code for Pole Display
			if(localStorage.getItem("InvokepoleDisplay")=="Y"){
				var poleJSON=[];
				SC_OUI_Methods.PoleDisplay(poleJSON,"P");
			}
			InPut.SetProperty("OrderId",localStorage.getItem('OrderId'));
			Bservice = SiebelApp.S_App.GetService("SC Cart OUI");
			OutPut = Bservice.InvokeMethod("RemoveOrder",InPut);

			if(AccountOrder==true){
				InPut.SetProperty("View","SC Account 360 View OUI");
				InPut.SetProperty("Business Component","Account");
				InPut.SetProperty("Row Id",Account_Id);
			}
			else if(AccountOrder==false){
				InPut.SetProperty("View","SC Contact 360 Degree View OUI");
				InPut.SetProperty("Business Component","Contact");
				InPut.SetProperty("Row Id",Contact_Id);
			}
			BService = SiebelApp.S_App.GetService("CUT eSales Order Entry Toolkit Service");
			OutPut = BService.InvokeMethod("GotoView",InPut);
			//hiding the Loader
			$("body").trigger('Custom.End');
			},1000);
			
			//SHARATH: Clear Interval.
			if(window.terminalcheck != undefined && window.terminalcheck != "undefined")
			{
				clearInterval(window.terminalcheck);
				SC_OUI_Methods.ResetTerminalProfileAttrib();
				SiebelJS.Log('Terminal Interval Cleared on Go To Contact!!');
			}
		});
		
		
		$(document).on("click","#SC-delete-no",function(){
			$("#SC-SO-Delete-order").modal('hide');
			$(".SC-SO-add-popup").css({
			 "display": "",
			 "justify-content": "",
			 "align-items": ""
			});   
		});
		
		$(document).on("click","#expand-collapse",function() {
			if($(this).hasClass("iconClosed")){
				 $("#SC-SO-edit-block").show();
				 $("#SC-SO-cancel-block").show();
				 $("#expand-collapse").addClass('iconOpen');
				 $("#expand-collapse").removeClass('iconClosed');
				 $("#sales-header").hide(350);
				 $("#sales-info").show();
			}else{
				$("#sales-header").show(350);
				$("#expand-collapse").addClass('iconClosed');
				$("#expand-collapse").removeClass('iconOpen');
				$("#SC-SO-edit-block").hide();
				$("#SC-SO-save-block").hide();
				$("#SC-SO-cancel-block").hide();
				$("#corderdate").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Date"));
				$("#csalesteam").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sales Team Login"));
				$("#cstatus").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status"));
				$("#csubtype").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sub-Type"));
				$("#csubchan").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Sub-Channel"));
				$("#clocation").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sale Location"));
				$("#sales-info").hide();
			}
		});

		//on click of referreby insider
		/*$("#SC-search-icon-referreby").click(function() {
			/*SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Referred By"]);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().AttachNotificationHandler("g", function(o) {
				var Field_Name = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("GetFieldValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Referred By"]);
				document.getElementById("referreby").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Referred By");
			});	
			$("#SC-search-contacts").modal({
	 		  backdrop: 'static'
	 	    });
			refByName="searchiconrefby";
		});*/


      //on click of last-name Ngolla defect #756
		$("#SC-last-name-pickApplet").click(function() {
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Sold To Last Name"]);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().AttachNotificationHandler("g", function(o) {
				var Field_Name = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("GetFieldValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Sold To Last Name"]);
				document.getElementById("SC-Sold-last-name").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sold To Last Name");
					document.getElementById("SC-Sold-First-name").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sold To First Name");
			});		
		});

       $("#SC-Address-pickApplet").click(function() {
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Pay To Contact Address"]);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().AttachNotificationHandler("g", function(o) {
				var Field_Name = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("GetFieldValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Pay To Contact Address"]);
				document.getElementById("#SC_Sold_Address").value=Field_Name;
			});		
		});


      $("#SC-coupon-icon").click(function(e) {
		  e.preventDefault();
		  e.stopImmediatePropagation();
		  var Field_Name = "";
		  var updated = false;
		   SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Name"]);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().AttachNotificationHandler("g", function(o) {
				Field_Name = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("GetFieldValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Name"]);
			    if(Field_Name!="" && !updated){
				    // document.getElementById("SC-coupon-name").value=Field_Name;
				    promoCouponValiadtion(Field_Name);
				    updated = true;
			    }
			});
		});

		function promoCouponValiadtion(Field_Name){
			var promId=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Id");
			var scustNumber=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Ship To Customer Number");
			var Custom_Servicec="",Input_BSc="",Out_BSc="",Csearchfields;
			var CouSearchSpec = "([Effective Start Date] IS NULL OR [Effective Start Date]<=today()) AND ([Effective End Date] IS NULL OR [Effective End Date]>=today()) AND [Product Id]='"+promId+"' AND ([SC Customer Number]='"+scustNumber+"' OR [SC Coupon Code] IS NOT NULL)";
			Custom_Servicec = SiebelApp.S_App.GetService("SC Custom Query");
			Input_BSc = SiebelApp.S_App.NewPropertySet();
			Out_BSc = SiebelApp.S_App.NewPropertySet();
			Csearchfields = "Id";
			Input_BSc.SetProperty("BO", "ISS Promotion");
			Input_BSc.SetProperty("BC", "Product Eligibility BusComp");
			Input_BSc.SetProperty("SearchSpecification", CouSearchSpec);
			Input_BSc.SetProperty("SortSpecification", "");
			Input_BSc.SetProperty("ReqNoOfRecords", "");
			Input_BSc.SetProperty("FieldsArray", Csearchfields);
			Out_BSc = Custom_Servicec.InvokeMethod("Query", Input_BSc);
			var Child_BS = Out_BSc.GetChild(0);
			var BS_Data = Child_BS.GetProperty("OutputRecordSet");
			if(BS_Data!="}"){
				document.getElementById("SC-coupon-name").value=Field_Name;
			}else{
				alert("Coupon is invalid");
				document.getElementById("SC-coupon-name").value = "";
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("SetFormattedValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Name"],"");
				var couponCode = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Code");
				if(couponCode != undefined && couponCode != null && couponCode.length != 0){
					SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("SetFormattedValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Code"],"");
				}
			}
		}
		
		//on click of sales order team
		//SCHERKU: For Defect no 629
		$("#SC-sales-team-icon").click(function() {
			$(".read-mode-human").css({
				"pointer-events": 'all',
				"border-bottom": "1px dashed #ffffff"
			});
			if(responsibilityadmin=='Y')
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Sales Team Login Admin"]);
			else
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Sales Team Login"]);
		});	
		
		//on click of sale location
		$("#SC-sales-location-icon").click(function() {
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().OnControlEvent(SiebelApp.Constants.get("PHYEVENT_INVOKE_PICK"),SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Sale Location"]);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().AttachNotificationHandler("g", function (o) {
			var Field_Name = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("GetFieldValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["SC Sale Location"]);			
			SiebelJS.Log("Field_Name"+Field_Name);
			$("#sc-cahnge-loaction").text(Field_Name);
			$("#clocation").text(Field_Name);
			$("#SC-store-number").val(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Store Number"));
			$("#SC-order-channel").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Type"));
			$("#SC-order-subchannel").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Sub-Channel"));
			$("#csubchan").text($("#SC-order-subchannel").text());
			});
		});
		
		
		//on click of edit details
		//$("#SC-SO-edit-block").click(function() {
		$(document).on('click','#SC-SO-edit-block', function(){
			var SCManualReason = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Manual Order Reason");
			var manualmarkup="";
			var divtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Type');
			var divsubtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Sub Type');
				manualmarkup += '  <label class="item-label">Manual Order Reason:</label>';
				manualmarkup += '<select class="SC-SO-input inherit read-mode" name="" id="manualreason" >';
				 var Lov_Res="";
				 Lov_Res=SC_OUI_Methods.SCGetOrderLoVs("[Type] = 'MANUAL_ORDER_REASON' AND [Active] = 'Y'");
				 for (var r = 0; r < Lov_Res.length; r++) {
					if (Lov_Res[r] == SCManualReason){
						manualmarkup += ' <option class="SC-SO-Option" selected>' + SCManualReason + '</option>';}
					else
					manualmarkup += '<option class="SC-SO-Option" value="'+Lov_Res[r]+'">' + Lov_Res[r] + '</option>';
				}
				manualmarkup += '</select>';
			$('#manualreasonblock').html(manualmarkup);
			
			if(SCManualReason==""){
			  $("#manualreason").val("");	
			  $("#manualsubreason").val("");	
			}
			//NTHARRE: Added below code for SFSTRY0001059
			else{
				if((divtype == "STORE" && divsubtype == "STORE") || (divtype == "DIRECT" && divsubtype =="CSC")){
				var SCManualSubReason = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Manual Order Sub Reason");
				var Lov1 = SC_OUI_Methods.SCGetOrderLoVs("[Type] = 'MANUAL_ORDER_SUB_REASON' AND [Active] = 'Y' AND [Parent] = 'Customer Appeasement'");
				var Lov2 = SC_OUI_Methods.SCGetOrderLoVs("[Type] = 'MANUAL_ORDER_SUB_REASON' AND [Active] = 'Y' AND [Parent] = 'System Issue'");
				var manualSubrsnmkup="";
				manualSubrsnmkup += '  <label class="item-label">Manual Order Sub Reason:</label>';
				manualSubrsnmkup += '<select class="SC-SO-input inherit read-mode" name="" id="manualsubreason" >';
				var SubRsnLOV="";
				if(SCManualReason === "Customer Appeasement"){
					SubRsnLOV = Lov1;
				}
				else if (SCManualReason == "System Issue"){
					SubRsnLOV = Lov2;
				}
				else
					SubRsnLOV = "";
				if(SubRsnLOV != ""){
					for (var r = 0; r < SubRsnLOV.length; r++) {
						if (SubRsnLOV[r] == SCManualSubReason){
							manualSubrsnmkup += ' <option class="SC-SO-Option" selected>' + SCManualSubReason + '</option>';}
						else
						manualSubrsnmkup += '<option class="SC-SO-Option" value="'+SubRsnLOV[r]+'">' + SubRsnLOV[r] + '</option>';
					}
				}
				manualSubrsnmkup += '</select>';
				$('#manualsubreasonblock').html(manualSubrsnmkup);
				}
			}
			if($("#manualsubreason").val() == "Coupon not Working"){
					$("#CouponNotWrkngblock").show();
					var inPS="",outPS="",Bservice="";
					inPS = SiebelApp.S_App.NewPropertySet();
					outPS = SiebelApp.S_App.NewPropertySet();
					Bservice = SiebelApp.S_App.GetService("SC Order Coupons Validation Check"); //get service
					outPS = Bservice.InvokeMethod("GetOrderHeaderCoupons", inPS);
					var notwrkngcpn = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Not Working");
					if(outPS != "" && outPS != null){
						var Coupon_Names = outPS.GetChild(0).GetProperty("CouponName");
						if(Coupon_Names != "" && Coupon_Names != null && Coupon_Names != undefined){
							Coupon_Names = Coupon_Names.slice(0,Coupon_Names.length-4);
							Coupon_Names = Coupon_Names.split("____");
							var Coupnmarkup="";
							Coupnmarkup +='       <label class="item-label">Coupon Not Working:</label>';
							Coupnmarkup +='       <select class="SC-SO-input inherit read-mode" name="notwrkngcoupon" id="couponnotwrkng" >';
							for(var c=0;c<Coupon_Names.length;c++){
								if(notwrkngcpn == Coupon_Names[c])
									Coupnmarkup +='  	  <option class="SC-SO-Option" selected>'+notwrkngcpn+'</option>';
								else
								Coupnmarkup +='		<option class="SC-SO-Option" value="'+Coupon_Names[c]+'">' + Coupon_Names[c] + '</option>';
							}
							Coupnmarkup += '</select>';
							$("#CouponNotWrkngblock").html(Coupnmarkup);
						}
						else{
							Coupnmarkup +='       <label class="item-label">Coupon Not Working:</label>';
							Coupnmarkup +='       <select class="SC-SO-input inherit read-mode" name="" id="couponnotwrkng" >';
							Coupnmarkup +='  	  <option class="SC-SO-Option" selected></option>';
							Coupnmarkup += '</select>';
							$("#CouponNotWrkngblock").html(Coupnmarkup);
						}
					}
					$("#couponnotwrkng").css({
						"pointer-events": 'all'
					});
				}
			var locationchange=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Change");
			 $("#SC-coupon-icon").show();
			$("#SC-coupon-code").removeClass("SC-readonly");
			 $("#SC-coupon-code").css({
					"pointer-events": 'all'
			  });
			   $("#SC-coupon-name").css({
					"pointer-events": 'all'
			  });
			   if($("#manualreason").val()!=""){
				 $("#SC-manual-commnets").removeClass("SC-readonly"); 
				 $("#SC-manual-commnets").css({
					"pointer-events": 'all'
				});
			  }
			   //NTHARRE: 11-Aug-2021: Added for SFSTRY0001059
				$("#manualreason").css({
					"pointer-events": 'all'
				});
				$("#manualsubreason").css({
					"pointer-events": 'all'
				});
			  if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Show Number Readonly")=="N"){
				$("#SC-show-num").removeClass("SC-readonly");
				$("#SC-shownum-icon").show();
			}
			if(RecordSet[0]["Revision"] > 1 && RecordSet[0]["SC Con Bill To Address Readonly"] != "Y"){
				$("#addressto").removeClass('read-mode');
				$("#addressto").css({
						"pointer-events": 'all',
						"border-bottom": "1px dashed #ffffff"
				});
			}
			 $("#SC-coupon-name").removeClass("SC-readonly");
			if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Revision")>1&&responsibilityadmin=='Y'){
				  $(".read-mode-revise").css({
					"pointer-events": 'all',
					"border-bottom": "1px dashed #ffffff"
				});
				$("#SC-sales-team-icon").show();
				$("#SC-sales-show-store-icon").show();
				$("#SC-SO-edit-block").hide();
				$("#SC-SO-save-block").show();
			}
			else if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Revision")<2){
				$(".attachmentitem").show();
				$("#SC-add-new-Attach").show();
				$("#SC-SO-edit-block").hide();
				$("#SC-SO-save-block").show();
				if(RecordSet[0]["SC Referred By"] ==""){
				$("#SC-search-icon-referreby").show();
				}
				$("#SC-search-icon-Address").show();
				$(".read-mode").css({
					"pointer-events": 'all',
					"border-bottom": "1px dashed #ffffff"
				});
				$(".SC-checkbox-white-square").css({
				   "pointer-events": 'all'
				});
				$(".SC-applets").css({
				 "border-bottom": "1px dashed #ffffff"
				});
				//SBOORLA:Added code for defect 710
				$(".SC-readonly-date").css({
				   "pointer-events": 'none'
				});
				//SCHERKU: DEFECT 629 : Inactivated as part of defect fix 
				$(".read-mode-human").css({
					"pointer-events": 'all',
					"border-bottom": "1px dashed #ffffff"
				});
				if(responsibilityadmin=='Y' || locationchange=='Y'){
					$(".read-mode-admin").css({
						"pointer-events": 'all',
						"border-bottom": "1px dashed #ffffff"
					});
					$("#SC-sales-location-icon").show();	
				}//Ngolla for defect NO:#756
		}else if(responsibilityadmin=='Y'&& SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Revision")==1 && (SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status")== in_progress_value||SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status")==siebel_error_value)){
			$("#SC-last-name-pickApplet").show();
			$("#SC-Address-pickApplet").show();
            $(".SC_QVC_edit").css({
				"pointer-events": 'all',
				"border-bottom": "1px dashed #ffffff"
			});			
			}
			else if(responsibilityadmin=='Y'&& SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Revision")==1 && (SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status")== in_progress_value||SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status")==siebel_error_value)){
				$(".SC_WholeSale_edit").css({
				"pointer-events": 'all',
				"border-bottom": "1px dashed #ffffff"
			  });
				
				
			}
			//NTHARRE:01-Sep-2021:
			else if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Revision")>1 ){
				$(".read-mode-revise").css({
					"pointer-events": 'all',
					"border-bottom": "1px dashed #ffffff"
				});
				$("#SC-sales-team-icon").show();
				$("#SC-sales-show-store-icon").show();
				$("#SC-SO-edit-block").hide();
				$("#SC-SO-save-block").show();
			}
		});
		
		//for formatting the phone number
		SC_OUI_Methods.PH_USFormat("prefconmethod");
		SC_OUI_Methods.PH_USFormat_Save("prefconmethod",SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Preferred Contact"));
		
		$("#SC-SO-sales-save-changes").click(function() {
			if($("#SC-SO-save-block").is(":visible") ){
			  $("#sc-SalesOrder-Details").submit();	
			}
		 
		});
		//on click of save changes
		//$("#SC-SO-sales-save-changes").click(function() {
			var errorCodes = SCErrorCodes.errorcodes();
			$("#sc-SalesOrder-Details").validate({
			  rules: {
                       ordercomments: {
                                    required: true,
                            },
						OrderSubReason: {
								required: true,
						},
						notwrkngcoupon: {
								required: true,
						}
                     },
			messages: {
						ordercomments: {
							required: errorCodes.SC_REQUIRED_ORDER_COMMENTS
						},
						OrderSubReason: {
							required: errorCodes.SC_REQUIRED_ORDER_SUBREASON
						},
						notwrkngcoupon: {
							required: errorCodes.SC_REQUIRED_ORDER_COUPON
						}
				
			        },
            tooltip_options: {
				 ordercomments: {
                                trigger: 'focus',
                                placement: 'bottom',
                                html: true
                            },
				 OrderSubReason: {
                                trigger: 'focus',
                                placement: 'bottom',
                                html: true
                            },
				 notwrkngcoupon: {
                                trigger: 'focus',
                                placement: 'bottom',
                                html: true
                            }
		    
			},
            submitHandler: function(form) {
		   if($("#SC-SO-save-block").is(":visible") ){
			$(".attachmentitem").hide();
			$("#SC-add-new-Attach").hide();
			$("#SC-sales-team-icon").hide();
			$("#SC-shownum-icon").hide();
			$("#SC-coupon-icon").hide();
			$("#SC-show-num").addClass("SC-readonly");
			$("#SC-coupon-code").addClass("SC-readonly");
			 $("#SC-coupon-name").addClass("SC-readonly");
			 $("#SC-order-date").datepicker("hide");
			  $("#SC-coupon-code").css({
					"pointer-events": 'none'
			  });
			   $("#SC-coupon-name").css({
					"pointer-events": 'none'
			  });
			  
			 if(fvalue == ""){
				fvalue=$("#SC-order-date").val();
			 }
			SiebelJS.Log(pm);
			if(AccountOrder==true){
				c=document.getElementById("ponumber").value;					 
				b=document.getElementById("prefconmethod").value;
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Purchase Order Number",c);
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact",b);
				//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Location Store Number",z);							 
			}
			else{
				a=document.getElementById("omuseronly").value;
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Comments",a);
				//SBOORLA:Added code for defect 707
				if(!$("#referreby").hasClass("SC-readonly"))
				{
					SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Referred By",$("#referreby").val());	
				}
			}
			
			if(document.getElementById('teoh').checked){
				//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Tax Exempt",'Y');
				if(taxExeChange == "Y"){
					var OrderHeaderPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
					OrderHeaderPM.ExecuteMethod("InvokeMethod", "SetTaxFlagToY", null, false);
					taxExeChange = "N";
				}
			}
			else{
				//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Tax Exempt",'N');
				if(taxExeChange == "Y"){
					var OrderHeaderPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
					OrderHeaderPM.ExecuteMethod("InvokeMethod", "SetTaxFlagToN", null, false);
					taxExeChange = "N";
				}
			}
			
			if(fvalue!=""&&fvalue!=undefined){
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Order Date",fvalue);
				fvalue="";
			}
				
			a=document.getElementById("holdreason").value;
			
			//if hold reason is selected hold flag should get updated
			if(a=="")
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Hold Flag",'N');
			else
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Hold Flag",'Y');
			b=document.getElementById("subtype").value;
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Sub-Type",b);
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Delivery Block",a);
			var val = $("#addressto").val();
			var addrid	= parentAddrJSON[val];
			SiebelJS.Log(addrid);
			
			
			var Status=document.getElementById("orderstatus").value;
			//RCHATHAR: For defect number 710
			var sourceorder = document.getElementById("SC-source-order").value;
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Status",Status);
			//RCHATHAR: For defect number 710
			var hasAdminResp=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Admin Responsibility");
			if(hasAdminResp== "Y")
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Ext Order Number",sourceorder);
			if(addrid != undefined && addrid !="undefined" && addrid!="" && addrid != null && addrid!=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Bill To Address Id"))
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Bill To Address Id",addrid);
			Reason=$("#manualreason").val();
			var subReason=$("#manualsubreason").val();
			var Notwrkngcpn=$("#couponnotwrkng").val();
			if($("#manualreason").val()!="" && $("#manualreason").val()!=null){
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Manual Order Reason",Reason);
				var Comments=$("#SC-manual-commnets").val();	
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Manual Comments",Comments);	
			}else{
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Manual Order Reason","");
				$("#manualreason").val("");	
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Manual Order Sub Reason","");
				$("#manualsubreason").val("");
			}
			var custDetails_Markup = '';
			custDetails_Markup += '  <label class="item-label">Manual Order Reason:</label>';
			if($("#manualreason").val()!="" && $("#manualreason").val()!=null)
			custDetails_Markup += '  <input type="text" name="" class="SC-SO-input SC-applets" id="manualreason" value="'+Reason+'">';
		     else
		    custDetails_Markup += '  <input type="text" name="" class="SC-SO-input SC-applets" id="manualreason" value="">';
     		$('#manualreasonblock').html(custDetails_Markup);
			//NTHARRE: 13Aug-2021: Added for SFSTRY0001059,SFSTRY0001317
			var divtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Type');
			var divsubtype = SC_OUI_Methods.SCGetProfileAttrValue('SC Primary Division Sub Type');
			if((divtype == "STORE" && divsubtype == "STORE") || (divtype == "DIRECT" && divsubtype =="CSC")){
				var custDetails_Markup1 = '';
				custDetails_Markup1 += '  <label class="item-label">Manual Order Sub Reason:</label>';
				if($("#manualsubreason").val()!="" && $("#manualsubreason").val()!=null)
				custDetails_Markup1 += '  <input type="text" name="" class="SC-SO-input SC-applets" id="manualsubreason" value="'+subReason+'">';
				 else
				custDetails_Markup1 += '  <input type="text" name="" class="SC-SO-input SC-applets" id="manualsubreason" value="">';
				$('#manualsubreasonblock').html(custDetails_Markup1);
				var custDetails_Markup2 = '';
				custDetails_Markup2 += '  <label class="item-label">Coupon Not Working:</label>';
				if($("#couponnotwrkng").val()!="" && $("#couponnotwrkng").val()!=null && $("#manualsubreason").val() == "Coupon not Working")
				custDetails_Markup2 += '  <input type="text" name="notwrkngcoupon" class="SC-SO-input SC-applets" id="couponnotwrkng" value="'+Notwrkngcpn+'">';
				 else
				custDetails_Markup2 += '  <input type="text" name="" class="SC-SO-input SC-applets" id="couponnotwrkng" value="">';
				$('#CouponNotWrkngblock').html(custDetails_Markup2);
		   }
			//SNARRA:19 JUN 2018 Added Fileds for NFL Project
			var couponName = document.getElementById("SC-coupon-name").value;
			if(couponName != null && couponName != "" && couponName.length != 0){
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("SetFormattedValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Name"],couponName);
			}else{
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("SetFormattedValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Name"],"");
				var couponCode = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Code");
				if(couponCode != undefined && couponCode != null && couponCode.length != 0){
					SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("SetFormattedValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Code"],"");
				}
			}
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
			//NTHARRE: 13Aug-2021: Added for SFSTRY0001059,SFSTRY0001317
			if(($("#manualreason").val()!="" && $("#manualreason").val()!=null) && ((divtype == "STORE" && divsubtype == "STORE") || (divtype == "DIRECT" && divsubtype =="CSC"))){
			if($("#manualsubreason").val()!="" && $("#manualsubreason").val()!=null)
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Manual Order Sub Reason",subReason);
			if($("#couponnotwrkng").val()!="" && $("#couponnotwrkng").val()!=null && $("#manualsubreason").val() == "Coupon not Working"){
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Coupon Not Working",Notwrkngcpn);
			}
			else{
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Coupon Not Working","");
				$("#couponnotwrkng").val("");
			}
			}
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
			document.getElementById("subtype").value = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sub-Type");
			//RCHATHAR: For defect number 710
			document.getElementById("SC-source-order").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Ext Order Number");
			SC_OUI_Methods.PH_USFormat_Save("prefconmethod",SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Preferred Contact"));
			SiebelJS.Log("Req Flag:"+SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Code Req"));
			if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Code Req")=="Y"){
				 $("#SC-SO-Coupon-popup").modal({
					backdrop: 'static'
				});
				$(".modal-backdrop").css('background', '#ffffff');

				$("#SC-SO-Coupon-popup").css({
					"display": "flex",
					"justify-content": "center",
					"align-items": "center"
				});
			}
			$("#SC-SO-save-block").hide();
			$("#SC-SO-edit-block").show();
			$("#SC-search-icon-referreby").hide();
			$("#SC-search-icon-Address").hide();
			$("#SC-sales-show-store-icon").hide();
			$(".SC-SO-input").css({
				"pointer-events": 'none',
				"border": "1px solid #194571"
			});
			$(".SC-checkbox-white-square").css({
               "pointer-events": 'none'
			});
			OrderId=localStorage.getItem('OrderId');
			if(OrderId!=null && OrderId!=""){
				var inPS = SiebelApp.S_App.NewPropertySet();
				var outPS = SiebelApp.S_App.NewPropertySet();
				inPS.SetProperty("OrderId",OrderId);
				SiebelJS.Log("Invoking Business Service");
				Bservice = SiebelApp.S_App.GetService("SC Get Line Items");
				outPS = Bservice.InvokeMethod("Query",inPS); 
				SiebelJS.Log("exiting Business Service");
				//to show refreshed line items
				Lov1=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_MANUAL_DISCOUNT_REASON' and [Active] = 'Y'");
				Lov2=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'DISCNT_PERCENT' and [Active] = 'Y'");
				isStoreUser=RecordSet[0]["SC Store User"];
				SC_OUI_Markups.prodmarkup(outPS,Lov1,Lov2,isStoreUser);
			
				//to get order total and discounts 
				SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
				if($("#scproductinfodiv").is(":visible")){
				document.getElementById('bottotal').innerHTML = "$"+(parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total")).toFixed(2))-parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")).toFixed(2))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
				document.getElementById('toptotal').innerHTML = "$"+((Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total")))-(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
				document.getElementById('topdisc').innerHTML = "$"+Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Item Discount")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
				document.getElementById('topstart').innerHTML = "$"+Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Base Price")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
			  }
			}
			
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Cancel Reason");
			$(".read-mode-admin,.read-mode-human,.read-mode-revise").css({
				"pointer-events": 'none',
				"border-bottom": "1px solid #194571"
			});
			$("#SC-sales-team-icon").hide();
			$("#SC-sales-location-icon").hide();
			$("#SC-sales-show-store-icon").show();
			}
			}
			});
		//});
		
		//on click of cancel changes
		 $("#SC-SO-sales-cancel-changes").click(function() {
			$(".attachmentitem").hide();
			$("#SC-add-new-Attach").hide();
			$("#SC-sales-team-icon").hide();
			$("#SC-shownum-icon").hide();
			$("#SC-sales-show-store-icon").hide();
			$("#SC-coupon-icon").hide();
			$("#SC-coupon-code").addClass("SC-readonly");
			 $("#SC-coupon-name").addClass("SC-readonly");
			  $("#SC-coupon-code").css({
					"pointer-events": 'none'
			  });
			   $("#SC-coupon-name").css({
					"pointer-events": 'none'
			  });
			 var manualreason = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Manual Order Reason");
		     var custDetails_Markup = '';
			custDetails_Markup += '  <label class="item-label">Manual Order Reason:</label>';
			custDetails_Markup += '  <input type="text" name="" class="SC-SO-input SC-applets" id="manualreason" value="'+manualreason+'">';
     		$('#manualreasonblock').html(custDetails_Markup);
			if(manualreason==""){
			  $("#manualreason").val("");	
			  $("#manualsubreason").val("");	
			}
			//NTHARRE: 13Aug2021: Added for SFSTRY0001059
			var manualsubreason = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Manual Order Sub Reason");
		    var custDetails_Markup1 = '';
			custDetails_Markup1 += '  <label class="item-label">Manual Order Sub Reason:</label>';
			custDetails_Markup1 += '  <input type="text" name="" class="SC-SO-input SC-applets" id="manualsubreason" value="'+manualsubreason+'">';
		    $('#manualsubreasonblock').html(custDetails_Markup1);
			if(manualsubreason == "Coupon not Working"){
				$("#CouponNotWrkngblock").show();
				var custDetails_Markup2 = '';
				var cpntwrkng = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Not Working");
				custDetails_Markup2 += '  <label class="item-label">Coupon Not Working:</label>';
				if(cpntwrkng !="" && cpntwrkng !=null)
				custDetails_Markup2 += '  <input type="text" name="notwrkngcoupon" class="SC-SO-input SC-applets" id="couponnotwrkng" value="'+cpntwrkng+'">';
				 else
				custDetails_Markup2 += '  <input type="text" name="" class="SC-SO-input SC-applets" id="couponnotwrkng" value="">';
				$('#CouponNotWrkngblock').html(custDetails_Markup2);
			}
			else{
				$("#CouponNotWrkngblock").hide();
			}
			
			
			var Addrid=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Bill To Address Id");
			var markup="";
			if(Addrid!=="No Match Row Id"&&Addrid!==""){
				if(!parentJSON.hasOwnProperty(Addrid)){
					var BilltoAddrDetails;
					if(AccountOrder==true)
						BilltoAddrDetails=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Primary Bill To Address");
					else
						BilltoAddrDetails=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Con Bill To Address");
					$("#sc-billtoaddr-tittle").attr("title", BilltoAddrDetails);
					markup += '<option class="SC-SO-Option">' + BilltoAddrDetails + '</option>';
				}
				else{
					$("#sc-billtoaddr-tittle").attr("title", parentJSON[Addrid]);
					markup += '<option class="SC-SO-Option">' + parentJSON[Addrid] + '</option>';
				}
			}
		else{
			$("#sc-billtoaddr-tittle").attr("title","");
			markup += '<option class="SC-SO-Option"></option>';
		}			
		for (var j = 0; j < billAddList.length; j++) {
			if(billAddList[j] != "")
			{
				var addr_JSON = JSON.parse(billAddList[j]);
				if(addr_JSON["Id"]!=Addrid)
				{
				markup += '<option class="SC-SO-Option">' + addr_JSON["Address Name"] + '</option>';
				}
			}
		}
		if(markup == '')
			markup += '<option class="SC-SO-Option"></option>';
		   $("#addressto").html(markup);
			SiebelJS.Log(pm);
			document.getElementById("orderstatus").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Status");
			document.getElementById("holdreason").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Delivery Block");
			document.getElementById("subtype").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sub-Type");
			document.getElementById("SC-coupon-name").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Name");
			//document.getElementById("manualreason").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Manual Order Reason");
			document.getElementById("SC-manual-commnets").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Manual Comments");
			if(AccountOrder==false){
			document.getElementById("omuseronly").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Comments");
			}
			else{
			document.getElementById("ponumber").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Purchase Order Number");
			//document.getElementById("storeshow").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Store Number");
			document.getElementById("prefconmethod").value=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Preferred Contact");
			}
			SC_OUI_Methods.PH_USFormat_Save("prefconmethod",SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Preferred Contact"));
			
			if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Tax Exempt")=='Y'){
				$('#teoh').prop('checked', true);
				$("#clip-img").show();
			}
			else{
				$('#teoh').prop('checked', false);
				$("#clip-img").hide();
			}
			
			$("#SC-order-date").val(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Date"));
			
			$("#SC-SO-save-block").hide();
			$("#SC-SO-edit-block").show();
			$("#SC-search-icon-referreby").hide();
			$("#SC-search-icon-Address").hide();
			$(".SC-SO-input").css({
				"pointer-events": 'none',
				"border": "1px solid #194571"
			});
			$(".SC-checkbox-white-square").css({
               "pointer-events": 'none'
			});
			$(".read-mode-admin,.read-mode-human,.read-mode-revise").css({
				"pointer-events": 'none',
				"border-bottom": "1px solid #194571"
			});
			$("#SC-sales-location-icon").hide();
			$("#SC-sales-team-icon").hide();
			$("#SC-sales-show-store-icon").show();
		});
		
		$("#sc-cp-apply").click(function() {
				$('#custommaskoverlay').show();
				setTimeout(function(){
					var sCuopncode=document.getElementById("SC-Coupon-value").value;
					if(sCuopncode!="" && sCuopncode!=null){
						var promId=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Id");
						var scustNumber=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Ship To Customer Number");
						var Custom_Servicec="",Input_BSc="",Out_BSc="",Csearchfields;
						var CouSearchSpec = "([Effective Start Date] IS NULL OR [Effective Start Date]<=today()) AND ([Effective End Date] IS NULL OR [Effective End Date]>=today()) AND [Product Id]='"+promId+"' AND [SC Coupon Code]='"+sCuopncode+"'";
						Custom_Servicec = SiebelApp.S_App.GetService("SC Custom Query");
						Input_BSc = SiebelApp.S_App.NewPropertySet();
						Out_BSc = SiebelApp.S_App.NewPropertySet();
						Csearchfields = "Id";
						Input_BSc.SetProperty("BO", "ISS Promotion");
						Input_BSc.SetProperty("BC", "Product Eligibility BusComp");
						Input_BSc.SetProperty("SearchSpecification", CouSearchSpec);
						Input_BSc.SetProperty("SortSpecification", "");
						Input_BSc.SetProperty("ReqNoOfRecords", "");
						Input_BSc.SetProperty("FieldsArray", Csearchfields);
						Out_BSc = Custom_Servicec.InvokeMethod("Query", Input_BSc);
						var Child_BS = Out_BSc.GetChild(0);
						var BS_Data = Child_BS.GetProperty("OutputRecordSet");
						if(BS_Data!="}"){
						//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Coupon Code",document.getElementById("SC-Coupon-value").value);
						SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().ExecuteMethod("SetFormattedValue", SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetControls()["Coupon Code"],document.getElementById("SC-Coupon-value").value);
					//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().InvokeMethod("RefreshRecord");
					//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");	
						if(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Coupon Code Req")== "N"){
						OrderId=localStorage.getItem('OrderId');
						if(OrderId!=null && OrderId!=""){
							var inPS = SiebelApp.S_App.NewPropertySet();
							var outPS = SiebelApp.S_App.NewPropertySet();
							inPS.SetProperty("OrderId",OrderId);
							SiebelJS.Log("Invoking Business Service");
							Bservice = SiebelApp.S_App.GetService("SC Get Line Items");
							outPS = Bservice.InvokeMethod("Query",inPS); 
							SiebelJS.Log("exiting Business Service");
							//to show refreshed line items
							Lov1=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_MANUAL_DISCOUNT_REASON' and [Active] = 'Y'");
							Lov2=SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'DISCNT_PERCENT' and [Active] = 'Y'");
							isStoreUser=RecordSet[0]["SC Store User"];
							SC_OUI_Markups.prodmarkup(outPS,Lov1,Lov2,isStoreUser);
						
							//to get order total and discounts 
							SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
							if($("#scproductinfodiv").is(":visible")){
							document.getElementById('bottotal').innerHTML = "$"+(parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total")).toFixed(2))-parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")).toFixed(2))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
							document.getElementById('toptotal').innerHTML = "$"+((Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total")))-(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
							document.getElementById('topdisc').innerHTML = "$"+Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Item Discount")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
							document.getElementById('topstart').innerHTML = "$"+Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Base Price")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
						  }
						}
						$("#SC-SO-Coupon-popup").modal('hide');
							$("#SC-SO-Coupon-popup").css({
								"display": "",
								"justify-content": "",
								"align-items": ""
							});
						//document.getElementById("SC-coupon-code").value = document.getElementById("SC-Coupon-value").value;
						document.getElementById("SC-Coupon-value").value="";
					 }
					}
					else{
						alert("Coupon code is invalid");
					}
				}
				 $('#custommaskoverlay').hide();
				},500);
				
			
			
		});
		$("#sc-cp-cancel").click(function() {
			$('#custommaskoverlay').show();
			setTimeout(function(){
			 document.getElementById("SC-Coupon-value").value="";
			document.getElementById("SC-coupon-name").value="";
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Coupon Name","");
			SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Coupon Code","");
				$("#SC-SO-Coupon-popup").modal('hide');
				$("#SC-SO-Coupon-popup").css({
					"display": "",
					"justify-content": "",
					"align-items": ""
				});
				$('#custommaskoverlay').hide();
			},500);
		});
    }//bindevents

    SCSalesOrderCreateFormAppletPR.prototype.EndLife = function () {
     SiebelAppFacade.SCSalesOrderCreateFormAppletPR.superclass.EndLife.apply(this, arguments);
		$(document).unbind();
		$("#"+Appletid).html("");
		localStorage.setItem("isNewSalesOrder","N");
		
	 }
	
	//get line items for Order summmary
	function getlineitems(outPS){
		var lineitems_markup="";
		var order_refundtotal=0.00;
		SiebelJS.Log("entered");
		for(var pr=0;pr<outPS.GetChild(0).GetChildCount();pr++){
			SiebelJS.Log(outPS.GetChild(0).GetChild(pr).GetProperty("Fulfillment Status Code"));
			if(outPS.GetChild(0).GetChild(pr).GetProperty("Fulfillment Status Code")!="Shipped"){
				lineitems_markup+='                                    <tr class="refund-bg">';
				lineitems_markup+='                                        <td class="so-padding-left">'+outPS.GetChild(0).GetChild(pr).GetProperty("SC Calc Long Description")+'</td>';
				lineitems_markup+='                                        <td class="so-sec-padding-left">'+outPS.GetChild(0).GetChild(pr).GetProperty("Fulfillment Status Code")+'</td>';
				lineitems_markup+='                                        <td class="so-thd-padding-left">$'+Number.parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("SC Line Total NRC")).toFixed(2)+'</td>';
				lineitems_markup+='                                    </tr>';
				order_refundtotal+=outPS.GetChild(0).GetChild(pr).GetProperty("SC Line Total NRC")!=""?parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("SC Line Total NRC")):0.00;
			}
			else{
				lineitems_markup+='                                    <tr class="disabled-bg">';
				lineitems_markup+='                                        <td class="so-padding-left">'+outPS.GetChild(0).GetChild(pr).GetProperty("SC Calc Long Description")+'</td>';
				lineitems_markup+='                                        <td class="so-sec-padding-left">'+outPS.GetChild(0).GetChild(pr).GetProperty("Fulfillment Status Code")+'</td>';
				lineitems_markup+='                                        <td class="so-thd-padding-left">$'+outPS.GetChild(0).GetChild(pr).GetProperty("SC Line Total NRC")+'</td>';
				lineitems_markup+='                                    </tr>';
			}
		}
		$("#refundamount").html("$"+order_refundtotal.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
		return lineitems_markup;
	}
		
		
	//this fucntion fetches all the addresses for bill to address dropdown	
	function AttachAddresses() {
		var RecordSetb=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().Get("GetRecordSet");
		var Addrid=RecordSetb[0]["Bill To Address Id"];
		if(AccountOrder!=true){
			conId = RecordSetb[0]["Bill To Contact Id"];
			var search_Spec = "[Contact Id] = '" + conId + "' AND ([End Date] IS NULL  OR [End Date] > TODAY())";
			var Fields = "Id,Address Name";
			//var Addrid=RecordSetb[0]["SC Bill To Contact Address Id"];
			var addList = SC_OUI_Methods.GetContactAddressesList("Contact","FINS Contact Address",search_Spec,Fields);
			billAddList=addList;
		}
		else{
			BillToAccid = RecordSetb[0]["Bill To Account Id"];
			var search_Spec="[Account Id] = '" + BillToAccid + "'";
			var Fields = "Id,Address Name";
			//var Addrid=RecordSetb[0]["SC Bill To Account Address Id"];
			var addList = SC_OUI_Methods.GetContactAddressesList("Account","CUT Address for Account/Contact",search_Spec,Fields);
		}
		markup="";
		for (var j = 0; j < addList.length; j++){
			if(addList[j] != ""){
				var addr_JSON = JSON.parse(addList[j]);
				var DetailAddlist={};
				parentAddrJSON[addr_JSON["Address Name"]]=addr_JSON["Id"];
				parentJSON[addr_JSON["Id"]]=addr_JSON["Address Name"];
			}	
		}
		if(Addrid!=="No Match Row Id"&&Addrid!==""){
			$("#sc-billtoaddr-tittle").attr("title", parentJSON[Addrid]);
			markup += '<option class="SC-SO-Option">' + parentJSON[Addrid] + '</option>';
		}
		else{
			$("#sc-billtoaddr-tittle").attr("title","");
			markup += '<option class="SC-SO-Option"></option>';
		}			
		for (var j = 0; j < addList.length; j++) {
			if(addList[j] != "")
			{
				var addr_JSON = JSON.parse(addList[j]);
				if(addr_JSON["Id"]!=Addrid)
				{
				markup += '<option class="SC-SO-Option">' + addr_JSON["Address Name"] + '</option>';
				}
			}
		}
		if(markup == '')
			markup += '<option class="SC-SO-Option"></option>';
		return 	markup;
	}
	
	
	
	
    return SCSalesOrderCreateFormAppletPR;
   }()
  );
  return "SiebelAppFacade.SCSalesOrderCreateFormAppletPR";
 })
}
