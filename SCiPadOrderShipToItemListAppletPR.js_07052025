/*********************
Author: Harish Kolla
Created Date: 28-Nov-2017
Purpose: Developing Order Shipping Functionality with Open UI
Modified Date:
**********************/
//Applet: SC Order Entry - Line Item List Applet (Sales) - Short OUI
if (typeof (SiebelAppFacade.SCiPadOrderShipToItemListAppletPR) === "undefined")
{

  SiebelJS.Namespace("SiebelAppFacade.SCiPadOrderShipToItemListAppletPR");
  define("siebel/custom/SelectComfort/SCiPadOrderShipToItemListAppletPR", ["siebel/jqgridrenderer", "siebel/custom/SelectComfort/moment", "siebel/custom/SelectComfort/moment-timezone-with-data.min", "siebel/custom/SelectComfort/SC_OUI_Markups", "siebel/custom/SelectComfort/bootstrap.min", "siebel/custom/SelectComfort/jquery.validate.min", "siebel/custom/SelectComfort/SCiPadOrderShipToLineItemMarkup", "siebel/custom/SelectComfort/SCiPadSalesOrderMarkup", "siebel/custom/SelectComfort/SCErrorCodes", "siebel/custom/SelectComfort/SCErrorCodes", "siebel/custom/SelectComfort/SC_OUI_Methods", "siebel/custom/SelectComfort/SC_OUI_Definitions"], //"siebel/custom/SelectComfort/SCSalesOrderMarkup"],
    function ()
    {
      SiebelAppFacade.SCiPadOrderShipToItemListAppletPR = (function ()
      {

        var pm = '',
          SiebelConstant = '',
          SCOrderShipMarkup = '',
          disaflag = "",
          shippingItemsRecordSet = '',
          Lov_Per = '',
          Lov_Dis = '',
          ProductTypeCode, billToContactRecordSet = '',
          conSearch_RS = '',
          Accid = "",
          Accname = "",
          sc_rowid, conId, line_row_id, addList, ShipFieldQueryPair = {},
          ShipToContactRecordSet, FieldQueryPair;
        var searchCount = 2;
        var sFields = ['Last Name', 'Postal Code'];
        SiebelConstant = SiebelJS.Dependency("SiebelApp.Constants");
        SCOrderShipMarkup = SiebelJS.Dependency("SiebelAppFacade.SCiPadOrderShipToLineItemMarkup");
        var ErrorCodesfn = SiebelJS.Dependency("SiebelApp.SCErrorCodes");
        var SC_OUI_Methods = SiebelJS.Dependency("SiebelApp.SC_OUI_Methods");
        var SC_OUI_Markups = SiebelJS.Dependency("SiebelApp.SC_OUI_Markups");
        var SC_OUI_Definitions = SiebelJS.Dependency("SiebelApp.SC_OUI_Definitions");
        var SCSalesCreateMarkup = SiebelJS.Dependency("SiebelApp.SCiPadSalesOrderMarkup");
        var SCErrorCodes = SiebelJS.Dependency("SiebelApp.SCErrorCodes");
        var SCfrieght = 'N';
        var SCfrieghtValidation = 'N';
        var SCfrieghtCalculation = 'N';
        var SCVerify = 'N';
        var SCVerifyErr = 'N';
        var SC_orderStatus;
        var SC_Order_PMinstance = "";
        var OrderItemDetails = "";
        var addnewcontact_lineitem = "N";
        var searchcontact_lineitem = "N",
          scAccountOrder = false;
        var SC_OrderHeader_PMinstance = "";
        var appletSeq;
        var BindData = 'N',
          scRefresh = "N";
        var lovArray_ShipMethods;
        var parentJSON = {},
          poleJSON = [],
          subpoleJSON = [];;
        var parentAddrJSON = {};
        var orderid = "";
        var Addr_line_row_id;
        var NewAddrLineLevel = 'N';
        var lineitemrcdset;
        var phn_line_row_id;
        var OrderDate;
        var AddrListJSON = {};
        var AddrHDEligible = {};
        var AddrServiceLevel = {};
        var sc_reffid = "";
        var sP2PEFlag = "";
        var refsearchfields = "",
          refsearchCount = 2,
          currentValue = "",
          next = 1,
          csearchfields, sChangeContactClicked = "N";
        var primaryornot, POSRegArray = new Array,
          accAddr = "N",
          backToShip = 'N',
          refBy = "N",
          refByFlag = "N",
          sTierEligbleVal = "N",
          sc_addr_id, sc_phnnumber, primarycontactid, Sc_ship_contactid, ChnageContactloaded, isShipToAcc, PrContactName, isOrder360;
        var ignoreErrorCodes = ["SC_INVOKE_TAX_CAL", "SC_PMNT_AMT", "SC_ORDER_VERIFIED", "SC_NON_TAXABLE_DISC", "SC_ORDER_DATE", "SC_HOLD_REASON", "SC_VOID_ORDER_SUBMIT", "SC_RPS_DOWNLOAD"];
        var VQuoteValidUntillDate = "";
        var VPersonalizedMsg = "";
        var Vqemailchngflg = "N";
        var jsonDeliveryTier = {}; //SL;Added for Tier Delivery
        var bRefreshShipMethod; //SL;Added for Tier Delivery;DF-1975
        var deliveryTierArray = []; //SL;Added for Tier Delivery
        //var conSearch_RS=""
        //var bootstrapTooltip = $.fn.tooltip.noConflict();
        //	$.fn.bstooltip = bootstrapTooltip;
        function SCiPadOrderShipToItemListAppletPR(pm)
        {
          SiebelAppFacade.SCiPadOrderShipToItemListAppletPR.superclass.constructor.apply(this, arguments);
        }

        SiebelJS.Extend(SCiPadOrderShipToItemListAppletPR, SiebelAppFacade.JQGridRenderer);


        SCiPadOrderShipToItemListAppletPR.prototype.Init = function ()
        {
          SiebelAppFacade.SCiPadOrderShipToItemListAppletPR.superclass.Init.apply(this, arguments);
          primaryornot = localStorage.getItem("flowfrom");
          SiebelJS.Log("Shipping - Init");
          pm = this.GetPM();
          var appletId = pm.Get("GetFullId");
          //appletSeq = appletId[appletId.length -1];
          appletId = appletId.split("_A");
          appletId = appletId[1];
          appletSeq = appletId;
          SCVerify = 'N';
          SCfrieght = 'N';
          SCfrieghtValidation = 'N';
          SCfrieghtCalculation = 'N';
          backToShip = 'N';
          isShipToAcc = "N";
          accAddr = "N";
          ChnageContactloaded = 'N';
          sChangeContactClicked = "N";
          sTierEligbleVal = "N";
          $('#CommunicationPanelContainer').css("padding-top", "77px");
          pm.AddProperty("AddReferralFlg", false);
          //SL;Tier Delivery - stores the sort order for tiers
          deliveryTierArray = SiebelApp.SC_OUI_Methods.GetLOVs("[Type] = 'SN_TEIR_DELIVERY_MTRX' AND [Active] = 'Y'", "Order By");
          for (var i = 0; i < deliveryTierArray.length; i++)
          {
            jsonDeliveryTier[deliveryTierArray[i]] = i + 1;
          }
          bRefreshShipMethod = false; //SL;Added for Tier Delivery;DF-1975
        }

        SCiPadOrderShipToItemListAppletPR.prototype.ShowUI = function ()
        {
          SiebelAppFacade.SCiPadOrderShipToItemListAppletPR.superclass.ShowUI.apply(this, arguments);
          SiebelJS.Log("Shipping - ShowUI");

          $("#_swescrnbar").hide();
          $("#_swethreadbar").hide();
          $(".siebui-button-toolbar").hide();
          $("#_sweappmenu").hide();
          sFields = ['Last Name', 'Postal Code'];
          //SBOORLA:finding the order is B2B or B2C
          ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
          //if(ShipToContactRecordSet[0]["Bill To Account Id"]!=null&&ShipToContactRecordSet[0]["Bill To Account Id"]!=""){
          if (ShipToContactRecordSet[0]["SC Sub-Type"] == "Wholesale" || ShipToContactRecordSet[0]["SC Sub-Type"] == "QVC" || ShipToContactRecordSet[0]["SC Sub-Type"] == "Commercial" || ShipToContactRecordSet[0]["SC Sub-Type"] == "Internal" || ShipToContactRecordSet[0]["SC Sub-Type"] == "HSN")
          {
            scAccountOrder = true;
          }
          else
            scAccountOrder = false;

          var shipDetails = SCOrderShipMarkup.ShipOptionsMarkup();
          $("#Ship-Option-Markup").html(shipDetails);
          $("#Ship-Option-Markup").hide();

          var defaultShipping = SCOrderShipMarkup.DefaultShippingMarkup(scAccountOrder);
          $("#Default-Shipping").html(defaultShipping);
          $("#Default-Shipping").hide();

          var shippingDetails = SCOrderShipMarkup.ShippingDetails();
          $("#Shipping-Detils").html(shippingDetails);
          //SC_OUI_Methods.PrimaryButton(pm, 'shipping-pagination');
          $("#Shipping-Detils").hide();

          var shippingCreateNewContact = SCOrderShipMarkup.Shipping_CreateNewContact();
          $("#SC-add-contact").html(shippingCreateNewContact);

          var shippingCreateNewAddress = SCOrderShipMarkup.Shipping_CreateNewAddress();
          $("#SC-add-address").html(shippingCreateNewAddress);

          //NOTE: Selct Contact markup has been already appended in 

          var shippingVerify = SCOrderShipMarkup.Shipping_Verify();
          //SiebelJS.Log(shippingVerify);
          $("#SC-SO-CF-verify").html(shippingVerify);

          var shippingCFSucess = SCOrderShipMarkup.Shipping_CF_Success();
          $("#SC-SO-CF-success").html(shippingCFSucess);
          var shippingCFFail = SCOrderShipMarkup.Shipping_CF_Failure();
          $("#SC-SO-CF-failure").html(shippingCFFail);
          var mystoremarkup = SCOrderShipMarkup.MyStoreLocation_Verify();
          $("#SC-SO-my-store").html(mystoremarkup);
          var storechangemarkup = SCOrderShipMarkup.StoreLocation_Verify();
          $("#SC-SO-store-location").html(storechangemarkup);

          var shippingSummary = SCOrderShipMarkup.ShippingSummary();
          $("#SC-SO-ShippingSummary").html(shippingSummary);
          $("#SC-SO-ShippingSummary").hide();
          //Adding CustomerMarkup 
          customtimermarkup = SC_OUI_Markups.CustomTimer();
          $('#applet1').append(customtimermarkup);
          errormarkup = SCSalesCreateMarkup.SCOrderErrorBlock();
          $("#SC-error-block").html(errormarkup);
          if ($("#SC-error-block").is(":visible"))
            $("#CommunicationPanelContainer").css("cssText", "padding-top: 132px !important;");
          // Adding Request_Referral_Markup
          var requestreferralmarkup = SCOrderShipMarkup.Request_Referral_Markup();
          $("#SC-SO-RR-popup").html(requestreferralmarkup);
          SC_OrderHeader_PMinstance = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
          SC_Order_PMinstance = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp();
          ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
          orderid = ShipToContactRecordSet[0]["Id"];
          SiebelJS.Log("billToContactRecordSet::" + JSON.stringify(ShipToContactRecordSet));
          OrderItemDetails = SC_Order_PMinstance.GetRecordSet();
          Accid = ShipToContactRecordSet[0]["Bill To Account Id"];
          Accname = ShipToContactRecordSet[0]["Bill To Account"];
          conId = ShipToContactRecordSet[0]["Ship To Contact Id"];
          SiebelJS.Log("conId::" + conId);
          var updateaccount = "N";
          var sc_fst_name = "";
          var sc_lst_name = "";
          // VAMSI:08-OCT-18: Modified the below condtions to Support P2PE pole Display.
          sP2PEFlag = SiebelApp.S_App.GetProfileAttr('P2PEFlag');

          sc_addr_id = "";
          sc_phnnumber = "";
          Sc_ship_contactid = "";
          primarycontactid = "";
          PrContactName = "";
          //if(Accname !=""&&(conId==null||conId==""||conId=="undefined")){
          if (scAccountOrder)
          {
            if (localStorage.getItem("isAccNewSalesOrder") == "Y")
            {
              localStorage.setItem("isAccNewSalesOrder", "N");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Account Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
              ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
              $("#shiptoaccount").val('');
            }
            primarycontactid = ShipToContactRecordSet[0]["SC Account Primary Contact Id"];
          }

          OrderDate = ShipToContactRecordSet[0]["Order Date"];
          conId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Ship To Contact Id");
          SiebelJS.Log("scShipToContactId" + conId);
          if (!scAccountOrder)
          {
            var ShipToContactName = ShipToContactRecordSet[0]["Primary Ship To First Name"] + " " + ShipToContactRecordSet[0]["Primary Ship To Last Name"];
            $("#Ship-Default-Name").html(ShipToContactName);
            //}
            var mblNumb_def = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Preferred Contact");
            //PH_USFormat_Save
            if (mblNumb_def != '' && mblNumb_def.match(/^\d+$/) && mblNumb_def.length == 10)
            {
              var USFormt_mblNum = '';
              USFormt_mblNum = "(" + mblNumb_def.substring(0, mblNumb_def.length - 7) + ") " + mblNumb_def.substring(3, mblNumb_def.length - 4) + "-" + mblNumb_def.substring(6, mblNumb_def.length);
              mblNumb_def = USFormt_mblNum;
            }
            $("#Ship-Default-PhNumber").val(mblNumb_def);
            SiebelJS.Log("conId::" + conId);
          }

          //local storage for searchfields count
          if (localStorage.getItem("SearchCount") == undefined || localStorage.getItem("SearchCount") == null || localStorage.getItem("SearchCount") == 0)
          {
            localStorage.setItem('SearchCount', 2);
          }
          else
          {
            searchCount = localStorage.getItem('SearchCount');
          }

          // loading waiting time
          $(document).ready(function ()
          {
            $("body").bind('Custom.Start', function (ev)
            {
              $('#maskoverlay').show();
              SiebelJS.Log("Start");
            });

            $("body").bind('Custom.End', function (ev)
            {
              $('#maskoverlay').hide();
              SiebelJS.Log("Stop");
            });
          });
          // enabling search box
          $(".con-search-box").each(function ()
          {
            if ($(this).val().length != 0 && $(this).val() != "*")
            {
              $("#sc-ship-con-search").removeClass('SC-disabled');
              return false;
            }
            else
            {
              $("#sc-ship-con-search").addClass('SC-disabled');
            }
          });

          if (localStorage.getItem('ComingFromPayments') == "Y")
          {
            localStorage.setItem("ComingFromPayments", "N");
            localStorage.setItem("flowfrom", "proceed");
            localStorage.setItem('ProceedToShipping', 'Y');
            //SCHERKU: For Defect 594
            //if order details section is open closed it
            if ($('.OrderDetailsclose').hasClass('iconOpen'))
            {
              $(".OrderDetailsclose").click();
            }

            //if line details section is open close it
            if ($('.lineitemsopen').hasClass('iconOpen'))
            {
              $('.lineitemsopen').click();
            }
            FieldQueryPair = {
              "SKU #": ""
            };
            SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");
            $("#browsecatalogdiv").hide();
            $('.SC-SO-noresults-container').hide();
            $("#sccataloguecategory").hide();
            $("#scproductstable").hide();
            $("#Ship-Option-Markup").show();
            $("#Default-Shipping").show();
            $('.modal-backdrop').remove();
            //$("#Shipping-Detils").show();
          }
          isOrder360 = "N";
          if (localStorage.getItem('ComingFromOrder360') == "Y")
          {
            isOrder360 = "Y";
            //localStorage.setItem("ComingFromOrder360", "N");
            $("#Ship-Option-Markup").hide();
            $("#Default-Shipping").hide();
            $("#Shipping-Detils").hide();
            $("#browsecatalogdiv").hide();
            $("#sccataloguecategory").hide();
            $("#scproductstable").hide();
            $("#SC_Order_ship_markup").show();
            $("#SC_Order_ship_markup1").show();
            $("#SC_Order_ship_markup2").show();
            $("#footerbutton").show();
			 $(".SC-Discount-button").show(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").show(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").show();//Sukumar 03/25 to hide discount button
$(".coupdescdel").show(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").show();//Sukumar 03/25 to hide discount button
$(".addonsdel").show();
			if($('[id^=ProductCoupon]')[0].innerText === "no coupons applied"){$('[id^=ProductCoupon]').prev().hide()}
			  if($('[id^=scmanualcouponval]')[0].innerText === "no coupons applied"){$('[id^=scmanualcouponval]').prev().hide()}
            if (scAccountOrder)
              $("#SC-SO-ShipSummary-DefaultAddress").html(ShipToContactRecordSet[0]["Primary Bill To Address"]);
            else
              $("#SC-SO-ShipSummary-DefaultAddress").html(ShipToContactRecordSet[0]["SC Con Ship To Address"]);
            var Custom_Service = SiebelApp.S_App.GetService("SC Custom Query");
            var InputArg = SiebelApp.S_App.NewPropertySet();
            var OutputArg = SiebelApp.S_App.NewPropertySet();
            var Fields = "Ship Method,Product Line,SC Ship To Address Name,SC Line Total NRC,Request To Cancel,Start Price,SC Total Line Discounts,NRC CxTotal in Header Currency,Tax Amount,Ship To First Name,Ship To Last Name,Shipping";
            InputArg.SetProperty("BO", "Order Entry (Sales)");
            InputArg.SetProperty("BC", "Order Entry - Line Items");
            InputArg.SetProperty("SearchSpecification", "[Order Number] = '" + ShipToContactRecordSet[0]["Order Number"] + "'");
            InputArg.SetProperty("FieldsArray", Fields);
            OutputArg = Custom_Service.InvokeMethod("Query", InputArg);
            var Child_OutArg = OutputArg.GetChild(0);
            var BS_Data_Addresses = Child_OutArg.GetProperty("OutputRecordSet");
            SiebelJS.Log("BS_Data_Addresses--" + JSON.stringify(BS_Data_Addresses));
            var Addres_Array = BS_Data_Addresses.split(";");
            SCOrderShipMarkup.ShippingSummaryMarkup(Addres_Array);
            var inPS = SiebelApp.S_App.NewPropertySet();
            var outPS = SiebelApp.S_App.NewPropertySet();
            var Bservice = "";
            inPS.SetProperty("OrderId", orderid)
            SiebelJS.Log("Invoking Business Service");
            Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
            outPS = Bservice.InvokeMethod("Query", inPS); //invoke the method
            SiebelJS.Log("childcount" + JSON.stringify(outPS.GetChild(0).GetChildCount()));
            for (var ps = 0; ps < outPS.GetChild(0).GetChildCount(); ps++)
            {
              SiebelJS.Log(outPS.GetChild(0).GetChild(ps).GetProperty("SC Calc Long Description"));
              for (var pr = 0; pr < outPS.GetChild(0).GetChild(ps).GetChildCount(); pr++)
              {

                SiebelJS.Log("child" + outPS.GetChild(0).GetChild(ps).GetChild(pr).GetProperty("SC Calc Long Description"));
              }

            }
            var shippingcost = outPS.GetChild(0).GetProperty("Shipping cost");
            var shippinglinediscounts = outPS.GetChild(0).GetProperty("Shipping Line Discounts");
            SiebelJS.Log("Shipping cost" + outPS.GetChild(0).GetProperty("Shipping cost"));
            SiebelJS.Log("Shipping Line Discounts" + outPS.GetChild(0).GetProperty("Shipping Line Discounts"));
            productsmarkup = getordersummarylineitems(outPS);
            $("#SC-products-summary").html(productsmarkup);
            var OrderDetailPMinstance = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
            allproductmarkup = SC_OUI_Methods.OrderSummary(OrderDetailPMinstance, shippingcost, shippinglinediscounts);
            $("#SC-all-products-total").html(allproductmarkup);
            //SC_OUI_Markups.prodmarkup(outPS,Lov_Dis,Lov_Per);
            //to get order total and discounts 
            localStorage.setItem("flowfrom", "proceed");

            //if order details section is open closed it
            if ($('.OrderDetailsclose').hasClass('iconOpen'))
            {
              $(".OrderDetailsclose").click();
            }

            //if line details section is open close it
            if ($('.lineitemsopen').hasClass('iconOpen'))
            {
              $('.lineitemsopen').click();
            }
            FieldQueryPair = {
              "SKU #": ""
            };
            SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");
            $("#browsecatalogdiv").hide();
            $('.SC-SO-noresults-container').hide();
            $("#sccataloguecategory").hide();
            $("#scproductstable").hide();
            $("#Ship-Option-Markup").hide();
            $("#Default-Shipping").hide();
            $(".edit-details").hide();
            if ($(".customline").is(":visible"))
              $(".customline").siblings(2).css("cssText", "padding-left: 7% !important;");
            $(".deleteline").hide();
            $(".prodcoupon").hide();
            $(".discount-btn").hide();
            $(".customline").hide();
            $(".displaybed").addClass("SC-readonly");
            $(".quantitybox").addClass("input-readonly");
            $(".amount-width").addClass("input-readonly");
            $(".overflow-title").css("cssText", "margin-left:30px !important");
            $(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
			$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
			$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
            
          }

          $("#SC_QuoteValidDt").datepicker(
          {
            dateFormat: 'mm/dd/yy',
            minDate: 0,
            changeYear: true,
            changeMonth: true,
            buttonImageOnly: true,
            showOn: 'button',
            buttonText: 'Show Date',
            buttonImage: 'images/custom/Calender_blue.png',
            onSelect: function (dateText, inst)
            {
              $("#SC_QuoteValidDt").parent().addClass("is-active is-completed");
            },
            showButtonPanel: true
          });
        } //End of ShowUI

        SCiPadOrderShipToItemListAppletPR.prototype.BindData = function (bRefresh)
        {
          SiebelJS.Log("In Bind Data list");
          //SBOORlA:Added code for defect 765
          if (scRefresh == "Y")
          {
            scRefresh = "N";
            var CalculatefrieghtFlag = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Freight Calculated Flag");
            SiebelJS.Log("CalculatefrieghtFlag" + CalculatefrieghtFlag);

            var caninvoke = "",
              caninvoke1 = "",
              canInvokeValidate = false,
              canInvokeCalculate = false,
              canInvokeVerify = false;
            canInvokeVerify = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "QuotesAndOrdersValidate");
            canInvokeValidate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Validate Freight");
            canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");

            SiebelJS.Log("caninvoke" + canInvokeVerify);
            if (canInvokeVerify)
            {
              SiebelJS.Log("Verifybutton");
              SCVerify = 'Y';
              var inPropSet = CCFMiscUtil_CreatePropSet();
              //Define the inPropSet property set with the information that InvokeMethod sends as input to the method that it calls.
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In validate Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In Validate Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", inPropSet, ai);
              //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", null, false);
            }
            else if (canInvokeValidate)
            {
              SCfrieghtValidation = 'Y';
              SiebelJS.Log("Invoking SC Validate Freight");
              var inPropSet = CCFMiscUtil_CreatePropSet();
              var ai = {};
              ai.async = true;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In validate Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In Validate Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "SC Validate Freight", inPropSet, ai);
            }
            else
            {
              scRefresh = "Y"
              var inPropSet = CCFMiscUtil_CreatePropSet();
              //Define the inPropSet property set with the information that InvokeMethod sends as input to the method that it calls.
              var ai = {};
              ai.async = true;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("Calculate Ship Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("Calculate Ship Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
            }
          }
          else if (SCfrieghtValidation == 'Y')
          {
            //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
            SCfrieghtValidation = 'N';
            FieldQueryPair = {
              "Id": ""
            };
            var OrderStatus = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue('Status')
            OrderItemDetails = SC_Order_PMinstance.GetRecordSet();
            SiebelJS.Log(OrderItemDetails[0]["Status"]);
            if (OrderItemDetails[0]["Status"] == SC_orderStatus)
            {
              setValidationErrors();
              if (bRefreshShipMethod) //SL;Added for Tier Delivery;DF-1975
              {
                var oliRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                var bInvokeTierDel = false;
                for (var i = 0; i < oliRecordSet.length; i++)
                {
                  var elmVal = $('#' + (i + 1) + 'Ship-ShippingMethod').val();
                  if (elmVal != undefined && oliRecordSet[i]['Ship Method'] != elmVal)
                  {
                    $('#' + (i + 1) + 'Ship-ShippingMethod').val(oliRecordSet[i]['Ship Method']);
                    if (oliRecordSet[i]['Ship Method'] == "Home Delivery")
                    {
                      $('#' + (i + 1) + 'Ship-ShippingMethod').parent().next().append("<select class='shipping-dropdown' id='" + (i + 1) + "Delivery-Tier'></select>"); //enable delivery tier dropdown on current line
                      bInvokeTierDel = true;
                    }
                  }
                }
                if (bInvokeTierDel)
                  getDeliveryTierOptions(orderid); //evaluate delivery tiers
              }
              $("#custommaskoverlay").hide();
            }
            else
            {
              $("#custommaskoverlay").hide();
              SiebelJS.Log("Calling Delivery Type Popup");
              DeliveryTypePopup();
            }
          }
          else if (SCfrieghtCalculation == 'Y')
          {
            SCfrieghtCalculation = 'N';
            FieldQueryPair = {
              "Id": ""
            };
            OrderItemDetails = SC_Order_PMinstance.GetRecordSet();
            SiebelJS.Log(OrderItemDetails[0]["Status"]);
            if (OrderItemDetails[0]["Status"] == SC_orderStatus)
            {
              setValidationErrors();
              if (bRefreshShipMethod) //SL;Added for Tier Delivery;DF-1975
              {
                var oliRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                var bInvokeTierDel = false;
                for (var i = 0; i < oliRecordSet.length; i++)
                {
                  var elmVal = $('#' + (i + 1) + 'Ship-ShippingMethod').val();
                  if (elmVal != undefined && oliRecordSet[i]['Ship Method'] != elmVal)
                  {
                    $('#' + (i + 1) + 'Ship-ShippingMethod').val(oliRecordSet[i]['Ship Method']);
                    if (oliRecordSet[i]['Ship Method'] == "Home Delivery")
                    {
                      $('#' + (i + 1) + 'Ship-ShippingMethod').parent().next().append("<select class='shipping-dropdown' id='" + (i + 1) + "Delivery-Tier'></select>"); //enable delivery tier dropdown on current line
                      bInvokeTierDel = true;
                    }
                  }
                }
                if (bInvokeTierDel)
                  getDeliveryTierOptions(orderid); //evaluate delivery tiers
              }
              $("#custommaskoverlay").hide();
            }
            else
            {
              SiebelJS.Log("clicked Verify Button");
              var canInvokeVerify = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "QuotesAndOrdersValidate");
              if (canInvokeVerify)
              {
                SCVerify = 'Y';
                var inPropSet = CCFMiscUtil_CreatePropSet();
                //Define the inPropSet property set with the information that InvokeMethod sends as input to the method that it calls.
                var ai = {};
                ai.async = true;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails

                  SiebelJS.Log("In validate Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In Validate Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", null, false);
              }
              else
              {
                SiebelJS.Log("Not able to invoke Verify");
                scRefresh = "Y";
                FieldQueryPair = {
                  "Id": "IS NOT NULL"
                };
                SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");
                var inPropSet = CCFMiscUtil_CreatePropSet();
                //Define the inPropSet property set with the information that InvokeMethod sends as input to the method that it calls.
                var ai = {};
                ai.async = true;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("Calculate Ship Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("Calculate Ship Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
              }
            }
          }
          else if (SCVerify == 'Y')
          {
            SCVerify = 'N';
            OrderItemDetails = SC_Order_PMinstance.GetRecordSet();
            SiebelJS.Log("SC_orderStatus" + SC_orderStatus);
            SiebelJS.Log(OrderItemDetails[0]["Status"]);
            if (OrderItemDetails[0]["Status"] == SC_orderStatus)
            {
              SCVerifyErr = 'Y';
              //SBOORLA:Added code for defect 771
              var ignoreError = verfiyErrorCodes();
              if (ignoreError == 0)
              {
                SiebelJS.Log("submit order error");
                $("body").trigger('Custom.End');
                SiebelJS.Log("entered");
                //SCfrieght = 'N';
                SCfrieghtValidation = 'N';
                SCfrieghtCalculation = "N";
                $("#SC-error-block").hide();
                if (!$("#SC-error-block").is(":visible"))
                  $('#CommunicationPanelContainer').css("padding-top", "77px");

                var inPropSet = CCFMiscUtil_CreatePropSet();
                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In Refresh BC Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In Refresh BC Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", null, false);

                var recordrset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                var orderHeaderStatus = recordrset[0]["Status"];
                $("#cstatus").text(orderHeaderStatus);
                $('select[id^="orderstatus"] option:selected').attr("selected", null);
                $('select[id^="orderstatus"] option[value="' + orderHeaderStatus + '"]').attr("selected", "selected");
                if (recordrset[0]["SC Verified Flag"] == "Y" && ((recordrset[0]["SC Tax Calculated Flag"] == "Y") || (recordrset[0]["SC Tax Calculated Flag"] == "N" && recordrset[0]["SC Tax Verification Pending"] == "Y")))
                {
                  $("#custommaskoverlay").show();
                  setTimeout(function ()
                  {
                    FieldQueryPair = {
                      "SKU #": ""
                    };
                    SC_OUI_Methods.ExecuteListAppletFrame(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");
                    $("#Ship-Option-Markup").hide();
                    $("#Default-Shipping").hide();
                    $("#Shipping-Detils").hide();
                    $("#SC_Order_ship_markup").show();
                    $("#SC_Order_ship_markup1").show();
                    $("#SC_Order_ship_markup2").show();
                    $("#footerbutton").show();
					   $(".SC-Discount-button").show(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").show(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").show();//Sukumar 03/25 to hide discount button
$(".coupdescdel").show(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").show();//Sukumar 03/25 to hide discount button
$(".addonsdel").show();
			if($('[id^=ProductCoupon]')[0].innerText === "no coupons applied"){$('[id^=ProductCoupon]').prev().hide()}
			  if($('[id^=scmanualcouponval]')[0].innerText === "no coupons applied"){$('[id^=scmanualcouponval]').prev().hide()}
                    $("#SC-SO-ShipSummary-DefaultAddress").html($("#Ship-Default-BillToAddress").val());
                    var Custom_Service = SiebelApp.S_App.GetService("SC Custom Query");
                    var InputArg = SiebelApp.S_App.NewPropertySet();
                    var OutputArg = SiebelApp.S_App.NewPropertySet();
                    var Fields = "Ship Method,Product Line,SC Ship To Address Name,SC Line Total NRC,Request To Cancel,Start Price,SC Total Line Discounts,NRC CxTotal in Header Currency,Tax Amount,Ship To First Name,Ship To Last Name,Shipping";
                    InputArg.SetProperty("BO", "Order Entry (Sales)");
                    InputArg.SetProperty("BC", "Order Entry - Line Items");
                    InputArg.SetProperty("SearchSpecification", "[Order Number] = '" + ShipToContactRecordSet[0]["Order Number"] + "'");
                    InputArg.SetProperty("FieldsArray", Fields);
                    OutputArg = Custom_Service.InvokeMethod("Query", InputArg);
                    var Child_OutArg = OutputArg.GetChild(0);
                    var BS_Data_Addresses = Child_OutArg.GetProperty("OutputRecordSet");
                    SiebelJS.Log("BS_Data_Addresses--" + JSON.stringify(BS_Data_Addresses));
                    var Addres_Array = BS_Data_Addresses.split(";");
                    SCOrderShipMarkup.ShippingSummaryMarkup(Addres_Array, scAccountOrder);
                    var inPS = SiebelApp.S_App.NewPropertySet();
                    var outPS = SiebelApp.S_App.NewPropertySet();
                    var Bservice = "";
                    inPS.SetProperty("OrderId", ShipToContactRecordSet[0]["Id"])
                    SiebelJS.Log("Invoking Business Service");
                    Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
                    var ai1 = {};
                    ai1.async = false;
                    ai1.selfbusy = true;
                    ai1.scope = this;
                    ai1.mask = true;
                    ai1.opdecode = true;
                    ai1.errcb = function ()
                    {
                      SiebelJS.Log("Error while executing 'SC Get Line Items' Business Service");
                    };
                    ai1.cb = function ()
                    {
                      var outPropSet = arguments[2];
                      if (outPropSet != null)
                      {
                        var OutPS1 = outPropSet.GetChildByType('ResultSet');
                        outPS.AddChild(OutPS1);
                        SiebelJS.Log("childcount" + JSON.stringify(outPS.GetChild(0).GetChildCount()));
                        for (var ps = 0; ps < outPS.GetChild(0).GetChildCount(); ps++)
                        {
                          SiebelJS.Log(outPS.GetChild(0).GetChild(ps).GetProperty("SC Calc Long Description"));
                          for (var pr = 0; pr < outPS.GetChild(0).GetChild(ps).GetChildCount(); pr++)
                          {

                            SiebelJS.Log("child" + outPS.GetChild(0).GetChild(ps).GetChild(pr).GetProperty("SC Calc Long Description"));
                          }

                        }
                        var shippingcost = outPS.GetChild(0).GetProperty("Shipping cost");
                        var shippinglinediscounts = outPS.GetChild(0).GetProperty("Shipping Line Discounts");
                        SiebelJS.Log("Shipping cost" + outPS.GetChild(0).GetProperty("Shipping cost"));
                        SiebelJS.Log("Shipping Line Discounts" + outPS.GetChild(0).GetProperty("Shipping Line Discounts"));
                        //var shipTotalCost=outPS.GetChild(0).GetProperty("Shipping Line Discounts");
                        productsmarkup = getordersummarylineitems(outPS);
                        $("#SC-products-summary").html(productsmarkup);
                        var OrderDetailPMinstance = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
                        allproductmarkup = SC_OUI_Methods.OrderSummary(OrderDetailPMinstance, shippingcost, shippinglinediscounts);
                        $("#SC-all-products-total").html(allproductmarkup);
                        SC_OUI_Markups.prodmarkup(outPS, Lov_Dis, Lov_Per);
                        //to get order total and discounts 
                        var inPropSet = CCFMiscUtil_CreatePropSet();
                        var ai = {};
                        ai.async = false;
                        ai.selfbusy = true;
                        ai.scope = this;
                        ai.mask = true;
                        ai.opdecode = true;
                        ai.errcb = function ()
                        {
                          //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                          SiebelJS.Log("In Refresh BC Error");
                        };
                        ai.cb = function ()
                        {
                          //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                          SiebelJS.Log("In Refresh BC Call Back");
                        };
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                        //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", null, false);

                        document.getElementById('bottotal').innerHTML = "$" + (parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total")).toFixed(2)) - parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")).toFixed(2))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                        document.getElementById('toptotal').innerHTML = "$" + ((Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total"))) - (Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                        document.getElementById('topdisc').innerHTML = "$" + Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Item Discount")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                        document.getElementById('topstart').innerHTML = "$" + Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Base Price")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                      }
                    }
                    Bservice.InvokeMethod("Query", inPS, ai1); //invoke the method

                    // VAMSI:08-OCT-18: Modified the below condtions to Support P2PE pole Display.
                    //SBOORLA:Added code for pole display
                    if (localStorage.getItem("InvokepoleDisplay") == 'Y' && sP2PEFlag != "Y")
                    {
                      SC_OUI_Methods.PoleDisplay(poleJSON, "N");
                    }
                    if (localStorage.getItem("InvokepoleDisplay") == 'Y' && sP2PEFlag == "Y")
                    {
                      SC_OUI_Methods.TaxDetailsP2PEDisplay(orderid, poleJSON, subpoleJSON);
                    }
                    //NGOLLA for 598 defect 
                    $(".edit-details").hide();
                    if ($(".customline").is(":visible"))
                      $(".customline").siblings(2).css("cssText", "padding-left: 7% !important;");
                    $(".deleteline").hide();
                    $(".prodcoupon").hide();
                    $(".discount-btn").hide();
                    $(".customline").hide();
                    $(".displaybed").addClass("SC-readonly");
                    $(".quantitybox").addClass("input-readonly");
                    $(".amount-width").addClass("input-readonly");
                    $(".overflow-title").css("cssText", "margin-left:30px !important");
                    $(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
                    $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
					 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
  $(".addonsdel").hide();                  
                    $("#SC-SO-CF-success").modal(
                    {
                      backdrop: 'static'
                    });
                    $("#SC-SO-CF-success").css(
                    {
                      "display": "flex",
                      "justify-content": "center",
                      "align-items": "center"
                    });
                    $(".modal-backdrop").css('background', '#ffffff');
                    setTimeout(function ()
                    {
                      $("#SC-SO-CF-verify").modal('hide');
                      $("#SC-SO-CF-success").css(
                      {
                        "display": "",
                        "justify-content": "",
                        "align-items": ""
                      });
                      $("#SC-SO-CF-success").modal('hide');
                      $("#custommaskoverlay").hide();
                      $("div").scrollTop(10000);
                      if (SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Management Products"].GetPModel().Get("AddReferral") || $("#SC-Add-Referral").is(":visible"))
                      {
                        pm.SetProperty("AddReferralFlg", true);
                      };
                    }, 2000);
                  }, 50);
                }
                else
                {
                  $("#SC-SO-CF-verify").modal('hide');
                  $("#custommaskoverlay").hide();
                }

              }
              else
              {

                setValidationErrors();
                //SBOORLA:Added code for defect 765
                var inPS = SiebelApp.S_App.NewPropertySet();
                var outPS = SiebelApp.S_App.NewPropertySet();
                var Bservice = "";
                inPS.SetProperty("OrderId", ShipToContactRecordSet[0]["Id"])
                SiebelJS.Log("Invoking Business Service");
                Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
                outPS = Bservice.InvokeMethod("Query", inPS); //invoke the method
                SC_OUI_Markups.prodmarkup(outPS, Lov_Dis, Lov_Per);
                $("#custommaskoverlay").hide();
                $('#CommunicationPanelContainer').css("padding-top", "77px");
              }
            }
            else
            {
              $("body").trigger('Custom.End');
              SiebelJS.Log("entered");
              //SCfrieght = 'N';
              SCfrieghtValidation = 'N';
              SCfrieghtCalculation = "N";
              SCVerify = 'N';
              scRefresh = "N";
              $("#SC-error-block").hide();
              if (!$("#SC-error-block").is(":visible"))
                $('#CommunicationPanelContainer').css("padding-top", "77px");

              $(".modal-backdrop").css('background', '#ffffff');
              var inPropSet = CCFMiscUtil_CreatePropSet();
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In Refresh BC Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In Refresh BC Call Back");
                //};
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", null, false);

                var recordrset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                var orderHeaderStatus = recordrset[0]["Status"];
                $("#cstatus").text(orderHeaderStatus);
                $('select[id^="orderstatus"] option:selected').attr("selected", null);
                $('select[id^="orderstatus"] option[value="' + orderHeaderStatus + '"]').attr("selected", "selected");
                if (recordrset[0]["SC Verified Flag"] == "Y" && ((recordrset[0]["SC Tax Calculated Flag"] == "Y") || (recordrset[0]["SC Tax Calculated Flag"] == "N" && recordrset[0]["SC Tax Verification Pending"] == "Y")))
                {
                  $("#custommaskoverlay").show();
                  setTimeout(function ()
                  {
                    FieldQueryPair = {
                      "SKU #": ""
                    };
                    SC_OUI_Methods.ExecuteListAppletFrame(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");
                    $("#Ship-Option-Markup").hide();
                    $("#Default-Shipping").hide();
                    $("#Shipping-Detils").hide();
                    $("#SC_Order_ship_markup").show();
                    $("#SC_Order_ship_markup1").show();
                    $("#SC_Order_ship_markup2").show();
                    $("#footerbutton").show();
					 $(".SC-Discount-button").show(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").show(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").show();//Sukumar 03/25 to hide discount button
$(".coupdescdel").show(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").show();//Sukumar 03/25 to hide discount button
$(".addonsdel").show();
			//if($('[id^=ProductCoupon]')[0].innerText === "no coupons applied"){$('[id^=ProductCoupon]').prev().hide()}
			  //if($('[id^=scmanualcouponval]')[0].innerText === "no coupons applied"){$('[id^=scmanualcouponval]').prev().hide()}
                    $("#SC-SO-ShipSummary-DefaultAddress").html($("#Ship-Default-BillToAddress").val());
                    var Custom_Service = SiebelApp.S_App.GetService("SC Custom Query");
                    var InputArg = SiebelApp.S_App.NewPropertySet();
                    var OutputArg = SiebelApp.S_App.NewPropertySet();
                    var Fields = "Ship Method,Product Line,SC Ship To Address Name,SC Line Total NRC,Request To Cancel,Start Price,SC Total Line Discounts,NRC CxTotal in Header Currency,Tax Amount,Ship To First Name,Ship To Last Name,Shipping";
                    InputArg.SetProperty("BO", "Order Entry (Sales)");
                    InputArg.SetProperty("BC", "Order Entry - Line Items");
                    InputArg.SetProperty("SearchSpecification", "[Order Number] = '" + ShipToContactRecordSet[0]["Order Number"] + "'");
                    InputArg.SetProperty("FieldsArray", Fields);
                    OutputArg = Custom_Service.InvokeMethod("Query", InputArg);
                    var Child_OutArg = OutputArg.GetChild(0);
                    var BS_Data_Addresses = Child_OutArg.GetProperty("OutputRecordSet");
                    SiebelJS.Log("BS_Data_Addresses--" + JSON.stringify(BS_Data_Addresses));
                    var Addres_Array = BS_Data_Addresses.split(";");
                    SCOrderShipMarkup.ShippingSummaryMarkup(Addres_Array, scAccountOrder);
                    var inPS = SiebelApp.S_App.NewPropertySet();
                    var outPS = SiebelApp.S_App.NewPropertySet();
                    var Bservice = "";
                    inPS.SetProperty("OrderId", ShipToContactRecordSet[0]["Id"])
                    SiebelJS.Log("Invoking Business Service");
                    Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
                    var ai2 = {};
                    ai2.async = false;
                    ai2.selfbusy = true;
                    ai2.scope = this;
                    ai2.mask = true;
                    ai2.opdecode = true;
                    ai2.errcb = function ()
                    {
                      SiebelJS.Log("Error while executing 'SC Get Line Items' Business Service");
                    };
                    ai2.cb = function ()
                    {
                      var outPropSet = arguments[2];
                      if (outPropSet != null)
                      {
                        var OutPS1 = outPropSet.GetChildByType('ResultSet');
                        outPS.AddChild(OutPS1);
                        SiebelJS.Log("childcount" + JSON.stringify(outPS.GetChild(0).GetChildCount()));
                        for (var ps = 0; ps < outPS.GetChild(0).GetChildCount(); ps++)
                        {
                          SiebelJS.Log(outPS.GetChild(0).GetChild(ps).GetProperty("SC Calc Long Description"));
                          for (var pr = 0; pr < outPS.GetChild(0).GetChild(ps).GetChildCount(); pr++)
                          {

                            SiebelJS.Log("child" + outPS.GetChild(0).GetChild(ps).GetChild(pr).GetProperty("SC Calc Long Description"));
                          }

                        }
                        var shippingcost = outPS.GetChild(0).GetProperty("Shipping cost");
                        var shippinglinediscounts = outPS.GetChild(0).GetProperty("Shipping Line Discounts");
                        SiebelJS.Log("Shipping cost" + outPS.GetChild(0).GetProperty("Shipping cost"));
                        SiebelJS.Log("Shipping Line Discounts" + outPS.GetChild(0).GetProperty("Shipping Line Discounts"));
                        //var shipTotalCost=outPS.GetChild(0).GetProperty("Shipping Line Discounts");
                        productsmarkup = getordersummarylineitems(outPS);
                        $("#SC-products-summary").html(productsmarkup);
                        var OrderDetailPMinstance = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM();
                        allproductmarkup = SC_OUI_Methods.OrderSummary(OrderDetailPMinstance, shippingcost, shippinglinediscounts);
                        $("#SC-all-products-total").html(allproductmarkup);
                        SC_OUI_Markups.prodmarkup(outPS, Lov_Dis, Lov_Per);
                        //to get order total and discounts 
                        var inPropSet = CCFMiscUtil_CreatePropSet();
                        var ai = {};
                        ai.async = false;
                        ai.selfbusy = true;
                        ai.scope = this;
                        ai.mask = true;
                        ai.opdecode = true;
                        ai.errcb = function ()
                        {
                          //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                          SiebelJS.Log("In Refresh BC Error");
                        };
                        ai.cb = function ()
                        {
                          //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                          SiebelJS.Log("In Refresh BC Call Back");
                        };
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                        //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", null, false);

                        document.getElementById('bottotal').innerHTML = "$" + (parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total")).toFixed(2)) - parseFloat(Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")).toFixed(2))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                        document.getElementById('toptotal').innerHTML = "$" + ((Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Order Total"))) - (Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Third Party Tax Amount")))).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                        document.getElementById('topdisc').innerHTML = "$" + Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Item Discount")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                        document.getElementById('topstart').innerHTML = "$" + Number.parseFloat(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Current Order Total Base Price")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                      }
                    }
                    Bservice.InvokeMethod("Query", inPS, ai2);
                    //SBOORLA:Added code for pole display
                    // VAMSI:08-OCT-18: Modified the below condtions to Support P2PE pole Display.
                    if (localStorage.getItem("InvokepoleDisplay") == 'Y' && sP2PEFlag != "Y")
                    {
                      SC_OUI_Methods.PoleDisplay(poleJSON, "N");
                    }
                    if (localStorage.getItem("InvokepoleDisplay") == 'Y' && sP2PEFlag == "Y")
                    {
                      SC_OUI_Methods.TaxDetailsP2PEDisplay(orderid, poleJSON, subpoleJSON);
                    }
                    //NGOLLA for 598 defect 
                    $(".edit-details").hide();
                    if ($(".customline").is(":visible"))
                      $(".customline").siblings(2).css("cssText", "padding-left: 7% !important;");
                    $(".deleteline").hide();
                    $(".prodcoupon").hide();
                    $(".discount-btn").hide();
                    $(".customline").hide();
                    $(".displaybed").addClass("SC-readonly");
                    $(".quantitybox").addClass("input-readonly");
                    $(".amount-width").addClass("input-readonly");
                    $(".overflow-title").css("cssText", "margin-left:30px !important");
                    $(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
                    $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
					 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
$(".addonsdel").hide(); 
                    $("#SC-SO-CF-success").modal(
                    {
                      backdrop: 'static'
                    });
                    $("#SC-SO-CF-success").css(
                    {
                      "display": "flex",
                      "justify-content": "center",
                      "align-items": "center"
                    });
                    $(".modal-backdrop").css('background', '#ffffff');
                    setTimeout(function ()
                    {
                      $("#SC-SO-CF-verify").modal('hide');
                      $("#SC-SO-CF-success").css(
                      {
                        "display": "",
                        "justify-content": "",
                        "align-items": ""
                      });
                      $("#SC-SO-CF-success").modal('hide');
                      $("#custommaskoverlay").hide();
                      $("div").scrollTop(10000);
                      if (SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Management Products"].GetPModel().Get("AddReferral") || $("#SC-Add-Referral").is(":visible"))
                      {
                        pm.SetProperty("AddReferralFlg", true);
                      };
                    }, 2000);
                  }, 50);
                }
                else
                {
                  $("#SC-SO-CF-verify").modal('hide');
                  $("#custommaskoverlay").hide();
                }
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
            }
            //End code for on click of calculate frieght button invoking calculate freight and verify button
            //Start:on click of ok button on error  popup
            $("#SC-CF-failure-button").click(function ()
            {
              $("#SC-SO-CF-failure").modal('hide');
              $("#SC-SO-CF-failure").css(
              {
                "display": "",
                "justify-content": "",
                "align-items": ""
              });
            });
            //End:on click of ok button on error  popup
          }
          SiebelAppFacade.SCiPadOrderShipToItemListAppletPR.superclass.BindData.apply(this, arguments);
          SiebelJS.Log("Shipping - BindData");
          //Start:on click of choose shipping button
          if (localStorage.getItem('ProceedToShipping') == 'Y')
          {
            $("#custommaskoverlay").show();
            setTimeout(function ()
            {
              ShipToContactRecordSet = SC_Order_PMinstance.GetRecordSet();
              $("#product-info").removeClass("in");
              localStorage.setItem('ProceedToShipping', 'N');
              if (backToShip == 'N')
                lovArray_ShipMethods = SCOrderShipMarkup.GetShippingMethods(ShipToContactRecordSet[0]["SC Sub-Type"]);
              var scstoreUSer = SC_OUI_Methods.SCGetProfileAttrValue("SC Store User");
              if (scstoreUSer == "Y" && backToShip == 'N')
                getPOSNumbers();
              SC_orderStatus = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'FS_ORDER_STATUS' and [Active] = 'Y' and [Name]='Siebel Error'");
              SiebelJS.Log("SC_orderStatus" + SC_orderStatus);
              Lov_Dis = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_MANUAL_DISCOUNT_REASON' and [Active] = 'Y'");
              Lov_Per = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'DISCNT_PERCENT' and [Active] = 'Y'");
              ProductTypeCode = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'PROD_CD' and [Active] = 'Y' and [Name]='Promotion'", "");
              disaflag = SC_OUI_Methods.SCGetOrderLoVs("[Type]= 'SC_DISA_ENABLE_FLAG' and [Active] = 'Y' and [Name]='Enable Disa Flag'");
              shippingItemsRecordSet = pm.Get("GetRecordSet");
              SiebelJS.Log("shippingItemsRecordSet::" + JSON.stringify(shippingItemsRecordSet));
              lineitemrcdset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
              SiebelJS.Log("lineitem::" + JSON.stringify(lineitemrcdset));
              ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
              var sOrderRevisionNum = parseInt(ShipToContactRecordSet[0]["Revision"]);
              if (scAccountOrder)
              {

                var shiptoAccId = "",
                  shiptoContcatId = "";
                shiptoAccId = ShipToContactRecordSet[0]["Ship To Account Id"];
                shiptoContcatId = ShipToContactRecordSet[0]["Ship To Contact Id"];
                shiptoAccId = ShipToContactRecordSet[0]["Ship To Account Id"];
                if (shiptoAccId == "" && shiptoContcatId == "")
                {
                  /*SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id","");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Account Id",ShipToContactRecordSet[0]["Bill To Account Id"]);
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id",ShipToContactRecordSet[0]["Bill To Address Id"]);
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact","");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                  ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();*/
                  isShipToAcc = "N";
                  $("#SC-Ship-to-Account-info").addClass("inactive-tab");
                  $("#SC-Ship-to-Contact-info").removeClass("inactive-tab");
                  $("#Ship-to-contact-button").addClass("p-item-active");
                  $("#Ship-to-Account-button").removeClass("p-item-active");
                  $("#Shipping-Detils").show();
                  $("#sc-line-contact").text("Contact");
					$(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
$(".addonsdel").hide(); 
                  Get_OrderShipToLineItems(shippingItemsRecordSet, lineitemrcdset);
                  //addressLine=AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                  $("#Ship-Default-BillToAddress").html('<option></option>');
                  var ShipToContactName = ShipToContactRecordSet[0]["Primary Ship To First Name"] + " " + ShipToContactRecordSet[0]["Primary Ship To Last Name"];
                  $("#Ship-Default-Name").html(ShipToContactName);
                  conId = ShipToContactRecordSet[0]["Ship To Contact Id"];
                }
                else if (shiptoAccId == "" || shiptoAccId == null || shiptoAccId == "undefined" || shiptoAccId == "")
                {
                  isShipToAcc = "N";
                  $("#SC-Ship-to-Account-info").addClass("inactive-tab");
                  $("#SC-Ship-to-Contact-info").removeClass("inactive-tab");
                  $("#Ship-to-contact-button").addClass("p-item-active");
                  $("#Ship-to-Account-button").removeClass("p-item-active");
                  $("#Shipping-Detils").show();
                  $("#sc-line-contact").text("Contact");
                  Get_OrderShipToLineItems(shippingItemsRecordSet, lineitemrcdset);
                  addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                  $("#Ship-Default-BillToAddress").html(addressLine);
                  var ShipToContactName = ShipToContactRecordSet[0]["Primary Ship To First Name"] + " " + ShipToContactRecordSet[0]["Primary Ship To Last Name"];
                  $("#Ship-Default-Name").html(ShipToContactName);
                  conId = ShipToContactRecordSet[0]["Ship To Contact Id"];
                }
                else
                {
                  isShipToAcc = "Y";
                  Get_OrderShipToLineItemsAccount(shippingItemsRecordSet, lineitemrcdset);
                  $("#sc-line-contact").text("Account");
                  addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                  $("#scship-Acc-adr").html(addressLine);
                }
                var mblNumb_def = ShipToContactRecordSet[0]["SC Preferred Contact"];
                if (mblNumb_def != '' && mblNumb_def.match(/^\d+$/) && mblNumb_def.length == 10)
                {
                  var USFormt_mblNum = '';
                  USFormt_mblNum = "(" + mblNumb_def.substring(0, mblNumb_def.length - 7) + ") " + mblNumb_def.substring(3, mblNumb_def.length - 4) + "-" + mblNumb_def.substring(6, mblNumb_def.length);
                  mblNumb_def = USFormt_mblNum;
                }
                $("#scship-Acc-phone-number").val(mblNumb_def);
                $("#Ship-Default-PhNumber").val(mblNumb_def);
                $("#scship-Acc-Name").text(ShipToContactRecordSet[0]["Bill To Account"]);
                $("#scship-Acc-Name").attr("title", ShipToContactRecordSet[0]["Bill To Account"]);
                $("#Shipping-Detils").show();
                $("#SC-ship-validate-order").text("Add Tax");
                $("#SC-RepriceAll-shipping").text("Add Freight");
                var caninvokeFreight = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
                if (caninvokeFreight)
                  $("#SC-RepriceAll-shipping").removeClass("SC-readonly");
                else
                  $("#SC-RepriceAll-shipping").addClass("SC-readonly");
                //if (sOrderRevisionNum > 1) {
                if (ShipToContactRecordSet[0]["SC Con Bill To Address Readonly"] == "Y")
                {
                  var shipaddrId = ShipToContactRecordSet[0]["Ship To Address Id"];
                  var addrMarkup = "";
                  addrMarkup = '<p>Address:</p>';
                  if (parentJSON.hasOwnProperty(shipaddrId))
                    addrMarkup += '<label class="overflow" title="' + parentJSON[shipaddrId] + '">' + parentJSON[shipaddrId] + '</label>';
                  else
                    addrMarkup += '<label class="overflow" title=""></label>';
                  $("#Sc-shippingAddr-sec").html(addrMarkup);
                  //$("#Ship-Default-BillToAddress").addClass("SC-readonly");
                  $("#SC-AccChange-contact").addClass("SC-readonly");
                  $("#SC-add-new-contact").addClass("SC-disabled");
                  $("#Ship-Default-PhNumber").addClass("SC-readonly");
                  $("#scship-Acc-adr").addClass("SC-readonly");
                  $("#scship-Acc-phone-number").addClass("SC-readonly");
                }
              }
              else
              {
                Get_OrderShipToLineItems(shippingItemsRecordSet, lineitemrcdset);
                /*var ShipToAddress="";
				ShipToAddress +=ShipToContactRecordSet[0]["SC Con Ship To Address"];
				if(ShipToContactRecordSet[0]["Primary Ship To City"]!=(''|""|"undefined"))
				ShipToAddress +=', '+ShipToContactRecordSet[0]["Primary Ship To City"];
			    if(ShipToContactRecordSet[0]["Primary Ship To State"]!=(''|""|"undefined"))
				ShipToAddress +=', '+ShipToContactRecordSet[0]["Primary Ship To State"];
			   if(ShipToContactRecordSet[0]["Primary Ship To Postal Code"]!=(''|""|"undefined"))
				ShipToAddress +=', '+ShipToContactRecordSet[0]["Primary Ship To Postal Code"];
				$("#Ship-Default-BillToAddress").html('<option>'+ShipToAddress+'</option>');*/
                addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                $("#Ship-Default-BillToAddress").html(addressLine);
                $("#Shipping-Detils").show();
				  $(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
$(".addonsdel").hide(); 
                //if (sOrderRevisionNum > 1) {
                if (ShipToContactRecordSet[0]["SC Con Bill To Address Readonly"] == "Y")
                {
                  var shipaddrId = ShipToContactRecordSet[0]["Ship To Address Id"];
                  var addrMarkup = "";
                  addrMarkup = '<p>Address:</p>';
                  if (parentJSON.hasOwnProperty(shipaddrId))
                    addrMarkup += '<label class="overflow" title="' + parentJSON[shipaddrId] + '">' + parentJSON[shipaddrId] + '</label>';
                  else
                    addrMarkup += '<label class="overflow" title=""></label>';
                  $("#Sc-shippingAddr-sec").html(addrMarkup);
                  //$("#Ship-Default-BillToAddress").addClass("SC-readonly");
                  $("#SC-search-contact").addClass("SC-disabled");
                  $("#SC-add-new-contact").addClass("SC-disabled");
                  $("#Ship-Default-PhNumber").addClass("SC-readonly");
                }
              }
              $("#custommaskoverlay").hide();
              backToShip = 'N';
            }, 50);
          }
          //End:on click of choose shipping button
        } //End of BindData

        SCiPadOrderShipToItemListAppletPR.prototype.BindEvents = function ()
        {
          SiebelAppFacade.SCiPadOrderShipToItemListAppletPR.superclass.BindEvents.apply(this, arguments);
          SiebelJS.Log("Shipping - BindEvents");
          var selected_SearchConId = '',
            selected_SearchConIndex = '',
            scAccConid = "";
          //lovArray_ShipMethods=SCOrderShipMarkup.GetShippingMethods (ShipToContactRecordSet[0]["SC Sub-Type"]);
          $(".attachmentitem").hide();
          $("#SC-add-new-Attach").hide();
          //sushma 19-07-2018:Added for Resizing CTI Toolbar
          $(document).on('click', '#commPanelDockToShowUnpin', function ()
          {
            $("#CommunicationPanelContainer").css("cssText", "padding-top: 0px !important;");
          })
          $(document).on('click', '#commPanelDockToShowPin', function ()
          {
            $("#CommunicationPanelContainer").css("cssText", "padding-top: 77px !important;");
          })
          //Start:code for on click of Ship to Account tab and Ship to Contact Tab for B2B order
          /*$(document).on('click',"#Ship-Default-BillToAddress",function(){
          		if(!scAccountOrder){
          			GetAddressList(ShipToContactRecordSet[0]["Ship To Contact Id"]);
          			var Defalult_ship_AddrId=SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Ship To Address Id")
          			addressLine=AttachAddresses(Defalult_ship_AddrId);
          			SiebelJS.Log(addressLine);
          			if(AddrServiceLevel[Defalult_ship_AddrId]=="")
          			{
          				SiebelJS.Log("HD Service Level");
          				var Bservice = '', inPS = '', outPS = '';
          				inPS = SiebelApp.S_App.NewPropertySet();
          				outPS = SiebelApp.S_App.NewPropertySet();
          				inPS.SetProperty("Id",Defalult_ship_AddrId);
          				Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
          				outPS = Bservice.InvokeMethod("GetHDEligibility", inPS); 
          				SiebelJS.Log("BSStatus"+outPS.GetChild(0).GetProperty("Status"));
          				SiebelJS.Log("BSStatus"+outPS.GetChild(0).GetProperty("Statusis"));
          			}
          			$("#Ship-Default-BillToAddress").html(addressLine);
          		}
          });*/
          //Start: Selecting a record in select Contact popup
          $(document).on('click', "#SC-table-search-Acc-contact tbody tr", function ()
          {
            scAccConid = $(this).attr('id');
            $('#' + scAccConid).addClass('highlate-row').siblings().removeClass('highlate-row');
            $("#SC-AccSelect-contact").removeClass('SC-disabled');
          });
          $("#Acc-close-details").click(function ()
          {
            $("#SC-Accsearch-contacts").modal('hide');
            $("#SC-Accsearch-contacts").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
          });
          //End: Selecting a record in select Contact popup
          //Start:on click of change contact button in ShiptoContact Section
          $("#SC-AccChange-contact").click(function ()
          {
            sChangeContactClicked = "Y";
            //if(ChnageContactloaded == "N"){
            //ChnageContactloaded="Y";
            FieldQueryPair = {
              "Id": "IS NOT NULL"
            };
            SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Account Contact Shipping List OUI");
            //}
            contactSearchMarkup();
            ContactAccountSearch_GetRecordSearch();

            $("#SC-search-contacts").modal(
            {
              backdrop: 'static'
            });
          });
          //End:on click of change contact button in ShiptoContact Section
          //Start:code for On click of Select Contact button in ShiptoContact Section
          $("#SC-AccSelect-contact").click(function ()
          {
            if (scAccConid != "")
            {
              $("#custommaskoverlay").show();
              setTimeout(function ()
              {
                scAccConid = scAccConid.split("_");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", scAccConid[0]);
                if (scAccConid[1] != "null" && scAccConid[1] != "" && scAccConid[1] != "No Match Row Id" && scAccConid[1] != "undefined")
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", scAccConid[1]);
                else
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", "");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", "");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                var fieldvalues = "";
                if (scAccConid[1] != "null" && scAccConid[1] != "" && scAccConid[1] != "No Match Row Id" && scAccConid[1] != "undefined")
                  fieldvalues = scAccConid[0] + ',' + scAccConid[1] + ',' + ',';
                else
                  fieldvalues = scAccConid[0] + ',' + ',' + ',' + ',';
                var fieldnames = "Ship To Contact Id,Ship To Address Id,SC Preferred Contact";
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("ValuesArray", fieldvalues);
                inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);
                var inPropSet = CCFMiscUtil_CreatePropSet();
                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In Refresh BC Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In Refresh BC Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                shippingItemsRecordSet = pm.Get("GetRecordSet");
                lineitemrcdset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                Get_OrderShipToLineItems(shippingItemsRecordSet, lineitemrcdset);
                addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                $("#Ship-Default-BillToAddress").html(addressLine);
                var mblNumb_def = ShipToContactRecordSet[0]["SC Preferred Contact"];
                if (mblNumb_def != '' && mblNumb_def.match(/^\d+$/) && mblNumb_def.length == 10)
                {
                  var USFormt_mblNum = '';
                  USFormt_mblNum = "(" + mblNumb_def.substring(0, mblNumb_def.length - 7) + ") " + mblNumb_def.substring(3, mblNumb_def.length - 4) + "-" + mblNumb_def.substring(6, mblNumb_def.length);
                  mblNumb_def = USFormt_mblNum;
                }
                $("#Ship-Default-PhNumber").val(mblNumb_def);
                conId = ShipToContactRecordSet[0]["Ship To Contact Id"];
                var ShipToContactName = ShipToContactRecordSet[0]["Primary Ship To First Name"] + " " + ShipToContactRecordSet[0]["Primary Ship To Last Name"];
                $("#Ship-Default-Name").html(ShipToContactName);
                $("#custommaskoverlay").hide();
              }, 50);
              $("#SC-Accsearch-contacts").modal('hide');
              $("#SC-Accsearch-contacts").css(
              {
                "display": "",
                "justify-content": "",
                "align-items": ""
              });
              $('#' + scAccConid).removeClass('highlate-row');
            }
          });
          //Start:code for On click of Select Contact button in ShiptoContact Section
          //Start:code for on click of ShipToAccount Tab
          $("#Ship-to-Account-button").click(function ()
          {
            $("#custommaskoverlay").show();
            setTimeout(function ()
            {
              isShipToAcc = "Y";
              $("#SC-Ship-to-Account-info").removeClass("inactive-tab");
              $("#SC-Ship-to-Contact-info").addClass("inactive-tab");
              $("#Ship-to-Account-button").addClass("p-item-active");
              $("#Ship-to-contact-button").removeClass("p-item-active");
              $("#Shipping-Detils").show();
				$(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
$(".addonsdel").hide(); 
              $("#sc-line-contact").text("Account");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Account Id", ShipToContactRecordSet[0]["Bill To Account Id"]);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", ShipToContactRecordSet[0]["Bill To Address Id"]);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
              var fieldnames = "Ship To Contact Id,Ship To Account Id,Ship To Address Id,SC Preferred Contact";
              var fieldvalues = "";
              fieldvalues = ',' + ShipToContactRecordSet[0]["Bill To Account Id"] + ',' + ShipToContactRecordSet[0]["Bill To Address Id"] + ',';
              SiebelJS.Log(fieldvalues);
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("BO", "Order Entry (Sales)");
              inPS.SetProperty("BC", "Order Entry - Line Items");
              inPS.SetProperty("FieldsArray", fieldnames);
              inPS.SetProperty("ValuesArray", fieldvalues);
              inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
              Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
              outPS = Bservice.InvokeMethod("Insert", inPS);
              var inPropSet = CCFMiscUtil_CreatePropSet();
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In Refresh BC Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In Refresh BC Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
              //ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
              shippingItemsRecordSet = pm.Get("GetRecordSet");
              lineitemrcdset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
              Get_OrderShipToLineItemsAccount(shippingItemsRecordSet, lineitemrcdset);
              addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
              $("#scship-Acc-adr").html(addressLine);
              $("#scship-Acc-phone-number").val("");
              $("#custommaskoverlay").hide();
            }, 50);
          });
          //End:code for on click of ShipToAccount Tab
          //Start:code for on click of ShipToContact Tab
          $("#Ship-to-contact-button").click(function ()
          {
            $("#custommaskoverlay").show();
            setTimeout(function ()
            {
              isShipToAcc = "N";
              $("#SC-Ship-to-Account-info").addClass("inactive-tab");
              $("#SC-Ship-to-Contact-info").removeClass("inactive-tab");
              $("#Ship-to-contact-button").addClass("p-item-active");
              $("#Ship-to-Account-button").removeClass("p-item-active");
              $("#Shipping-Detils").show();
				$(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
$(".addonsdel").hide(); 
              $("#sc-line-contact").text("Contact");
              var fieldnames = "Ship To Contact Id,Ship To Account Id,Ship To Address Id,SC Preferred Contact";
              var fieldvalues = "";
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Account Id", "");
              /*if(primarycontactid != ""){
              	SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id",primarycontactid);
              	SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id",sc_addr_id);
              	SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact",sc_phnnumber);
              	fieldvalues=primarycontactid+','+','+sc_addr_id+','+sc_phnnumber;
              	$("#Ship-Default-Name").text(PrContactName);
              }
              else{*/
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", "");
              fieldvalues = ',' + ',' + ',' + ',' + ',';
              //}
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
              SiebelJS.Log(fieldvalues);
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("BO", "Order Entry (Sales)");
              inPS.SetProperty("BC", "Order Entry - Line Items");
              inPS.SetProperty("FieldsArray", fieldnames);
              inPS.SetProperty("ValuesArray", fieldvalues);
              inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
              Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
              outPS = Bservice.InvokeMethod("Insert", inPS);
              var inPropSet = CCFMiscUtil_CreatePropSet();
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In Refresh BC Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In Refresh BC Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
              //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
              ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
              shippingItemsRecordSet = pm.Get("GetRecordSet");
              lineitemrcdset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
              Get_OrderShipToLineItems(shippingItemsRecordSet, lineitemrcdset);
              //addressLine=AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
              $("#Ship-Default-BillToAddress").html('<option></option>');
              var mblNumb_def = ShipToContactRecordSet[0]["SC Preferred Contact"];
              if (mblNumb_def != '' && mblNumb_def.match(/^\d+$/) && mblNumb_def.length == 10)
              {
                var USFormt_mblNum = '';
                USFormt_mblNum = "(" + mblNumb_def.substring(0, mblNumb_def.length - 7) + ") " + mblNumb_def.substring(3, mblNumb_def.length - 4) + "-" + mblNumb_def.substring(6, mblNumb_def.length);
                mblNumb_def = USFormt_mblNum;
              }
              $("#Ship-Default-PhNumber").val(mblNumb_def);
              conId = ShipToContactRecordSet[0]["Ship To Contact Id"];
              $("#custommaskoverlay").hide();
            }, 50);
          });
          //End:code for on click of ShipToContact Tab
          //End:code for on click of Ship to Account tab and Ship to Contact Tab for B2B order
          //Start:on click of ok button in location not match popup
          $(document).on("click", "#SC-loc-ok", function ()
          {
            $("#SC-SO-my-store").modal('hide');
            $("#SC-SO-my-store").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
          });
          //End:on click of ok button in location not match popup
          //Start:on click of shipping method pop up
          $(document).on("click", "#SC-shipmethod-ok", function ()
          {
            $("#SC-Shipmethod-popup").modal('hide');
            $("#SC-Shipmethod-popup").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
          });
          //End:on click of shipping method pop up
          $(document).on("click", "#SC-deliverytier-ok", function () //30Oct24;SL;Added for tier delivery
            {
              $("#SC-deliverytier-popup").modal('hide');
              $("#SC-deliverytier-popup").css(
              {
                "display": "",
                "justify-content": "",
                "align-items": ""
              });
            });
          //start:on click of No button in change store popup
          $(document).on("click", "#Store-no-ship", function ()
          {
            $("#SC-SO-store-location").modal('hide');
            $("#SC-SO-store-location").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
          });
          //End:on click of No button in change store popup
          //start:on click of yes button in change store popup
          $(document).on("click", "#store-yes-ship", function ()
          {
            var storeinfo = $("#storename").attr('title');
            SiebelJS.Log("storeinfo" + storeinfo);
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Sale Location", storeinfo);
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
            var inPropSet = SiebelApp.S_App.NewPropertySet();
            var ai = {};
            ai.async = false;
            ai.selfbusy = true;
            ai.scope = this;
            ai.mask = true;
            ai.opdecode = true;
            ai.errcb = function ()
            {
              //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
              SiebelJS.Log("In Refresh BC Error");
            };
            ai.cb = function ()
            {
              //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
              SiebelJS.Log("In Refresh BC Call Back");
            };
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
            //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
            $("#sc-cahnge-loaction").text(storeinfo);
            $("#sc-cahnge-loaction").attr("title", storeinfo);
            $("#clocation").text(storeinfo);
            var scorderSaleLocation = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Store Number");
            var scOrderSubChannel = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Sub-Channel")
            $("#SC-store-number").val(scorderSaleLocation);
            $("#SC-order-channel").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Type"));
            $("#SC-order-subchannel").text(scOrderSubChannel);
            $("#csubchan").text($("#SC-order-subchannel").text());
            //SPATIBAN:Added code for Updating the Show Number if Order Sub Channnel iS SHOW
            if (scOrderSubChannel == "SHOW")
            {
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("UpdateShowNumber");
              $("#SC-show-num").val(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Sale Show#"));
            }
            /*var inpPS="",outPS="",oBS="";
            inpPS = SiebelApp.S_App.NewPropertySet();
            outPS = SiebelApp.S_App.NewPropertySet();
            oBS = SiebelApp.S_App.GetService("FINS Teller UI Navigation");
            inpPS.SetProperty("Refresh All","Y");
            outPS=oBS.InvokeMethod("RefreshCurrentApplet", inpPS);*/
            $("#SC-SO-store-location").modal('hide');
            $("#SC-SO-store-location").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
          });
          //End:on click of yes button in change store popup
          //start:onclick linedetails error messages
          $(document).on("click", "#linedetailserrors", function ()
          {
            if (!$("product-info").hasClass("in"))
              $("#prod-expand-collapse").trigger("click");
            $("#SC-line-item").hide();
            $("#SC-line-arrow").addClass('arrow-down');
            $("#SC-line-arrow").removeClass('arrow-up');
          });
          //end:onclick linedetails error messages
          //start:onclick ordedetails error messages
          $(document).on("click", "#orderdetailserrors", function ()
          {
            if (!$("	sales-info").hasClass("in"))
              $("#expand-collapse").trigger("click");
            $("#SC-order-item").hide();
            $("#SC-arrow").addClass('arrow-down');
            $("#SC-arrow").removeClass('arrow-up');
          });
          //end:onclick orderdetails error messages
          //Start:on click of shipping error message
          $("#shippingserros").click(function ()
          {
            $("#SC-ship-item").hide();
            $("#SC-ship-arrow").addClass('arrow-down');
            $("#SC-ship-arrow").removeClass('arrow-up');
          });
          //End:on click of shipping error message
          //start:onclick contact error messages
          $(document).on("click", "#contacterrors", function ()
          {
            $("#SC-SO-contact-error").modal(
            {
              backdrop: 'static'
            });
            $("#SC-SO-contact-error").css(
            {
              "display": "flex",
              "justify-content": "center",
              "align-items": "center"
            });
            $(".modal-backdrop").css('background', '#ffffff');
            setTimeout(function ()
            {
              $("#SC-SO-contact-error").modal('hide');
              $("#SC-SO-contact-error").css(
              {
                "display": "",
                "justify-content": "",
                "align-items": ""
              });
            }, 5000);

          });
          //end:onclick contact error messages

          //start:on click of order label in error header
          $(document).on("click", "#SC-select-oder-item", function ()
          {
            //$("#SC-select-oder-item").on("touchend",function(){
            $("#SC-order-item").css("left:5%");
            $("#SC-order-item").toggle();
            if ($("#SC-order-item").is(":visible"))
            {
              $("#SC-arrow").addClass('arrow-up');
              $("#SC-arrow").removeClass('arrow-down');
            }
            else
            {
              $("#SC-arrow").addClass('arrow-down');
              $("#SC-arrow").removeClass('arrow-up');
            }
          });
          //end:on click of order label in error header
          $(document).on('click', '#SC-close-referredby', function ()
          {
            $("#SC-Referral-search-contacts").modal('hide');
          });
          //Start:on click of line deatils label in error header
          $(document).on("click", "#SC-select-line-item", function ()
          {
            // $("#SC-select-line-item").on("touchend",function(){
            $("#SC-line-item").css("left:26%");
            $("#SC-line-item").toggle();
            if ($("#SC-line-item").is(":visible"))
            {
              $("#SC-line-arrow").addClass('arrow-up');
              $("#SC-line-arrow").removeClass('arrow-down');
            }
            else
            {
              $("#SC-line-arrow").addClass('arrow-down');
              $("#SC-line-arrow").removeClass('arrow-up');
            }
          });
          //end:on click of line deatils label in error header
          //start:on click of ship details label in error header
          $(document).on("click", "#SC-select-ship-item", function ()
          {
            //$("#SC-select-ship-item").on("touchend",function(){
            $("#SC-ship-item").css("left:55%");
            $("#SC-ship-item").toggle();
            if ($("#SC-ship-item").is(":visible"))
            {
              $("#SC-ship-arrow").addClass('arrow-up');
              $("#SC-ship-arrow").removeClass('arrow-down');

            }
            else
            {
              $("#SC-ship-arrow").addClass('arrow-down');
              $("#SC-ship-arrow").removeClass('arrow-up');
            }
          });
          //end:on click of ship details label in error header
          //start:on click of contact label in error header
          $(document).on("click", "#SC-select-contact-item", function ()
          {
            // $("#SC-select-contact-item").on("touchend",function(){
            $("#SC-contact-item").css("left:82%");
            $("#SC-contact-item").toggle();
            if ($("#SC-contact-item").is(":visible"))
            {
              $("#SC-contact-arrow").addClass('arrow-up');
              $("#SC-contact-arrow").removeClass('arrow-down');

            }
            else
            {
              $("#SC-contact-arrow").addClass('arrow-down');
              $("#SC-contact-arrow").removeClass('arrow-up');
            }
          });
          //END:on click of contact label in error header
          $(document).on("click", "#Ship_NewContact", function ()
          {
            addnewcontact_lineitem = "Y";
            $("#SC-add-contact").modal(
            {
              backdrop: 'static'
            });
          });
          $(document).on("click", "#ship_ChangeContact", function ()
          {
            contactSearchMarkup();
            searchcontact_lineitem = "Y"
            $("#SC-search-contacts").modal(
            {
              backdrop: 'static'
            });
          });
          //Start: Showing - Hiding Pop over for Change/Add Contact
          $(".SC-shipping-table .table-row .contact-popover Img").popover(
          {
            trigger: "click",
            placement: "bottom",
          });
          $(document).on('click', ".SC-shipping-table .table-row .contact-popover Img", function (e)
          {
            $(".SC-shipping-table .table-row .contact-popover img").not(this).popover('hide');
            $(this).addClass("credit-active");
          });
          //End: Showing - Hiding Pop over for Change/Add Contact

          //Start:On focus of Request Ship Date at default Account 
          $(document).on('click', '#ShipAcc-Defalut-RequestShipDate', function ()
          {
            $("#ui-datepicker-div").css(
            {
              "left": "287.922px",
              "margin-top": "2px"
            });
            $("#sc-Accreq-shipdate").datepicker(
            {
              minDate: 0,
              changeMonth: true,
              changeYear: true,
              onSelect: function (dateText, inst)
              {
                var fieldnames = "Due Date";
                var fieldvalues = "";
                fieldvalues = dateText;
                SiebelJS.Log(fieldvalues);
                SiebelJS.Log(orderid);
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items (Simple)");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("ValuesArray", fieldvalues);
                inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Ship Method]<>'Recd At Store' AND [Fulfillment Status Code]='In Progress'");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);
                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In Refresh BC Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In 1673 Refresh BC Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                $("#ShipAcc-Defalut-RequestShipDate-Val").html(dateText);
                $(".defaultRequestShipDate").val(dateText);
              },
              showButtonPanel: true
            });
          });
          //End:On focus of Request Ship Date at default Account

          function getOrderAPTDate()
          {
            var inpPS = "",
              outPS = "",
              oBS = "";
            inpPS = SiebelApp.S_App.NewPropertySet();
            outPS = SiebelApp.S_App.NewPropertySet();
            oBS = SiebelApp.S_App.GetService("Workflow Process Manager");
            inpPS.SetProperty("ProcessName", "SC Order Get ATP Scheduled Date From GOP");
            inpPS.SetProperty("Object Id", orderid);
            outPS = oBS.InvokeMethod("RunProcess", inpPS);
          }


          //Start:On focus of Request Ship Date 
          $(document).on('click', '#Ship-Defalut-RequestShipDate', function ()
          {
            $("#ui-datepicker-div").css(
            {
              "left": "287.922px",
              "margin-top": "2px"
            });
            //added for  iPad
            setTimeout(function ()
            {
              var datevalue = moment($(this).val(), "YYYY-MM-DD").format("MM/DD/YYYY HH:mm:ss");
              var fieldnames = "Due Date";
              var fieldvalues = "";
              fieldvalues = datevalue;
              SiebelJS.Log(fieldvalues);
              SiebelJS.Log(orderid);
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("BO", "Order Entry (Sales)");
              inPS.SetProperty("BC", "Order Entry - Line Items (Simple)");
              inPS.SetProperty("FieldsArray", fieldnames);
              inPS.SetProperty("ValuesArray", fieldvalues);
              inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Ship Method]<>'Recd At Store' AND [Fulfillment Status Code]='In Progress'");
              Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
              outPS = Bservice.InvokeMethod("Insert", inPS);
              getOrderAPTDate();
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In Refresh BC Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In 1759 Refresh BC Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
              $("#Ship-Defalut-RequestShipDate").val(datevalue);
              $(".defaultRequestShipDate").val(datevalue);
            }, 100);
          });
          //End:On focus of Request Ship Date 
          //Start:On focus of Request Ship Date on line items 
          $(document).on('focus', '.defaultRequestShipDate,.Ship-Details-Calander', function ()
          {
            var respectiveId = $(this).attr('id');
            var linedivid = respectiveId;
            linedivid = linedivid.split("Ship");
            line_date_row_id = linedivid[0];
            //line_date_row_id=respectiveId.charAt(0);
            SiebelJS.Log(line_date_row_id);
            line_date_row_id = parseInt(line_date_row_id) - 1;
            $("#" + respectiveId).datepicker(
            {
              minDate: 0,
              changeMonth: true,
              changeYear: true,
              onSelect: function (dateText, inst)
              {
                SiebelJS.Log("Selected");
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                var fieldnames = "Due Date";
                var fieldvalues = "";
                fieldvalues = dateText;
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items (Simple)");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("ValuesArray", fieldvalues);
                inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "' AND [Id]='" + shippingItemsRecordSet[line_date_row_id]["Id"] + "'");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);

                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("Object Id", orderid);
                inPS.SetProperty("LineItemId", shippingItemsRecordSet[line_date_row_id]["Id"]);
                inPS.SetProperty("ProcessName", "SC Get ATP Scheduled Date From GOP");
                Bservice = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
                outPS = Bservice.InvokeMethod("RunProcess", inPS);

                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In Refresh BC Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In 1759 Refresh BC Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
              },
              showButtonPanel: true
            });
          });
          //End:On focus of Request Ship Date on line items  
          //Start:On focus out of request Ship date in line items
          $(document).on('focusout', '.defaultRequestShipDate,.Ship-Details-Calander', function ()
          {
            var respectiveId = $(this).attr('id');
            $("#" + respectiveId + " ~ .ui-datepicker").hide();
            var reslineId = respectiveId;
            reslineId = reslineId.split("Ship");
            line_date_row_id = reslineId[0];
            //line_date_row_id=respectiveId.charAt(0);
            SiebelJS.Log(line_date_row_id);
            line_date_row_id = parseInt(line_date_row_id) - 1;
            if ($("#" + respectiveId).val() == "" || $("#" + respectiveId).val() == '')
            {
              var Bservice = '',
                inPS = '',
                outPS = '';
              var fieldnames = "Due Date";
              var fieldvalues = "";
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("BO", "Order Entry (Sales)");
              inPS.SetProperty("BC", "Order Entry - Line Items (Simple)");
              inPS.SetProperty("FieldsArray", fieldnames);
              inPS.SetProperty("ValuesArray", fieldvalues);
              inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "' AND [Id]='" + shippingItemsRecordSet[line_date_row_id]["Id"] + "'");
              Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
              outPS = Bservice.InvokeMethod("Insert", inPS);
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In 1805 Refresh BC Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In 1805 Refresh BC Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
              //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
            }
          });
          //End:On focus out of request Ship date in line items
          //Start:on scroll hiding the datepicker
          $("html, body").on("DOMMouseScroll MouseScrollEvent MozMousePixelScroll wheel scroll", function ()
          {
            $('#Ship-Default-Calander').datepicker("hide");
            $('.defaultRequestShipDate').datepicker("hide");
            $('.Ship-Details-Calander').datepicker("hide");
          });
          //End:on scroll hiding the datepicker
          //Functionality


          // Start:adding search fields onclick of +
          $(document).on("click", ".ship-icon-img", function (e)
          {
            if (searchCount <= csearchfields.length - 1)
            {
              e.preventDefault();
              next = parseInt(next);
              var addto = "#ifield" + next;
              var addRemove = "#ifield" + (next);
              next = parseInt(next) + 1;
              var newIn = '<select class="select-box sc-contact-select-box margin-top" autocomplete="off" id="field' + next + '" name="field' + next + '">';
              for (i = 0; i < csearchfields.length; i++)
              {
                newIn += '<option value="' + csearchfields[i] + '">' + csearchfields[i] + '</option>';
              }
              newIn += '</select><input type="text" id="ifield' + next + '" class="search-box con-search-box margin-top text-color" autocomplete="off">';
              var newInput = $(newIn);
              var removeBtn = '<div id="remove' + (next - 1) + '" class="remove-me ship-remove-me margin-top"> <span id="removeicon" class="glyphicon glyphicon-minus-sign icon-img-remove"></span></div>';
              var removeButton = $(removeBtn);
              $(addto).after(newInput);
              $(addRemove).after(removeButton);
              for (var j = 0; j < sFields.length; j++)
              {
                $("#field" + next + " option[value='" + sFields[j] + "']").wrap("<span>");
              }
              var e = document.getElementById("field" + next);
              var seletedvalue = e.options[e.selectedIndex].value;
              $("#field" + next + " option[value='" + seletedvalue + "']").attr('selected', 'selected');
              $(".sc-contact-select-box").each(function ()
              {
                $(this).attr("id"); //this.id
                if ($(this).attr("id") != "field" + next)
                {
                  $("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").wrap("<span>");
                }
              });
              sFields.push(seletedvalue);
              $(".add-item").hide();
              $("#pfield" + next - 1).attr('data-source', $(addto).attr('data-source'));
              $("#count").val(next);
              searchCount++;
            }
          });

          //Start:Removing the search fields onclik of - icon
          $(document).unbind('.ship-remove-me').on('click', '.ship-remove-me', function (e)
          {
            e.preventDefault();
            var idString = this.id.toString();
            var fieldNum = idString.substring(6, idString.length);
            var fieldID = "#field" + fieldNum;
            var ifieldID = "#ifield" + fieldNum;
            var e = document.getElementById("field" + fieldNum);
            var seletedvalue = e.options[e.selectedIndex].value;
            $(".sc-contact-select-box").each(function ()
            {
              if ($(this).attr("id") != "field" + parseInt(fieldNum))
              {
                if ($("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").parent().is("span"))
                {
                  $("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").unwrap();
                }
              }
            });
            var sIndex = sFields.indexOf(seletedvalue);
            sFields.splice(sIndex, 1);
            $(this).remove();
            $(fieldID).remove();
            $(ifieldID).remove();
            searchCount--;
          });
          //End:Removing the search fields onclik of - icon	
          $(document).on("click", "#sc-ship-con-search", function (event)
          {
            sChangeContactClicked = "N";
            searchContact();
          });
          //search contanier
          $("#ifield0,#ifield1").change(function ()
          {
            //"+" icon disabled
            if (($("#ifield0").val() != "") && ($("#ifield1").val() != ""))
            {
              $(".ship-icon-img").show();
            }
            else
            {
              $(".ship-icon-img").hide();
            }
            //Search button disabled
            if (($("#ifield0").val() != "") || ($("#ifield1").val() != ""))
            {
              $(".SC-search-button").removeClass('SC-disabled');
            }
            else
            {
              $(".SC-search-button").addClass('SC-disabled');
            }
          });

          $(".SC-search-container").on('change', 'input', function (event)
          {
            $(".con-search-box").each(function ()
            {
              if (event.target.id !== "ifield0" && event.target.id !== "ifield1")
              {
                if ($(this).val() !== "")
                {
                  $(".add-item").show();
                }
                else
                {
                  $(".add-item").hide();
                }
              }
            });
          });

          //This code is adding from SCCOntactListAppletPR
          //Start:on paste of search fields
          $(document).on('paste', '.con-search-box', function (event)
          {
            setTimeout(function ()
            {
              $(".con-search-box").trigger("keyup");
            }, 100);
          });
          //End:on paste of search fields
          //Start:search fields and search box code
          $(document).on('keyup', '.con-search-box', function ()
          {
            var selectedFieldId = $(this).attr("id").substr(1);
            SiebelJS.Log("selectedFieldId" + selectedFieldId);
            var e = document.getElementById(selectedFieldId);
            var selectedvalue = e.options[e.selectedIndex].value;
            if (selectedvalue == "Phone Number" || selectedvalue == "Customer Number" || selectedvalue == "Employee Number")
            {
              this.value = this.value.replace(/[^0-9\.]/g, '');
            }
            if ($(this).attr("id") != "ifield0" && $("#ifield0").val().length != 0 && $("#ifield0").val() != "*" && $(this).val().length != 0 && $(this).val() != "*")
            {
              if (searchCount != csearchfields.length)
              {
                $(".add-item").show();
              }
              else
              {
                $("#removeicon").show();
              }
            }
            else if ($(this).attr("id") == "ifield0" && $("#ifield0").val().length != 0)
            {
              $(".con-search-box").each(function ()
              {
                if ($(this).attr("id") != "ifield0")
                {
                  if ($(this).val().length != 0 && $(this).val() != "*")
                  {
                    $(".add-item").show();
                  }
                }
              });
            }
            else
            {
              $(".add-item").hide();
            }
            $(".con-search-box").each(function ()
            {
              if ($(this).val().length != 0 && $(this).val() != "*")
              {
                $("#sc-ship-con-search").removeClass('SC-disabled');
                return false;
              }
              else
              {
                $("#sc-ship-con-search").addClass('SC-disabled');
              }
            });
          });
          //End:search fields and search box code			
          //Start: dynamic values change for dropdowns
          $(document).on('click', '.sc-contact-select-box', function ()
          {
            var currentid = this.id;
            var e = document.getElementById(currentid);
            currentValue = e.options[e.selectedIndex].value;
          });
          $(document).on('change', '.sc-contact-select-box', function ()
          {
            var currentid = this.id;
            var e = document.getElementById(currentid);
            var seletedvalue = e.options[e.selectedIndex].value;
            $(".sc-contact-select-box").each(function ()
            {
              $(this).attr("id"); //this.id
              if ($(this).attr("id") != currentid)
              {
                $("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").wrap("<span>");
                if ($("#" + $(this).attr("id") + " option[value='" + currentValue + "']").parent().is("span"))
                {
                  $("#" + $(this).attr("id") + " option[value='" + currentValue + "']").unwrap();
                }
              }
              $("#" + currentid + " option[value='" + seletedvalue + "']").attr('selected', 'selected');
            });
            sFields.push(seletedvalue);
            var sIndex = sFields.indexOf(currentValue);
            sFields.splice(sIndex, 1);
          });
          //End: dynamic values change for dropdown
          //Start: Add New Contact Pop up modal
          $("#SC-add-new-contact").click(function ()
          {
            addnewcontact_lineitem = "N";
            $("#SC-add-contact").modal(
            {
              backdrop: 'static'
            });
          });
          //End: Add New Contact Pop up modal
          //Start: Search existing Contacts:: Pop-up modal
          $("#SC-search-contact").click(function ()
          {
            contactSearchMarkup();
            searchcontact_lineitem = "N";
            $("#SC-search-contacts").modal(
            {
              backdrop: 'static'
            });
          });
          //End: Search existing Contacts:: Pop-up modal
          //Start: Selecting a record in Contact Search Result
          $(document).on('click', "#SC-table-search-contact tbody tr", function ()
          {
            sc_rowid = $(this).attr('id');
            selected_SearchConId = sc_rowid;
            selected_SearchConIndex = selected_SearchConId.replace("SC-Conta-Search-Rcd", "");
            $('#' + sc_rowid).addClass('highlate-row').siblings().removeClass('highlate-row');
            if (refByFlag == "Y")
            {
              $("#SC-select-con-referredby").removeClass('SC-disabled');
            }
            else if (scAccountOrder)
            {
              $("#SC-select-Accountcontact-shipping").removeClass('SC-disabled');
            }
            else
            {
              $("#SC-select-contact-shipping").removeClass('SC-disabled');
            }

          });
          //End: Selecting a record in Contact Search Result
          //Start:Contact Search Functionality
          $(document).on('click', '#SC-SO-SearchForContact', function ()
          {
            SiebelJS.Log("Clicked on Search");
            searchContact();
          });
          //End: Contact Search Functionality
          //start:onclick on back to ship line items
          $(document).on("click", "#backtoship", function ()
          {
            localStorage.setItem("flowfrom", "proceed");
            localStorage.setItem('ProceedToShipping', 'Y');
            $("#Ship-Option-Markup").show();
            $("#Default-Shipping").show();
            $("#Shipping-Detils").show();
            $("#SC_Order_ship_markup").hide();
            $("#SC_Order_ship_markup1").hide();
            $("#SC_Order_ship_markup2").hide();
            $("#footerbutton").hide();
            $("#SC-SO-ShippingSummary").hide();
            //NGOLLA for 598 defect
            $(".edit-details").show();
            if ($(".customline").is(":visible"))
              $(".customline").siblings(2).css("cssText", "padding-left: 0% !important;");
            $(".deleteline").show();
            $(".prodcoupon").show();
            $(".discount-btn").show();
            $(".customline").show();
            $(".displaybed").removeClass("SC-readonly");
            $(".quantitybox").removeClass("input-readonly");
            $(".amount-width").removeClass("input-readonly");
            $(".overflow-title").css("cssText", "margin-left:0px !important");
            $(".SC-Discount-button").hide(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").hide(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").hide();//Sukumar 03/25 to hide discount button
$(".coupdescdel").hide(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").hide();//Sukumar 03/25 to hide discount button
$(".addonsdel").hide(); 
            if (isOrder360 == "Y")
              backToShip = 'N';
            else
              backToShip = "Y";
            FieldQueryPair = {
              "SKU #": ""
            };
            SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");
          });
          //End:onclick on back to ship line items

          //start:onclick on proceed payments
          $(document).on("click", "#SC-proced-payments", function ()
          {
            //SNARRA:Added for IPad
            /*$("#SC-SO-Ipad-popup").modal({
                backdrop: 'static'
            });
            $("#SC-SO-Ipad-popup").css({
                "display": "flex",
                "justify-content": "center",
                "align-items": "center"
            });
            $(".modal-backdrop").css('background', '#ffffff'); */

            // VAMSI:08-OCT-18: Modified the below condtions to Support P2PE pole Display.
            /*if(localStorage.getItem("InvokepoleDisplay")=='Y' && sP2PEFlag != "Y"){
            	SC_OUI_Methods.PoleDisplay(poleJSON,"Y");
            }
            if(localStorage.getItem("InvokepoleDisplay")=='Y' && sP2PEFlag == "Y"){
            	SC_OUI_Methods.OrderTotalP2PEPoleDisplay(orderid);
            }*/
            SiebelApp.S_App.GotoView("SC Order Entry - Payment View Sales OUI", "", "", "");
          });
          //End:onclick on proceed payments
          $(document).on("click", "#SC-SO-IPad-ok", function ()
          {
            $("#SC-SO-Ipad-popup").modal('hide');
          });
          //Start:On click of Reprice All Button
          $(document).on("click", "#SC-RepriceAll-shipping", function ()
          {
            if (scAccountOrder)
            {
              this.blur();
              if (document.getElementById("SC-ship-item").style.display == "block" || document.getElementById("SC-ship-item").style.display == "")
                $("#shippingserrno").trigger("click")
              if (document.getElementById("SC-order-item").style.display == "block" || document.getElementById("SC-order-item").style.display == "")
                $("#orderdetailserrno").trigger("click")
              if (document.getElementById("SC-line-item").style.display == "block" || document.getElementById("SC-line-item").style.display == "")
                $("#linedetailserrno").trigger("click")
              if (document.getElementById("SC-contact-item").style.display == "block" || document.getElementById("SC-contact-item").style.display == "")
                $("#contacterrorno").trigger("click")
              $("#SC-error-block").hide();
              if (!$("#SC-error-block").is(":visible"))
                $('#CommunicationPanelContainer').css("padding-top", "77px");
              var scnullshipMethod = "N";
              $('.Ship-ShippingMethod-lineitem').each(function ()
              {
                if ($(this).val() == "")
                {
                  scnullshipMethod = "Y";
                }
              });
              if (scnullshipMethod == "N")
              {
                $("#custommaskoverlay").show();
                setTimeout(function ()
                {
                  SiebelJS.Log("Frieghtcharges");
                  var inPropSet = CCFMiscUtil_CreatePropSet();
                  //Define the inPropSet property set with the information that InvokeMethod sends as input to the method that it calls.
                  var ai = {};
                  ai.async = false;
                  ai.selfbusy = true;
                  ai.scope = this;
                  ai.mask = true;
                  ai.opdecode = true;
                  ai.errcb = function ()
                  {
                    //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                    SiebelJS.Log("Calculate Ship Error");
                  };
                  ai.cb = function ()
                  {
                    //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                    SiebelJS.Log("Calculate Ship Call Back");
                  };
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "SC Calculate Shipping", inPropSet, ai);
                  OrderItemDetails = SC_Order_PMinstance.GetRecordSet();
                  SiebelJS.Log("SC_orderStatus" + SC_orderStatus);
                  SiebelJS.Log(OrderItemDetails[0]["Status"]);
                  if (OrderItemDetails[0]["Status"] == SC_orderStatus)
                  {
                    var ignoreError = verfiyErrorCodes();
                    if (ignoreError == 0)
                    {
                      if (!$("#SC-error-block").is(":visible"))
                        $('#CommunicationPanelContainer').css("padding-top", "77px");
                      $("#custommaskoverlay").hide();
                    }
                    else
                    {
                      setValidationErrors();
                      var inPS = SiebelApp.S_App.NewPropertySet();
                      var outPS = SiebelApp.S_App.NewPropertySet();
                      var Bservice = "";
                      inPS.SetProperty("OrderId", ShipToContactRecordSet[0]["Id"])
                      SiebelJS.Log("Invoking Business Service");
                      Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
                      outPS = Bservice.InvokeMethod("Query", inPS); //invoke the method
                      SC_OUI_Markups.prodmarkup(outPS, Lov_Dis, Lov_Per);
                      $("#custommaskoverlay").hide();
                      $('#CommunicationPanelContainer').css("padding-top", "77px");
                    }
                  }
                  else
                  {
                    var inPS = SiebelApp.S_App.NewPropertySet();
                    var outPS = SiebelApp.S_App.NewPropertySet();
                    var Bservice = "";
                    inPS.SetProperty("OrderId", ShipToContactRecordSet[0]["Id"])
                    SiebelJS.Log("Invoking Business Service");
                    Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
                    outPS = Bservice.InvokeMethod("Query", inPS); //invoke the method
                    SC_OUI_Markups.prodmarkup(outPS, Lov_Dis, Lov_Per);
                    $("#custommaskoverlay").hide();
                  }
                }, 50);
              }
              else
              {
                $("#SC-Shipmethod-popup").modal(
                {
                  backdrop: 'static'
                });
                $("#SC-Shipmethod-popup").css(
                {
                  "display": "flex",
                  "justify-content": "center",
                  "align-items": "center"
                });
              }
            }
            else
            {
              $("#custommaskoverlay").show();
              setTimeout(function ()
              {
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("CalculatePriceAll");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "CalculatePriceAll", null, false);
                var inPS = SiebelApp.S_App.NewPropertySet();
                var outPS = SiebelApp.S_App.NewPropertySet();
                var Bservice = "";
                inPS.SetProperty("OrderId", ShipToContactRecordSet[0]["Id"])
                SiebelJS.Log("Invoking Business Service");
                Bservice = SiebelApp.S_App.GetService("SC Get Line Items"); //get service
                outPS = Bservice.InvokeMethod("Query", inPS); //invoke the method
                SC_OUI_Markups.prodmarkup(outPS, Lov_Dis, Lov_Per);
                $("#custommaskoverlay").hide();
              }, 10);
            }

          });
          //End:On click of Reprice All Button
          //Start:On Click of Referred Insider Button
          $(document).on("click", "#SC-Add-Referral", function ()
          {
            referralcontactSearchMarkup();
            $("#SC-Referral-search-contacts").modal(
            {
              backdrop: 'static'
            });
            refBy = "searchbutton";
          });
          //End:On Click of Referred Insider Button
          //Start:On Click of Referral Requested Yes Button
          $(document).on("click", "#SC-SO-RR-popup .SC-SO-RR-buttons #referral-yes-button", function ()
          {
            $("#SC-SO-RR-popup").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
            $("#SC-SO-RR-popup").modal('hide');
            $("#custommaskoverlay").hide();
            referralcontactSearchMarkup();
            $("#SC-Referral-search-contacts").modal(
            {
              backdrop: 'static'
            });
            //refBy = "searchbutton";
          });
          //End:On Click of Referral Requested Yes Button
          //Start:On Click of Referral Requested No Button
          $(document).on("click", "#SC-SO-RR-popup .SC-SO-RR-buttons #referral-no-button", function ()
          {
            $("#SC-SO-RR-popup").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
            $("#SC-SO-RR-popup").modal('hide');
            $("#custommaskoverlay").hide();
          });
          //End:On Click of Referral Requested No Button
          $(document).on("click", "#SC-search-icon-referreby", function ()
          {
            referralcontactSearchMarkup();
            $("#SC-Referral-search-contacts").modal(
            {
              backdrop: 'static'
            });
            refBy = "searchicon";
          });
          //Start: on click of Calculate Frieght Chagres button
          $("#SC-ship-validate-order").click(function ()
          {
            this.blur();
            if (document.getElementById("SC-ship-item").style.display == "block" || document.getElementById("SC-ship-item").style.display == "")
              $("#shippingserrno").trigger("click")
            if (document.getElementById("SC-order-item").style.display == "block" || document.getElementById("SC-order-item").style.display == "")
              $("#orderdetailserrno").trigger("click")
            if (document.getElementById("SC-line-item").style.display == "block" || document.getElementById("SC-line-item").style.display == "")
              $("#linedetailserrno").trigger("click")
            if (document.getElementById("SC-contact-item").style.display == "block" || document.getElementById("SC-contact-item").style.display == "")
              $("#contacterrorno").trigger("click")
            $("#SC-error-block").hide();
            if (!$("#SC-error-block").is(":visible"))
              $('#CommunicationPanelContainer').css("padding-top", "77px");
            SiebelJS.Log("SCVerifyErr" + SCVerifyErr);
            var scnullshipMethod = "N";
            $('.Ship-ShippingMethod-lineitem').each(function ()
            {
              if ($(this).val() == "")
              {
                scnullshipMethod = "Y";
              }
            });
            if (scnullshipMethod == "N")
            {
              //DeliveryTypePopup()
              var verUL = 2;
              if (!validateDeliveryTiers()) //30Oct24;SL;Added for tier delivery
              {
                //show popup
                $("#SC-deliverytier-popup").modal(
                {
                  backdrop: 'static'
                });
                $("#SC-deliverytier-popup").css(
                {
                  "display": "flex",
                  "justify-content": "center",
                  "align-items": "center"
                });
              }
              else
              {
                if (parseInt(ShipToContactRecordSet[0]["Revision"]) == 1)
                {
                  verUL = SC_OUI_Methods.verifyUserLocation(disaflag, POSRegArray);
                }
                if (verUL == 2)
                {
                  //DeliveryTypePopup();
                  updateShipping("Upd_NonShip_Lines", false, ""); //update the delivery tier on the non-shippable lines
                  SCCalcualteFrieghtandTax();
                }
              }
            }
            else
            {
              $("#SC-Shipmethod-popup").modal(
              {
                backdrop: 'static'
              });
              $("#SC-Shipmethod-popup").css(
              {
                "display": "flex",
                "justify-content": "center",
                "align-items": "center"
              });
            }

          });
          //End: on click of Calculate Frieght Chagres button
          next = 1;
          //Start:referredBy logic for new Contact
          $(document).on('click', '.reff-icon-img', function (e)
          {
            if (refsearchCount <= refsearchfields.length - 1)
            {
              e.preventDefault();
              next = parseInt(next);
              var addto = "#rcfield" + next;
              var addRemove = "#rcfield" + (next);
              next = parseInt(next) + 1;
              var newIn = '<select class="select-box margin-top sc-ref-select-box" id="cfield' + next + '" name="field' + next + '">';
              for (i = 0; i < refsearchfields.length; i++)
              {
                newIn += '<option value="' + refsearchfields[i] + '">' + refsearchfields[i] + '</option>';
              }

              newIn += '</select><input type="text" tabindex="' + (next + 1) + '" id="rcfield' + next + '" class="search-box sc-referral-search-box margin-top" autocomplete="off">';
              var newInput = $(newIn);

              var removeBtn = '<div id="remove' + (next - 1) + '" class="remove-me reff-remove-me margin-top"> <span id="referredremoveicon" class="glyphicon glyphicon-minus-sign icon-img-remove"></span></div>';
              var removeButton = $(removeBtn);
              $(addto).after(newInput);
              $(addRemove).after(removeButton);

              for (var j = 0; j < sFields.length; j++)
              {
                $("#cfield" + next + " option[value='" + sFields[j] + "']").wrap("<span>");
              }

              var e = document.getElementById("cfield" + next);
              var seletedvalue = e.options[e.selectedIndex].value;
              $("#cfield" + next + " option[value='" + seletedvalue + "']").attr('selected', 'selected');

              $(".sc-ref-select-box").each(function ()
              {
                $(this).attr("id"); //this.id
                if ($(this).attr("id") != "cfield" + next)
                {
                  $("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").wrap("<span>");
                }
              });

              sFields.push(seletedvalue);
              $(".reff-icon-img").hide();
              $("#rcfield" + next - 1).attr('data-source', $(addto).attr('data-source'));
              $("#count").val(next);
              searchfields();
              refsearchCount++;

            }
          });

          // Removing the search fields onclik of - icon
          $(document).on('click', '.reff-remove-me', function (e)
          {
            e.preventDefault();
            var idString = this.id.toString();

            var fieldNum = idString.substring(6, idString.length);
            var fieldID = "#cfield" + fieldNum;
            var rfieldID = "#rcfield" + fieldNum;

            var e = document.getElementById("cfield" + fieldNum);
            var seletedvalue = e.options[e.selectedIndex].value;
            $(".sc-ref-select-box").each(function ()
            {
              if ($(this).attr("id") != "cfield" + parseInt(fieldNum))
              {
                if ($("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").parent().is("span"))
                {
                  $("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").unwrap();
                }
              }
            });

            var sIndex = sFields.indexOf(seletedvalue);
            sFields.splice(sIndex, 1);
            $(this).remove();
            $(fieldID).remove();
            $(rfieldID).remove();
            searchfields();

            refsearchCount--;
          });


          $(document).on('click', '#sc-referredby-con-search', function (e)
          {
            e.stopImmediatePropagation();
            refSearchContact();
          });

          // on click of the enter in referred contact search
          $(document).on('keyup', '.sc-referral-search-box', function ()
          {
            if (event.keyCode === 13)
            {
              if (!$("#sc-referredby-con-search").hasClass("SC-disabled"))
              {
                refSearchContact();
              }
            }
          });

          // search fields and search box code
          $(document).on('keyup', '.sc-referral-search-box', function ()
          {
            selectedFieldId = $(this).attr("id").substring(2, $(this).attr("id").length);
            var e = document.getElementById("c" + selectedFieldId);
            var selectedvalue = e.options[e.selectedIndex].value;


            //NGOLLA commented the code for defect no:737
            /*if(selectedvalue == "Phone Number" || selectedvalue == "Customer Number" || selectedvalue == "Employee Number"){
            	this.value = this.value.replace(/[^0-9\.]/g,'');
            }
            */
            if ($(this).attr("id") != "rcfield0" && $("#rcfield0").val().length != 0 && $("#rcfield0").val() != "*" && $(this).val().length != 0 && $(this).val() != "*")
            {
              if (refsearchCount != refsearchfields.length)
              {
                $(".reff-icon-img").show();
              }
              else
              {
                $("#referredremoveicon").show();
              }
            }
            else if ($(this).attr("id") == "rcfield0" && $("#rcfield0").val().length != 0)
            {
              $(".sc-referral-search-box").each(function ()
              {
                if ($(this).attr("id") != "rcfield0")
                {
                  if ($(this).val().length != 0 && $(this).val() != "*")
                  {
                    $(".reff-icon-img").show();
                  }
                }
              });
            }
            else
            {
              $(".reff-icon-img").hide();
            }

            $(".sc-referral-search-box").each(function ()
            {
              if ($(this).val().length != 0 && $(this).val() != "*")
              {
                $("#sc-referredby-con-search").removeClass('SC-disabled');
                return false;
              }
              else
              {
                $("#sc-referredby-con-search").addClass('SC-disabled');
              }
            });
          });


          // dynamic values change for dropdowns
          $(document).on('click', '.sc-ref-select-box', function ()
          {
            var currentid = this.id;
            var e = document.getElementById(currentid);
            currentValue = e.options[e.selectedIndex].value;

          });
          $(document).on('change', '.sc-ref-select-box', function ()
          {
            var currentid = this.id;
            var e = document.getElementById(currentid);
            var seletedvalue = e.options[e.selectedIndex].value;

            $(".sc-ref-select-box").each(function ()
            {
              $(this).attr("id"); //this.id
              if ($(this).attr("id") != currentid)
              {
                $("#" + $(this).attr("id") + " option[value='" + seletedvalue + "']").wrap("<span>");
                if ($("#" + $(this).attr("id") + " option[value='" + currentValue + "']").parent().is("span"))
                {
                  $("#" + $(this).attr("id") + " option[value='" + currentValue + "']").unwrap();
                }
              }
              $("#" + currentid + " option[value='" + seletedvalue + "']").attr('selected', 'selected');
            });
            sFields.push(seletedvalue);
            var sIndex = sFields.indexOf(currentValue);
            sFields.splice(sIndex, 1);
          });

          $(document).on('click', '#SC-table-referral-search-contact tr', function ()
          {
            sc_reffid = $(this).attr('id');
            selected_RefConId = sc_reffid;
            selected_RefConIndex = selected_RefConId.replace("ref_row", "");
            $('#' + sc_reffid).addClass('highlate-row').siblings().removeClass('highlate-row');
            $("#SC-select-con-referredby").removeClass('SC-disabled');
          });

          $(document).on('click', '#SC-select-con-referredby', function ()
          {
            $("#SC-select-con-referredby").addClass('SC-disabled');
            $("#SC-Referral-search-contacts").modal('hide');
            var rowid = sc_reffid.slice(-1);
            SiebelJS.Log(rowid);
            var referedcontactInfo = $("#" + rowid + "refcondet").text();
            var refconrcd = referedcontactInfo.split('_');
            RefById = refconrcd[0];
            var RefbyName = refconrcd[1] + " " + refconrcd[2];
            /* if(refBy == "searchicon"){
		//SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Referred By",$("#referreby").val());
			document.getElementById("referreby").value= RefbyName;
			}else if(refBy == "searchbutton"){
			  document.getElementById("referreby").value= RefbyName;
			}*/
            $("#custommaskoverlay").show();
            setTimeout(function ()
            {
              SiebelApp.S_App.SetProfileAttr("RefferalInsider", RefbyName);
              // SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Referred By",RefbyName);
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("Name", "SCReferredById");
              inPS.SetProperty("Value", RefById);
              Bservice = SiebelApp.S_App.GetService("SessionAccessService");
              outPS = Bservice.InvokeMethod("SetProfileAttr", inPS);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("SetReferralInsider");
              //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
              document.getElementById("referreby").value = RefbyName;
              $("#custommaskoverlay").hide();
            }, 1000);
          });
          //End:referredBy logic for new Contact

          $(document).on("click", "#sc-print", function (e)
          {
            e.preventDefault();
            printQuote();
          });

          function SCCalcualteFrieghtandTax()
          {
            $("#SC-Delivery-Type").modal('hide');
            $("#SC-SO-CF-verify").modal(
            {
              backdrop: 'static'
            });
            $("#SC-SO-CF-verify").css(
            {
              "display": "flex",
              "justify-content": "center",
              "align-items": "center"
            });
            $(".modal-backdrop").css('background', '#ffffff');
            $("#custommaskoverlay").show();
            setTimeout(function ()
            {
              //SBOORlA:Added code for defect 765
              if (scAccountOrder)
              {
                SCVerify = 'Y';
                //SCfrieght = "N";
                SCfrieghtValidation = "N";
                SCfrieghtCalculation = "N";
                scRefresh = "N";
                var inPropSet = CCFMiscUtil_CreatePropSet();
                //Define the inPropSet property set with the information that InvokeMethod sends as input to the method that it calls.
                var ai = {};
                ai.async = true;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In validate Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In Validate Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", null, false);
              }
              else
              {
                SCVerify = 'N';
                //SCfrieght = "N";
                SCfrieghtValidation = "N";
                SCfrieghtCalculation = "N";
                scRefresh = "Y";
                SiebelJS.Log("Invoking");
                var CustomerCategory = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Customer Category");

                if ((!$("#SC-search-icon-referreby").hasClass("refeditable")) || (CustomerCategory == "Insider"))
                {
                  $("#referreby").val("");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Referred By", "");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "WriteRecord", null, false);
                }
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("RefreshBusComp");
                var inPropSet = CCFMiscUtil_CreatePropSet();
                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  SiebelJS.Log("In Refresh BC Error");
                };
                ai.cb = function ()
                {
                  SiebelJS.Log("In Refresh BC Call Back");
                };
                var canInvokeVerify = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "QuotesAndOrdersValidate");
                if (canInvokeVerify)
                {
                  DeliveryTypePopup();
                }
                else
                {
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                }
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", null, false);

              }
            }, 500);
          }


          function printQuote()
          {
            $("body").trigger('Custom.Start');
            //e.preventDefault();
            VQuoteValidUntillDate = $("#SC_QuoteValidDt").val();
            var sOrderId = ShipToContactRecordSet[0]["Id"];
            var fieldnames = 'SC Valid Until Date';
            var fieldvalues = VQuoteValidUntillDate;
            var Bservice = '',
              inPS = '',
              outPS = '';
            inPS = SiebelApp.S_App.NewPropertySet();
            outPS = SiebelApp.S_App.NewPropertySet();
            inPS.SetProperty("BO", "Order Entry (Sales)");
            inPS.SetProperty("BC", "Order Entry - Orders");
            inPS.SetProperty("FieldsArray", fieldnames);
            inPS.SetProperty("ValuesArray", fieldvalues);
            inPS.SetProperty("SearchSpecification", "[Id] = '" + sOrderId + "'");
            Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
            var ai = {};
            ai.async = false;
            ai.selfbusy = true;
            ai.scope = this;
            ai.mask = true;
            ai.opdecode = true;
            ai.errcb = function () {}
            ai.cb = function () {}
            Bservice.InvokeMethod("Insert", inPS, ai); //invoke the method
            //outPS = Bservice.InvokeMethod("Insert", inPS);
            var orderBC = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp();
            var orderSubType = orderBC.GetFieldValue("SC Sub-Type");
            setTimeout(function ()
            {
              // VALLA : 10ARP2018 : #712 Coded for Whole Sale and Commercial
              if (orderSubType == "Wholesale" || orderSubType == "Commercial")
              {
                var inPropSet = CCFMiscUtil_CreatePropSet();
                var ai = {};
                ai.async = true;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.log("New order invokation got timed out")
                  $('#custommaskoverlay').hide();
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("in bind datareports button click");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Report Output List Applet"].InvokeMethod("RefreshAppletUI");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Report Output List Applet"].GetPModel().ExecuteMethod("OnDrillDown", 'Report Name', 1);
                  setTimeout(function ()
                  {
                    $(".ui-dialog-buttonset button:nth-child(2)").trigger('click');
                    setTimeout(function ()
                    {
                      $(".ui-dialog-buttonset button:nth-child(3)").trigger('click');
                    }, 2000);
                  }, 2000);
                  $("body").trigger('Custom.End');
                };
                SC_OrderHeader_PMinstance.ExecuteMethod("InvokeMethod", "SCWCCreateQuote", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("SCWCCreateQuote");
              }
              else
              {
                var inPropSet = CCFMiscUtil_CreatePropSet();
                var ai = {};
                ai.async = true;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.log("New order invokation got timed out")
                  $('#custommaskoverlay').hide();
                };
                ai.cb = function ()
                {
                  SiebelJS.Log("in bind datareports button click");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Report Output List Applet"].InvokeMethod("RefreshAppletUI");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Report Output List Applet"].GetPModel().ExecuteMethod("OnDrillDown", 'Report Name', 1);

                  setTimeout(function ()
                  {
                    $("#SC-salesorderquote").modal("hide");
                    $(".ui-dialog-buttonset button:nth-child(2)").trigger('click');
                    setTimeout(function ()
                    {
                      $(".ui-dialog-buttonset button:nth-child(3)").trigger('click');
                    }, 2000);
                  }, 2000);
                  $("body").trigger('Custom.End');
                };
                SC_OrderHeader_PMinstance.ExecuteMethod("InvokeMethod", "SCCreateQuote", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("SCCreateQuote");
              }
            }, 1000);
          }

          $(document).on("click", "#createsalesquote", function ()
          {
            var sStoreNum = '',
              sDivSubType = '',
              bIsStorePresent = '',
              sDivSubTyp = '',
              sAllStoreNum = '';
            VQuoteValidUntillDate = "";
            $("#SC_QuoteValidDt").val("");
            $("#SC_personlizedtxt").val("");
            $(".email-error").css('display', 'none');
            $(".emial-id-valid").css('display', 'none');
            $(".email-id-contact").css('display', 'none');
            $(".emial-id-validate").css('display', 'none');

            sStoreNum = SiebelApp.S_App.GetProfileAttr("SC Store Number");
            sDivSubType = SiebelApp.S_App.GetProfileAttr("SC Primary Division Sub Type");
            var strDivType = SiebelApp.S_App.GetProfileAttr("SC Primary Division Type");

            var InPS = '',
              OutPS = '',
              sOrderId = '',
              BService = '';
            InPS = SiebelApp.S_App.NewPropertySet();
            OutPS = SiebelApp.S_App.NewPropertySet();
            Bservice = SiebelApp.S_App.GetService("SC Check LOV Values"); //get service
            var sSearchSpec = "[Name] = '" + sStoreNum + "' AND [Type] = 'SC_EMAIL_QUOTE'";
            InPS.SetProperty("searchExpr", sSearchSpec);
            OutPS = Bservice.InvokeMethod("CheckLovValues", InPS);
            var child = OutPS.GetChild(0);
            bIsStorePresent = child.GetProperty("ISRecordFlag");

            InPS = SiebelApp.S_App.NewPropertySet();
            OutPS = SiebelApp.S_App.NewPropertySet();
            Bservice = SiebelApp.S_App.GetService("SC Check LOV Values"); //get service
            var sSearchSpec = "[Name] = '" + strDivType + "-" + sDivSubType + "' AND [Type] = 'SC_EMAIL_RECEIPT'";
            InPS.SetProperty("searchExpr", sSearchSpec);
            OutPS = Bservice.InvokeMethod("CheckLovValues", InPS);
            var child = OutPS.GetChild(0);
            sDivSubTyp = child.GetProperty("ISRecordFlag");

            if (bIsStorePresent == "Y" || sDivSubTyp == "Y")
            {
              $("#SC-Sendemail").removeClass("SC-disabled");
              $("#SC-salesorderquote").modal(
              {
                backdrop: 'static'
              });
            }
            else
            {
              printQuote();
            }
          });

          $(document).on("click", "#SC-salesOrderquote-close", function ()
          {
            // 23032020 - For SalesQuote PopUp
            VQuoteValidUntillDate = "";
            $("#SC_QuoteValidDt").val("");
            $("#SC-salesorderquote").modal("hide");
          });

          function emailQuote()
          {
            var emailInPS = '',
              emailOutPS = '',
              sOrderId = '',
              BService = '';
            Vqemailchngflg = "N";
            emailInPS = SiebelApp.S_App.NewPropertySet();
            emailOutPS = SiebelApp.S_App.NewPropertySet();
            sOrderId = ShipToContactRecordSet[0]["Id"];
            Bservice = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
            emailInPS.SetProperty("ProcessName", "CX Email Quote Workflow");
            emailInPS.SetProperty("Object Id", sOrderId);
            emailInPS.SetProperty("ReportType", "Sales Order Quote");
            // 24032020 - For SalesQuote PopUp
            if (VQuoteValidUntillDate != "" && VQuoteValidUntillDate != undefined)
            {
              emailInPS.SetProperty("ValidUntilDate", VQuoteValidUntillDate);
            }
            if (VPersonalizedMsg != "" && VPersonalizedMsg != undefined)
            {
              emailInPS.SetProperty("Comment", VPersonalizedMsg);
            }
            var ai = {};
            ai.async = true;
            ai.selfbusy = true;
            ai.scope = this;
            ai.mask = true;
            ai.opdecode = true;
            ai.errcb = function ()
            {
              SiebelJS.log("New order invokation got timed out")
              $('#custommaskoverlay').hide();
            };
            ai.cb = function ()
            {
              $("#SC-salesorderquote").modal("hide");
              $("#SC-send-message-popup").modal("hide");
            }
            Bservice.ExecuteMethod("InvokeMethod", "SCCreateQuote", emailInPS, ai);
            //emailOutPS = Bservice.InvokeMethod("RunProcess", emailInPS);
            $("#SC-salesorderquote").modal("hide");
            $("#SC-send-message-popup").modal("hide");
          }

          $(document).on("click", "#SC-Sendemail", function (e)
          {
            e.preventDefault();
            // 23032020 - For SalesQuote PopUp
            VPersonalizedMsg = $("#SC_personlizedtxt").val();
            var contactId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Bill To Contact Id");
            var VquoteEmailaddr = $("#SC-qemailaddr").val();
            var emailnull = "N";

            var Emailaddress = $("#SC-qemailaddr").val();
            //console.log(Emailaddress);
            var reg = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;


            if (VquoteEmailaddr == null || VquoteEmailaddr == "")
            {
              $(".email-id-contact").css('display', 'none');
              $(".emial-id-validate").css('display', 'none');
              $(".email-error").css('display', 'inline-block');
              $(".emial-id-valid").css('display', 'block');
              //$("#SC-qemailaddr").select();
            }

            else if (!(reg.test(VquoteEmailaddr)))
            {
              $(".email-id-contact").css('display', 'none');
              $(".emial-id-valid").css('display', 'none');
              $(".email-error").css('display', 'inline-block');
              $(".emial-id-validate").css('display', 'block');
            }

            else
            {
              $("#custommaskoverlay").show();
              setTimeout(function ()
              {
                if (Vqemailchngflg == "Y")
                {
                  emailaddrupdate(contactId, VquoteEmailaddr);
                }
                Vqemailchngflg == "N"
                var OrderId = ShipToContactRecordSet[0]["Id"];
                $("#SC-Sendemail").addClass("SC-disabled");
                SC_OUI_Methods.triggerEmailQuote(OrderId, VQuoteValidUntillDate, VPersonalizedMsg) // emailQuote();
                $("#SC-salesorderquote").modal("hide");
                $("#SC-send-message-popup").modal("hide");
                $("#custommaskoverlay").hide();
              }, 50);
            }
          });

          $(document).on("click", "#SC-sales-sendemailquote-close", function ()
          {
            VPersonalizedMsg = "";
            $("#SC_personlizedtxt").val("");
            Vqemailchngflg = "N";
            $("#SC-send-message-popup").modal("hide");
            $(".email-error").css('display', 'none');
            $(".emial-id-valid").css('display', 'none');
            $(".email-id-contact").css('display', 'none');
            $(".emial-id-validate").css('display', 'none');
          });

          $(document).on("click", "#sc-Cancelsend-button", function ()
          {
            // 23032020 - For SalesQuote PopUp
            VPersonalizedMsg = "";
            $("#SC_personlizedtxt").val("");
            Vqemailchngflg = "N";
            $("#SC-send-message-popup").modal("hide");
            $(".email-error").css('display', 'none');
            $(".emial-id-valid").css('display', 'none');
            $(".email-id-contact").css('display', 'none');
            $(".emial-id-validate").css('display', 'none');
          });

          $(document).on("click", "#sc-email", function ()
          {
            // 23032020 - For SalesQuote PopUp
            VQuoteValidUntillDate = $("#SC_QuoteValidDt").val();
            var contactAddr = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Primary Bill To Email Address");
            $("#SC-qemailaddr").val(contactAddr);
            $("#SC-salesorderquote").modal("hide");
            $("#SC-send-message-popup").modal(
            {
              backdrop: 'static'
            });
          });
          $(document).on("click", "#SC-qeditemailadress", function (e)
          {
            Vqemailchngflg = "Y";
            $("#SC-qemailaddr").select();
            $(".emial-id-valid").css('display', 'none');
            $(".emial-id-validate").css('display', 'none');
            $(".email-error").css('display', 'inline-block');
            $(".email-id-contact").css('display', 'block');
          });

          $(document).on("click", "#SC-qemailaddr", function (e)
          {
            Vqemailchngflg = "Y";
            $(".emial-id-valid").css('display', 'none');
            $(".emial-id-validate").css('display', 'none');
            $(".email-error").css('display', 'inline-block');
            $(".email-id-contact").css('display', 'block');
          });

          $(document).on("keyup", "#SC_personlizedtxt", function (event)
          {
            $("#SC_personlizedtxtCnt").text($(this).val().length + "/500");
          });


          $(document).on("change", "#SC-qemailaddr", function (event)
          {
            Vqemailchngflg = "Y";
          });

          function emailaddrupdate(contactId, VquoteEmailaddr)
          {
            var fieldnames = "Email Address";
            var fieldvalues = VquoteEmailaddr;
            var Bservice = '',
              inPS = '',
              outPS = '';
            inPS = SiebelApp.S_App.NewPropertySet();
            outPS = SiebelApp.S_App.NewPropertySet();
            inPS.SetProperty("BO", "Contact");
            inPS.SetProperty("BC", "Contact");
            inPS.SetProperty("FieldsArray", fieldnames);
            inPS.SetProperty("ValuesArray", fieldvalues);
            inPS.SetProperty("SearchSpecification", "[Id] = '" + contactId + "'");
            Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
            outPS = Bservice.InvokeMethod("Insert", inPS);
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
            //$("#SC-salesorderquote").modal("hide");
          }

          $(document).on("click", "#sc-both", function (e)
          {
            e.preventDefault();
            // 23032020 - For SalesQuote PopUp
            printQuote();
            VQuoteValidUntillDate = $("#SC_QuoteValidDt").val();
            $("#SC-salesorderquote").modal("hide");

            $("#SC-send-message-popup").modal(
            {
              backdrop: 'static'
            });

          });

          //Start:on focus out of phone number in lineitems 
          $(document).on("focusout", ".Ship-ShipToContactPhNum-lineitem", function ()
          {
            SiebelJS.Log($(this).val());
            var lineid = $(this).attr('id');
            var resLineID = lineid;
            resLineID = resLineID.split("Ship");
            var phn_line_row_id = resLineID[0];
            //var phn_line_row_id=lineid.charAt(0);
            var mblNumb_def = $(this).val();
            if (mblNumb_def != '' && mblNumb_def.match(/^\d+$/) && mblNumb_def.length == 10)
            {
              var USFormt_mblNum = '';
              USFormt_mblNum = "(" + mblNumb_def.substring(0, mblNumb_def.length - 7) + ") " + mblNumb_def.substring(3, mblNumb_def.length - 4) + "-" + mblNumb_def.substring(6, mblNumb_def.length);
              mblNumb_def = USFormt_mblNum;
            }
            SiebelJS.Log(mblNumb_def);
            if (mblNumb_def.length == 14 || mblNumb_def.length == 0)
            {
              //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetSelection(phn_line_row_id);
              $("#s_" + appletSeq + "_l tr#" + phn_line_row_id + "").trigger("click");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("SC Preferred Contact", mblNumb_def);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].InvokeMethod("WriteRecord");
              $("#" + phn_line_row_id + "Ship-ShipToContactPhNum").val(mblNumb_def);
            }
          });
          //End:on focus out of phone number in lineitems 
          //Start:on change of ship method 
          $(document).on("change", ".Ship-ShippingMethod", function ()
          {
            var strPrevShipMethod;
            var lineid = $(this).attr('id');
            var reshipMethodId = lineid;
            reshipMethodId = reshipMethodId.split("Ship");
            var ship_line_row_id = reshipMethodId[0];
            //var ship_line_row_id=lineid.charAt(0);
            SiebelJS.Log($(this).val());
            //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetSelection(ship_line_row_id);
            $("#s_" + appletSeq + "_l tr#" + ship_line_row_id + "").trigger("click");
            strPrevShipMethod = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().GetFieldValue("Ship Method");
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetFieldValue("Ship Method", $(this).val());
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("WriteRecord");
            if ($(this).val() == "Recd At Store")
            {
              if ($("#" + ship_line_row_id + "defaultRequestShipDate").val() != "" || $("#" + ship_line_row_id + "defaultRequestShipDate").val() != '')
              {
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                var fieldnames = "Due Date";
                var fieldvalues = "";
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items (Simple)");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("ValuesArray", fieldvalues);
                inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "' AND [Id]='" + shippingItemsRecordSet[line_date_row_id]["Id"] + "'");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);
              }
              $("#" + ship_line_row_id + "defaultRequestShipDate").val('');
              $("#" + ship_line_row_id + "defaultRequestShipDate").addClass("SC-readonly");
              $("#" + ship_line_row_id + "defaultRequestShipDate").removeClass("defaultRequestShipDate");

            }
            else if ($("#" + ship_line_row_id + "defaultRequestShipDate").hasClass("SC-readonly"))
            {
              $("#" + ship_line_row_id + "defaultRequestShipDate").val('');
              $("#" + ship_line_row_id + "defaultRequestShipDate").removeClass("SC-readonly");
              $("#" + ship_line_row_id + "defaultRequestShipDate").addClass("defaultRequestShipDate");

            }
            if ($(this).val() != "Recd At Store")
            {
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("OrderId", orderid);
              Bservice = SiebelApp.S_App.GetService("SC Order Management Service"); //get service
              outPS = Bservice.InvokeMethod("UpdateShipFromDetails", inPS);

              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("Object Id", orderid);
              inPS.SetProperty("LineItemId", shippingItemsRecordSet[ship_line_row_id - 1]["Id"]);
              inPS.SetProperty("ProcessName", "SC Get ATP Scheduled Date From GOP");
              Bservice = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
              outPS = Bservice.InvokeMethod("RunProcess", inPS);
              if (strPrevShipMethod == "Home Delivery" || $(this).val() == "Home Delivery") //30Sep24;SL;Added for Tiered Delivery
              {
                //$('[id$="Delivery-Tier"]').empty(); //remove the delivery tier options
                updateShipping("", true, ""); //remove the delivery tier options
                if (strPrevShipMethod == "Home Delivery") //user selects shipping other than Home Delivery
                {
                  if (this.parentElement.nextElementSibling.innerHTML.indexOf("Delivery-Tier") != -1)
                    this.parentElement.nextElementSibling.innerHTML = ""; //remove delivery tier dropdown
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetFieldValue("Shipping", "");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("WriteRecord");
                }
                else
                {
                  this.parentElement.nextElementSibling.innerHTML = "<select class='shipping-dropdown' id='" + (ship_line_row_id) + "Delivery-Tier'></select>"; //enable delivery tier dropdown on current line
                }
                getDeliveryTierOptions(orderid); //evaluate delivery tiers
              }
            }
            var ship_line_row_id1 = parseInt(ship_line_row_id) - 1;
            $("#" + ship_line_row_id + "Ship-ShippingLineItemATP").text(SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().Get("GetRecordSet")[ship_line_row_id1]["ATP Status As Of Date"]);
          });
          //Start:on change of ship method
          //Start:change phone format
          $(document).on("keypress", "#Ship-Default-PhNumber,#scship-Acc-phone-number", function ()
          {
            var inpId = this.id;
            if (inpId == "Ship-Default-PhNumber")
              var phonenumber = $("#Ship-Default-PhNumber").val();
            else
              var phonenumber = $("#scship-Acc-phone-number").val();
            if (phonenumber.length === 3)
            {
              phonenumber = "(" + phonenumber + ") ";
            }
            else if (phonenumber.length === 9)
            {
              phonenumber = phonenumber + "-";
            }
            $(this).val(phonenumber);
          });

          var mblNumb_def = "";
          var inpId = "";
          $(document).on("focusout", "#Ship-Default-PhNumber,#scship-Acc-phone-number", function ()
          {
            mblNumb_def = $(this).val();
            inpId = this.id;
            //Start: For Phone Validation
            jQuery.validator.addMethod(
              "regex",
              function (value, element, regexp)
              {
                if (regexp.constructor != RegExp)
                  regexp = new RegExp(regexp);
                else if (regexp.global)
                  regexp.lastIndex = 0;
                return this.optional(element) || regexp.test(value);
              },
              "");
            //End: For Phone Validation

            SiebelJS.Log(mblNumb_def);

            $("#SC-default-ship-container").submit();
            //hiding the Loader

          });

          $("#SC-default-ship-container").validate(
          {
            rules:
            {
              shipdefaultnumber:
              {
                regex: /\(?[\d\s]{3}\)[\w\s][\d\s]{3}-[\d\s]{4}$/
              },
              contactshipdefaultnumber:
              {
                regex: /\(?[\d\s]{3}\)[\w\s][\d\s]{3}-[\d\s]{4}$/
              }
            },
            messages:
            {
              shipdefaultnumber: "Please Enter Valid Phone Number",
              contactshipdefaultnumber: "Please Enter Valid Phone Number",
            },
            tooltip_options:
            {
              shipdefaultnumber:
              {
                trigger: 'focus',
                placement: 'bottom',
                html: true
              },
              contactshipdefaultnumber:
              {
                trigger: 'focus',
                placement: 'bottom',
                html: true
              }
            },
            submitHandler: function (form)
            {
              //Start loader 
              $("body").trigger('Custom.Start');
              setTimeout(function ()
              {
                //if(mblNumb_def.length==14||mblNumb_def.length==0){
                var fieldnames = "SC Preferred Contact";
                var fieldvalues = "";
                fieldvalues = mblNumb_def;
                SiebelJS.Log(fieldvalues);
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("ValuesArray", fieldvalues);
                //SADDALA for Defect.no 561 removed extra searchspec
                //inPS.SetProperty("SearchSpecification","[Order Header Id] = '" + orderid + "' AND [Ship To Contact Id] = '" + conId + "'AND EXISTS([Product Line]<>'DELIVERY') AND [Product Type Code]<>'"+ProductTypeCode+"'" );
                inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "' AND [Fulfillment Status Code]='In Progress'");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);
                if (inpId != "scship-Acc-phone-number")
                {
                  $("#Ship-Default-PhNumber").val(mblNumb_def);
                  $(".Ship-ShipToContactPhNum-lineitem").val(mblNumb_def);
                }
                else
                {
                  $("#scship-Acc-phone-number").val(mblNumb_def);
                  $(".Ship-ShipToContactPhNum-lineitem").val(mblNumb_def);
                }
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", mblNumb_def);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In 2716 Refresh BC Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In 2721 Refresh BC Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                // }               $("body").trigger('Custom.End');
              }, 1000);
            }
          });


          //End:on focus out of Default Shipping Phone number field 

          $(document).on("click", "#SC-select-Accountcontact-shipping", function ()
          {
            $("#SC-search-contacts").modal('hide');
            $("#SC-select-Accountcontact-shipping").addClass('SC-disabled');
            $("body").trigger('Custom.Start');
            setTimeout(function ()
            {
              var rowid = sc_rowid.slice(-1);
              SiebelJS.Log(rowid);
              var shipcontactrcd = $("#" + rowid + "shiprcdset").text();
              var shippingrecords = shipcontactrcd.split('_');
              SiebelJS.Log("shipcontactrcd" + shippingrecords);
              var Addrid = shippingrecords[0];
              SiebelJS.Log(searchcontact_lineitem);
              var ShipToContactName = shippingrecords[2] + " " + shippingrecords[3];
              var shipToPhn_number = "";
              shipToPhn_number = shippingrecords[4];
              if (shipToPhn_number != '' && shipToPhn_number.match(/^\d+$/) && shipToPhn_number.length == 10)
              {
                var USFormt_mblNum = '';
                USFormt_mblNum = "(" + shipToPhn_number.substring(0, shipToPhn_number.length - 7) + ") " + shipToPhn_number.substring(3, shipToPhn_number.length - 4) + "-" + shipToPhn_number.substring(6, shipToPhn_number.length);
                shipToPhn_number = USFormt_mblNum;
              }
              conId = shippingrecords[1];

              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", conId);
              if (Addrid != "null" && Addrid[1] != "" && Addrid[1] != "No Match Row Id" && Addrid[1] != "undefined")
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", Addrid);
              else
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", "");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", shipToPhn_number);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
              var fieldvalues = "";
              if (Addrid != "null" && Addrid != "" && Addrid != "No Match Row Id" && Addrid != "undefined")
                fieldvalues = conId + ',' + Addrid + ',' + shipToPhn_number + ',';
              else
                fieldvalues = conId + ',' + ',' + shipToPhn_number + ',';
              var fieldnames = "Ship To Contact Id,Ship To Address Id,SC Preferred Contact";
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("BO", "Order Entry (Sales)");
              inPS.SetProperty("BC", "Order Entry - Line Items");
              inPS.SetProperty("FieldsArray", fieldnames);
              inPS.SetProperty("ValuesArray", fieldvalues);
              inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
              Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
              outPS = Bservice.InvokeMethod("Insert", inPS);
              var ai = {};
              ai.async = false;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In 2716 Refresh BC Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In 2721 Refresh BC Call Back");
              };
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
              //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
              ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
              shippingItemsRecordSet = pm.Get("GetRecordSet");
              lineitemrcdset = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
              Get_OrderShipToLineItems(shippingItemsRecordSet, lineitemrcdset);
              addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
              $("#Ship-Default-BillToAddress").html(addressLine);
              var mblNumb_def = ShipToContactRecordSet[0]["SC Preferred Contact"];
              if (mblNumb_def != '' && mblNumb_def.match(/^\d+$/) && mblNumb_def.length == 10)
              {
                var USFormt_mblNum = '';
                USFormt_mblNum = "(" + mblNumb_def.substring(0, mblNumb_def.length - 7) + ") " + mblNumb_def.substring(3, mblNumb_def.length - 4) + "-" + mblNumb_def.substring(6, mblNumb_def.length);
                mblNumb_def = USFormt_mblNum;
              }
              $("#Ship-Default-PhNumber").val(mblNumb_def);
              conId = ShipToContactRecordSet[0]["Ship To Contact Id"];
              var ShipToContactName = ShipToContactRecordSet[0]["Primary Ship To First Name"] + " " + ShipToContactRecordSet[0]["Primary Ship To Last Name"];
              $("#Ship-Default-Name").html(ShipToContactName);
              $("body").trigger('Custom.End');
            }, 50);
          });
          $(document).on("click", "#SC-select-contact-shipping", function ()
          {
            $("#SC-search-contacts").modal('hide');
            $("#SC-select-contact-shipping").addClass('SC-disabled');
            $("body").trigger('Custom.Start');
            setTimeout(function ()
            {
              var rowid = sc_rowid.slice(-1);
              SiebelJS.Log(rowid);
              var shipcontactrcd = $("#" + rowid + "shiprcdset").text();
              var shippingrecords = shipcontactrcd.split('_');
              SiebelJS.Log("shipcontactrcd" + shippingrecords);
              var Addrid = shippingrecords[0];
              SiebelJS.Log(searchcontact_lineitem);
              var ShipToContactName = shippingrecords[2] + " " + shippingrecords[3];
              var shipToPhn_number = shippingrecords[4];
              if (shipToPhn_number != '' && shipToPhn_number.match(/^\d+$/) && shipToPhn_number.length == 10)
              {
                var USFormt_mblNum = '';
                USFormt_mblNum = "(" + shipToPhn_number.substring(0, shipToPhn_number.length - 7) + ") " + shipToPhn_number.substring(3, shipToPhn_number.length - 4) + "-" + shipToPhn_number.substring(6, shipToPhn_number.length);
                shipToPhn_number = USFormt_mblNum;
              }
              conId = shippingrecords[1];
              if (Accname != "")
              {
                var AccountBService = '',
                  Acc_inPS = '',
                  Acc_outPS = '';
                Acc_inPS = SiebelApp.S_App.NewPropertySet();
                Acc_outPS = SiebelApp.S_App.NewPropertySet();
                Acc_inPS.SetProperty("Object Id", Accid);
                Acc_inPS.SetProperty("Account Id", Accid);
                Acc_inPS.SetProperty("Contact Id", conId);
                Acc_inPS.SetProperty("ProcessName", "SC Account Contact Assoc WF");
                AccountBService = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
                Acc_outPS = AccountBService.InvokeMethod("RunProcess", Acc_inPS); //invoke the method
              }
              var scShipToContactId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Ship To Contact Id")
              if (searchcontact_lineitem == "N" || (scShipToContactId == "" || scShipToContactId == "null" || scShipToContactId == "undefined" || scShipToContactId == "No Match Row Id"))
              {
                conId = shippingrecords[1];
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", conId);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", Addrid);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", shipToPhn_number);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                SiebelJS.Log("shipToContactRecordSet::" + JSON.stringify(orderrcd));
                SiebelJS.Log("Addrid" + Addrid);
                SiebelJS.Log("phnnumber" + shipToPhn_number);
                GetAddressList(conId);
                addressLine = AttachAddresses(Addrid);
                $("#Ship-Default-Name").html(ShipToContactName);
                $("#Ship-Default-BillToAddress").html(addressLine);
                $(".ShipToContactlineitem").val(ShipToContactName);
                var fieldnames = "";
                var fieldvalues = "";
                fieldvalues = conId + ',' + Addrid + ',' + shipToPhn_number;
                fieldnames = "Ship To Contact Id,Ship To Address Id,SC Preferred Contact";
                $("#Ship-Default-PhNumber").val(shipToPhn_number);
                $(".Ship-ShipToContactPhNum-lineitem").val(shipToPhn_number);
                SiebelJS.Log(fieldvalues);
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("UsedAt", "selectcontact");
                inPS.SetProperty("ValuesArray", fieldvalues);
                //SADDALA for Defect.no 561 removed extra searchspec
                //inPS.SetProperty("SearchSpecification","[Order Header Id] = '" + orderid + "' AND [Ship To Contact Id] = '" + conId + "'AND EXISTS([Product Line]<>'DELIVERY') AND [Product Type Code]<>'"+ProductTypeCode+"'" );
                inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);
                //SNARRA:27-07-2018 Added for Performance POC
                if (localStorage.getItem('isNewSalesOrder') != "Y")
                  $(".Ship-ShipToAddress").html(addressLine);
              }
              else
              {
                //SPATIBANDLA :changed code for defect 616
                var Linecon_ID = shippingrecords[1];
                SiebelJS.Log(Linecon_ID);
                var Addrid = shippingrecords[0];
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetSelection(line_row_id);
                $("#s_" + appletSeq + "_l tr#" + line_row_id + "").trigger("click");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Contact Id", Linecon_ID);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Address Id", Addrid);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("SC Preferred Contact", shipToPhn_number);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].InvokeMethod("WriteRecord");
                var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                SiebelJS.Log("shipToContactRecordSet::" + JSON.stringify(orderrcd));
                Add_obj = GetAddressList(Linecon_ID);
                addressLine = AttachAddresses(Addrid);
                $("#" + line_row_id + "Ship-ShipToContact").val(ShipToContactName);
                $("#" + line_row_id + "Ship-ShipToContactPhNum").val(shipToPhn_number);
                $("#" + line_row_id + "Ship-ShipToAddress").html(addressLine);
                $("#" + line_row_id + "Ship-ShipToContactImg").trigger("click");

              }
              if (AddrServiceLevel[Addrid] == "")
              {
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("Id", Addrid);
                Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
                outPS = Bservice.InvokeMethod("GetHDEligibility", inPS);
              }
              $("body").trigger('Custom.End');
            }, 1000);

          })
          $(document).on("click", ".sc-shipping-icon-con", function ()
          {
            SiebelJS.Log("clicked");
            var lineid = $(this).attr('id');
            var resrowId = lineid;
            //line_row_id=lineid.charAt(0);
            resrowId = resrowId.split("Ship");
            line_row_id = resrowId[0];
            SiebelJS.Log(line_row_id);
          })
          $(document).on("click", ".Ship-ShipToAddress-lineitem", function ()
          {
            SiebelJS.Log("clicked");
            var lineid = $(this).attr('id');
            var resRowID = lineid;
            resRowID = resRowID.split("Ship");
            Addr_line_row_id = resRowID[0];
            //Addr_line_row_id=lineid.charAt(0);
            SiebelJS.Log(Addr_line_row_id);
          })
          $("#SC-CF-failure-button").click(function ()
          {
            $("#SC-SO-CF-failure").modal('hide');
            $("#SC-CF-failure-button").css(
            {
              "display": "",
              "justify-content": "",
              "align-items": ""
            });
          });

          $(".SC-input").focus(function ()
          {
            $(this).parent().addClass("is-active is-completed");
          });

          $(".SC-input").focusout(function ()
          {
            if ($(this).val() === "")
              $(this).parent().removeClass("is-completed");
            $(this).parent().removeClass("is-active");
          });


          $(document).on("hide.bs.collapse", "#SC-SO-ShippingSummary-Body", function ()
          {
            $("#ship-expand-collapse").addClass('iconClosed');
            $("#ship-expand-collapse").removeClass('iconOpen');
          });

          $(document).on("show.bs.collapse", "#SC-SO-ShippingSummary-Body", function ()
          {
            $("#ship-expand-collapse").addClass('iconOpen');
            $("#ship-expand-collapse").removeClass('iconClosed');
          });


          //after clicking on the back to line items button
          $(document).on('click', "#SC-Ship-BackToProducts", function ()
          {
            localStorage.setItem("flowfrom", "backtoline");
            $("#browsecatalogdiv").show();
            $("#sccataloguecategory").show();
            $("#scproductstable").show();
            $("#Ship-Option-Markup").hide();
            $("#Default-Shipping").hide();
            $("#Shipping-Detils").hide();
			   $(".SC-Discount-button").show(); //Sukumar 12/18 to hide discount button
            $(".maualdiscaddons").show(); //Sukumar 12/18 to hide discount button
			 $(".prodcoupon").show();//Sukumar 03/25 to hide discount button
$(".coupdescdel").show(); //Sukumar 03/25 to hide discount button
$(".scmanualdisdelete").show();//Sukumar 03/25 to hide discount button
$(".addonsdel").show();
			if($('[id^=ProductCoupon]')[0].innerText === "no coupons applied"){$('[id^=ProductCoupon]').prev().hide()}
			  if($('[id^=scmanualcouponval]')[0].innerText === "no coupons applied"){$('[id^=scmanualcouponval]').prev().hide()}
            //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
          });


          SC_OUI_Methods.PH_USFormat("SC-SO-Ship-NewCon-Ph");
          $(document).on('click', '#SC-SO-Ship-SaveNewContact', function ()
          {

            jQuery.validator.addMethod(
              "regex",
              function (value, element, regexp)
              {
                if (regexp.constructor != RegExp)
                  regexp = new RegExp(regexp);
                else if (regexp.global)
                  regexp.lastIndex = 0;
                return this.optional(element) || regexp.test(value);
              },
              "");


            var emailVal = $('#SC-SO-Ship-EmailAddress').val();
            if (emailVal == '')
            {}
            else
            {
              $("#SC-SO-Ship-EmailAddress").attr('name', 'emailfield');
            }

            var errorCodes = ErrorCodesfn.errorcodes();
            $(document).ready(function ()
            {

              $("#SC-SO-Ship-CreateContactForm").validate(
              {
                rules:
                {
                  firstname:
                  {
                    required: true
                  },
                  lastname:
                  {
                    required: true
                  },
                  emailfield:
                  {
                    email: true
                  },
                  /*emailEmpty: {
                  	required: true
                  },*/
                  address:
                  {
                    required: true
                  },
                  city:
                  {
                    required: true
                  },
                  state:
                  {
                    required: true
                  },
                  zipcode:
                  {
                    required: true
                  },
                  phone:
                  {
                    regex: /\(?[\d\s]{3}\)[\w\s][\d\s]{3}-[\d\s]{4}$/
                  }

                },
                messages:
                {
                  firstname: errorCodes.SC_REQUIRED_FIRST_NAME,
                  lastname: errorCodes.SC_REQUIRED_LAST_NAME,
                  address: errorCodes.SC_REQUIRED_ADDRESS,
                  emailfield: errorCodes.SC_INVALID_EMAIL,
                  //emailEmpty: errorCodes.SC_REQUIRED_EMAIL,
                  city: errorCodes.SC_REQUIRED_CITY,
                  state: errorCodes.SC_REQUIRED_STATE,
                  zipcode: errorCodes.SC_REUIRED_POSTAL_CODE,
                  phone: errorCodes.SC_MOBILE_NUMBER

                },
                tooltip_options:
                {
                  firstname:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  lastname:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  address:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  emailfield:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  /*emailEmpty: {
                  	trigger: 'focus',
                  	placement: 'bottom',
                  	html: true
                  },*/
                  city:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  state:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  zipcode:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  },
                  phone:
                  {
                    trigger: 'focus',
                    placement: 'bottom',
                    html: true
                  }

                },

                submitHandler: function (form)
                {
                  event.preventDefault();
                  var Bservice = '',
                    inPS = '',
                    outPS = '';
                  $(".SC-add-table-popup").modal("hide");
                  $("body").trigger('Custom.Start');
                  setTimeout(function ()
                  {
                    inPS = SiebelApp.S_App.NewPropertySet();
                    outPS = SiebelApp.S_App.NewPropertySet();
                    inPS.SetProperty("CellularNumber", ($("#SC-SO-Ship-NewCon-Ph").val()).replace(/[^0-9]/g, ''));
                    inPS.SetProperty("EmailAddress", $("#SC-SO-Ship-EmailAddress").val());
                    inPS.SetProperty("ContactFirstName", $("#SC-SO-Ship-FirstName").val());
                    inPS.SetProperty("ContactLastName", $("#SC-SO-Ship-LastName").val());
                    inPS.SetProperty("Address Mail to", $("#SC-SO-Ship-Address").val());
                    //Consider SC-SO-Ship-Apt also
                    inPS.SetProperty("SC StreetAddr2", $("#SC-SO-Ship-Apt").val());
                    inPS.SetProperty("City", $("#SC-SO-Ship-City").val());
                    inPS.SetProperty("State", $("#SC-SO-Ship-State").val());
                    inPS.SetProperty("Postal Code", $("#SC-SO-Ship-ZipCode").val());

                    inPS.SetProperty("ProcessName", "SC Create New Contact Flow");
                    //SiebelJS.Log("Invoking Workflow");
                    Bservice = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
                    outPS = Bservice.InvokeMethod("RunProcess", inPS); //invoke the method
                    SiebelJS.Log("Workflow invoked");

                    var con_child = outPS.GetChild(0);

                    newconId = con_child.GetProperty("ContactId");
                    var addId = con_child.GetProperty("AddressId");

                    SiebelJS.Log("Contact Saved with Id" + conId + "; and Address Id: " + addId);
                    if (newconId != "" && addId != "" && (newconId != undefined && addId != undefined))
                    {
                      if (scAccountOrder)
                      {
                        var AccountBService = '',
                          Acc_inPS = '',
                          Acc_outPS = '';
                        Acc_inPS = SiebelApp.S_App.NewPropertySet();
                        Acc_outPS = SiebelApp.S_App.NewPropertySet();
                        Acc_inPS.SetProperty("Object Id", Accid);
                        Acc_inPS.SetProperty("Account Id", Accid);
                        Acc_inPS.SetProperty("Contact Id", newconId);
                        Acc_inPS.SetProperty("ProcessName", "SC Account Contact Assoc WF");
                        AccountBService = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
                        Acc_outPS = AccountBService.InvokeMethod("RunProcess", Acc_inPS); //invoke the method
                      }
                      var ShipToContactName_New = $("#SC-SO-Ship-FirstName").val() + " " + $("#SC-SO-Ship-LastName").val();
                      conId = con_child.GetProperty("ContactId");
                      SiebelJS.Log("Both are not null");
                      var scShipToContactId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Ship To Contact Id")
                      if (addnewcontact_lineitem == 'N' || (scShipToContactId == "" || scShipToContactId == "null" || scShipToContactId == "undefined" || scShipToContactId == "No Match Row Id"))
                      {
                        $("#Ship-Default-Name").html(ShipToContactName_New);
                        $("#Ship-Default-PhNumber").val($("#SC-SO-Ship-NewCon-Ph").val());
                        $(".Ship-ShipToContact").val(ShipToContactName_New);
                        $(".Ship-ShipToContactPhNum").val($("#SC-SO-Ship-NewCon-Ph").val());
                        $(".Ship-ShipToContactPhNum-lineitem").val($("#SC-SO-Ship-NewCon-Ph").val());
                        $(".ShipToContactlineitem").val(ShipToContactName_New);
                        var phnNumber = $("#SC-SO-Ship-NewCon-Ph").val();
                        GetAddressList(conId);
                        addressLine = AttachAddresses(addId);
                        $(".Ship-ShipToAddress").html(addressLine);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Contact Id", conId);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", addId);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Preferred Contact", phnNumber);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                        ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                        var fieldnames = "Ship To Contact Id,Ship To Address Id,SC Preferred Contact";
                        var fieldvalues = "";
                        fieldvalues = conId + ',' + addId + ',' + phnNumber;
                        SiebelJS.Log(fieldvalues);
                        var Bservice = '',
                          inPS = '',
                          outPS = '';
                        inPS = SiebelApp.S_App.NewPropertySet();
                        outPS = SiebelApp.S_App.NewPropertySet();
                        inPS.SetProperty("BO", "Order Entry (Sales)");
                        inPS.SetProperty("BC", "Order Entry - Line Items");
                        inPS.SetProperty("FieldsArray", fieldnames);
                        inPS.SetProperty("ValuesArray", fieldvalues);
                        inPS.SetProperty("UsedAt", "selectcontact");
                        //SADDALA for Defect.no 561 removed extra searchspec
                        //inPS.SetProperty("SearchSpecification","[Order Header Id] = '" + orderid + "' AND [Ship To Contact Id] = '" + conId + "'AND EXISTS([Product Line]<>'DELIVERY') AND [Product Type Code]<>'"+ProductTypeCode+"'" );
                        inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
                        Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                        outPS = Bservice.InvokeMethod("Insert", inPS);
                      }
                      else
                      {
                        //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetSelection(line_row_id);
                        $("#s_" + appletSeq + "_l tr#" + line_row_id + "").trigger("click");
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Contact Id", newconId);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Address Id", addId);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("SC Preferred Contact", $("#SC-SO-Ship-NewCon-Ph").val());
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].InvokeMethod("WriteRecord");
                        var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                        SiebelJS.Log("shipToContactRecordSet::" + JSON.stringify(orderrcd));
                        Add_obj = GetAddressList(newconId);
                        addressLine = AttachAddresses(addId);
                        $("#" + line_row_id + "Ship-ShipToContact").val(ShipToContactName_New);
                        $("#" + line_row_id + "Ship-ShipToContactPhNum").val($("#SC-SO-Ship-NewCon-Ph").val());
                        $("#" + line_row_id + "Ship-ShipToAddress").html(addressLine);
                        $("#" + line_row_id + "Ship-ShipToContactImg").trigger("click");
                      }
                      var ai = {};
                      ai.async = false;
                      ai.selfbusy = true;
                      ai.scope = this;
                      ai.mask = true;
                      ai.opdecode = true;
                      ai.errcb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                        SiebelJS.Log("In 3211 Refresh BC Error");
                      };
                      ai.cb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                        SiebelJS.Log("In 3215 Refresh BC Call Back");
                      };
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                      //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                    }
                    document.getElementById("SC-SO-Ship-CreateContactForm").reset();
                    $("#SC-SO-Ship-FirstName").removeClass("is-completed");
                    $("#SC-SO-Ship-LastName").removeClass("is-completed");
                    $("#SC-SO-Ship-EmailAddress").removeClass("is-completed");
                    $("#SC-SO-Ship-Address").removeClass("is-completed");
                    $("#SC-SO-Ship-NewCon-Ph").removeClass("is-completed");
                    $("#SC-SO-Ship-Apt").removeClass("is-completed");
                    $("#SC-SO-Ship-City").removeClass("is-completed");
                    $("#SC-SO-Ship-ZipCode").removeClass("is-completed");
                    $("#SC-SO-Ship-State").removeClass("is-completed");
                    $("#SC-SO-Ship-FirstName").removeClass("is-active");
                    $("#SC-SO-Ship-LastName").removeClass("is-active");
                    $("#SC-SO-Ship-EmailAddress").removeClass("is-active");
                    $("#SC-SO-Ship-Address").removeClass("is-active");
                    $("#SC-SO-Ship-NewCon-Ph").removeClass("is-active");
                    $("#SC-SO-Ship-Apt").removeClass("is-active");
                    $("#SC-SO-Ship-City").removeClass("is-active");
                    $("#SC-SO-Ship-ZipCode").removeClass("is-active");
                    $("#SC-SO-Ship-State").removeClass("is-active");
                    //30Sep24;SL;re-evaluate delivery tiers
                    updateShipping("", true, ""); //remove the delivery tier options
                    getDeliveryTierOptions(orderid); //evaluate delivery tier
                    $("body").trigger('Custom.End');
                  }, 1000);

                } //closing submit handler
              }); //end of validate fn
            }); //End of document.ready
          });

          //START:SPATIBAN:4/11/23: SFSTRY0002817:Added code for APT Number
          $(document).on('change', "#SC-SO-Ship-NA-Address", function (event)
          {
            event.preventDefault();
            if ($("#SC-SO-Ship-NA-Apt").val() == "")
              $("#SC-SO-Ship-NA-Apt").focus();
          });
          $(document).on('focus', "#SC-SO-Ship-NA-Apt", function (event)
          {
            event.preventDefault();
            if ($("#SC-SO-Ship-NA-Apt").val() == "")
              $("#SNAPTToolTip").show();
          });
          $(document).on('focusout', "#SC-SO-Ship-NA-Apt", function (event)
          {
            event.preventDefault();
            $("#SNAPTToolTip").hide();
          });
          $(document).on('change', "#SC-SO-Ship-Address", function (event)
          {
            event.preventDefault();
            if ($("#SC-SO-Ship-Apt").val() == "")
              $("#SC-SO-Ship-Apt").focus();
          });
          $(document).on('focus', "#SC-SO-Ship-Apt", function (event)
          {
            event.preventDefault();
            if ($("#SC-SO-Ship-Apt").val() == "")
              $("#SN-new-APTToolTip").show();
          });
          $(document).on('focusout', "#SC-SO-Ship-Apt", function (event)
          {
            event.preventDefault();
            $("#SN-new-APTToolTip").hide();
          });
          //END:SPATIBAN:4/11/23: SFSTRY0002817:Added code for APT Number

          $(document).on('click', "#SC-SO-Ship-SaveNewAddress", function ()
          {
            SiebelJS.Log("Saving New Address");
            var errorCodes = ErrorCodesfn.errorcodes();
            $("#SC-SO-Ship-CreateNewAddress").validate(
            {
              rules:
              {
                address:
                {
                  required: true
                },
                city:
                {
                  required: true
                },
                state:
                {
                  required: true
                },
                zipcode:
                {
                  required: true
                }

              },
              messages:
              {

                address: errorCodes.SC_REQUIRED_ADDRESS,
                city: errorCodes.SC_REQUIRED_CITY,
                state: errorCodes.SC_REQUIRED_STATE,
                zipcode: errorCodes.SC_REUIRED_POSTAL_CODE
              },
              tooltip_options:
              {

                address:
                {
                  trigger: 'focus',
                  placement: 'bottom',
                  html: true
                },
                city:
                {
                  trigger: 'focus',
                  placement: 'bottom',
                  html: true
                },
                state:
                {
                  trigger: 'focus',
                  placement: 'bottom',
                  html: true
                },
                zipcode:
                {
                  trigger: 'focus',
                  placement: 'bottom',
                  html: true
                }

              },
              submitHandler: function (form)
              {
                event.preventDefault();
                SiebelJS.Log("conId is -- In Address creation:" + conId);

                $(".SC-add-table-popup").modal("hide");
                $("body").trigger('Custom.Start');
                setTimeout(function ()
                {
                  //SBOORLA:Added code for B2B order Address creation
                  if (accAddr == "Y")
                  {
                    accAddr = "N";
                    SiebelJS.Log("Account Address");
                    var Bservice = '',
                      inPS = '',
                      outPS = '';
                    inPS = SiebelApp.S_App.NewPropertySet();
                    outPS = SiebelApp.S_App.NewPropertySet();
                    inPS.SetProperty("AccountId", ShipToContactRecordSet[0]["Ship To Account Id"]);
                    inPS.SetProperty("Object Id", ShipToContactRecordSet[0]["Ship To Account Id"]);
                    inPS.SetProperty("Address", $("#SC-SO-Ship-NA-Address").val());
                    inPS.SetProperty("City", $("#SC-SO-Ship-NA-City").val());
                    inPS.SetProperty("State", $("#SC-SO-Ship-NA-State").val());
                    inPS.SetProperty("Country", "");
                    inPS.SetProperty("PostalCode", $("#SC-SO-Ship-NA-ZipCode").val());
                    inPS.SetProperty("ProcessName", "SC Create Link Address To Account");
                    Bservice = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
                    outPS = Bservice.InvokeMethod("RunProcess", inPS); //invoke the method
                    SiebelJS.Log("Workflow invoked");
                    var addrid = outPS.GetChild(0).GetProperty("Address Id")
                    SiebelJS.Log(outPS.GetChild(0).GetProperty("Address Id"));
                    GetAccountAddressList(ShipToContactRecordSet[0]["Ship To Account Id"]);
                    addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                    $("#scship-Acc-adr").html(addressLine);
                    if (NewAddrLineLevel == "Y")
                    {
                      var line_row_id = parseInt(Addr_line_row_id) - 1;
                      $("#s_" + appletSeq + "_l tr#" + Addr_line_row_id + "").trigger("click");
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].InvokeMethod("WriteRecord");
                      var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                      for (var i = 0; i < orderrcd.length; i++)
                      {
                        addressLine = AttachAddresses(orderrcd[i]["Ship To Address Id"]);
                        $("#" + (i + 1) + "Ship-ShipToAddress").html(addressLine);

                      }
                      if (AddrServiceLevel[addrid] == "")
                      {
                        var Bservice = '',
                          inPS = '',
                          outPS = '';
                        inPS = SiebelApp.S_App.NewPropertySet();
                        outPS = SiebelApp.S_App.NewPropertySet();
                        inPS.SetProperty("Id", addrid);
                        Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
                        outPS = Bservice.InvokeMethod("GetHDEligibility", inPS);
                      }
                    }
                    else
                    {
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                      ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                      var fieldnames = "Ship To Account Id,Ship To Address Id";
                      var fieldvalues = "";
                      fieldvalues = ShipToContactRecordSet[0]["Ship To Account Id"] + ',' + addrid;
                      SiebelJS.Log(fieldvalues);
                      var Bservice = '',
                        inPS = '',
                        outPS = '';
                      inPS = SiebelApp.S_App.NewPropertySet();
                      outPS = SiebelApp.S_App.NewPropertySet();
                      inPS.SetProperty("BO", "Order Entry (Sales)");
                      inPS.SetProperty("BC", "Order Entry - Line Items");
                      inPS.SetProperty("FieldsArray", fieldnames);
                      inPS.SetProperty("ValuesArray", fieldvalues);
                      inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
                      Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                      outPS = Bservice.InvokeMethod("Insert", inPS);
                      if (AddrServiceLevel[addrid] == "")
                      {
                        var Bservice = '',
                          inPS = '',
                          outPS = '';
                        inPS = SiebelApp.S_App.NewPropertySet();
                        outPS = SiebelApp.S_App.NewPropertySet();
                        inPS.SetProperty("Id", addrid);
                        Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
                        outPS = Bservice.InvokeMethod("GetHDEligibility", inPS);
                      }
                      var ai = {};
                      ai.async = false;
                      ai.selfbusy = true;
                      ai.scope = this;
                      ai.mask = true;
                      ai.opdecode = true;
                      ai.errcb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                        SiebelJS.Log("In 2716 Refresh BC Error");
                      };
                      ai.cb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                        SiebelJS.Log("In 2721 Refresh BC Call Back");
                      };
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                      //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                    }
                  }
                  else
                  {
                    var Bservice = '',
                      inPS = '',
                      outPS = '';
                    inPS = SiebelApp.S_App.NewPropertySet();
                    outPS = SiebelApp.S_App.NewPropertySet();
                    if (NewAddrLineLevel == "Y")
                    {
                      var linercd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                      SiebelJS.Log("shipToContactRecordSet::" + JSON.stringify(linercd));
                      var line_row_id = parseInt(Addr_line_row_id) - 1;
                      inPS.SetProperty("ContactId", linercd[line_row_id]["Ship To Contact Id"]);
                      //inPS.SetProperty("ContactId", linercd[Addr_line_row_id]["Ship To Contact Id"]);
                    }
                    else
                    {
                      inPS.SetProperty("ContactId", conId);
                    }
                    inPS.SetProperty("SC StreetAddr1", $("#SC-SO-Ship-NA-Address").val());
                    inPS.SetProperty("SC StreetAddr2", $("#SC-SO-Ship-NA-Apt").val());
                    inPS.SetProperty("SC City", $("#SC-SO-Ship-NA-City").val());
                    inPS.SetProperty("SC State", $("#SC-SO-Ship-NA-State").val());
                    inPS.SetProperty("SC Country", "");
                    inPS.SetProperty("SC PostalCode", $("#SC-SO-Ship-NA-ZipCode").val());
                    inPS.SetProperty("ProcessName", "SC Create And Link Address To Contact");
                    Bservice = SiebelApp.S_App.GetService("Workflow Process Manager"); //get service
                    outPS = Bservice.InvokeMethod("RunProcess", inPS); //invoke the method
                    SiebelJS.Log("Workflow invoked");
                    var addrid = outPS.GetChild(0).GetProperty("AddressId")
                    SiebelJS.Log(outPS.GetChild(0).GetProperty("AddressId"));
                    if (addrid != "" && addrid != undefined)
                    {
                      if (NewAddrLineLevel == "N")
                      {
                        GetAddressList(conId);
                        addressLine = AttachAddresses(addrid);
                        $(".Ship-ShipToAddress").html(addressLine);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                        ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                        var fieldnames = "Ship To Contact Id,Ship To Address Id";
                        var fieldvalues = "";
                        fieldvalues = conId + ',' + addrid;
                        SiebelJS.Log(fieldvalues);
                        var Bservice = '',
                          inPS = '',
                          outPS = '';
                        inPS = SiebelApp.S_App.NewPropertySet();
                        outPS = SiebelApp.S_App.NewPropertySet();
                        inPS.SetProperty("BO", "Order Entry (Sales)");
                        inPS.SetProperty("BC", "Order Entry - Line Items");
                        inPS.SetProperty("FieldsArray", fieldnames);
                        inPS.SetProperty("ValuesArray", fieldvalues);
                        //SADDALA for Defect.no 561 removed extra searchspec
                        //inPS.SetProperty("SearchSpecification","[Order Header Id] = '" + orderid + "' AND [Ship To Contact Id] = '" + conId + "'AND EXISTS([Product Line]<>'DELIVERY') AND [Product Type Code]<>'"+ProductTypeCode+"'" );
                        inPS.SetProperty("SearchSpecification", "([Order Header Id] = '" + orderid + "' AND (([Fulfillment Status Code]='In Progress') OR ([SC Revisable]='Revisable' AND ([Request To Cancel] IS NULL OR [Request To Cancel]='N'))))");
                        Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                        outPS = Bservice.InvokeMethod("Insert", inPS);
                        var ai = {};
                        ai.async = false;
                        ai.selfbusy = true;
                        ai.scope = this;
                        ai.mask = true;
                        ai.opdecode = true;
                        ai.errcb = function ()
                        {
                          //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                          SiebelJS.Log("In 3458 Refresh BC Error");
                        };
                        ai.cb = function ()
                        {
                          //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                          SiebelJS.Log("In 3462 Refresh BC Call Back");
                        };
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                        //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                        var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                        for (var i = 0; i < orderrcd.length; i++)
                        {
                          $("#" + i + "Ship-ShipToAddress").html(addressLine);

                        }
                      }
                      else
                      {

                        //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetSelection(Addr_line_row_id);
                        $("#s_" + appletSeq + "_l tr#" + Addr_line_row_id + "").trigger("click");
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
                        SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].InvokeMethod("WriteRecord");
                        var linercd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                        SiebelJS.Log("shipToContactRecordSet::" + JSON.stringify(linercd));

                        var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                        //This line  has to be removed after removed the sc-readonly class for line level change contact
                        var sclineno = parseInt(Addr_line_row_id) - 1;
                        if (!scAccountOrder)
                          GetAddressList(linercd[sclineno]["Ship To Contact Id"]);
                        else
                          GetAddressList(ShipToContactRecordSet[0]["Ship To Contact Id"]);
                        addressLine = AttachAddresses(ShipToContactRecordSet[0]["Ship To Address Id"]);
                        $("#Ship-Default-BillToAddress").html(addressLine);
                        for (var i = 0; i < orderrcd.length; i++)
                        {
                          if (orderrcd[i]["Product Line"] != 'DELIVERY' && orderrcd[i]["Product Type Code"] != ProductTypeCode)
                          {
                            //This comments has to be removed after removed the sc-readonly class for line level change contact
                            //GetAddressList(orderrcd[i]["Ship To Contact Id"]);
                            addressLine = AttachAddresses(orderrcd[i]["Ship To Address Id"]);
                            SiebelJS.Log(conId + "   bujyhb" + orderrcd[i]["Ship To Contact Id"]);
                            $("#" + (i + 1) + "Ship-ShipToAddress").html(addressLine);
                          }

                        }


                        /*addressLine=AttachAddresses(addrid);
                        $("#"+Addr_line_row_id+"Ship-ShipToAddress").html(addressLine);*/
                      }

                      //SBOORLA: Added code for Defect 638
                      if (AddrServiceLevel[addrid] == "")
                      {
                        var Bservice = '',
                          inPS = '',
                          outPS = '';
                        inPS = SiebelApp.S_App.NewPropertySet();
                        outPS = SiebelApp.S_App.NewPropertySet();
                        inPS.SetProperty("Id", addrid);
                        Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
                        outPS = Bservice.InvokeMethod("GetHDEligibility", inPS);
                      }
                    }
                  }
                  //30Sep24;SL;re-evaluate delivery tiers
                  updateShipping("", true, ""); //remove the delivery tier options
                  getDeliveryTierOptions(orderid); //evaluate delivery tier
                  $("body").trigger('Custom.End');
                  document.getElementById("SC-SO-Ship-CreateNewAddress").reset();
                  $("#SC-SO-Ship-NA-Address").removeClass("is-active");
                  $("#SC-SO-Ship-NA-Apt").removeClass("is-active");
                  $("#SC-SO-Ship-NA-City").removeClass("is-active");
                  $("#SC-SO-Ship-NA-State").removeClass("is-active");
                  $("#SC-SO-Ship-NA-ZipCode").removeClass("is-active");
                  $("#SC-SO-Ship-NA-Address").removeClass("is-completed");
                  $("#SC-SO-Ship-NA-Apt").removeClass("is-completed");
                  $("#SC-SO-Ship-NA-City").removeClass("is-completed");
                  $("#SC-SO-Ship-NA-State").removeClass("is-completed");
                  $("#SC-SO-Ship-NA-ZipCode").removeClass("is-completed");
                }, 1000);
              } //closing submit handler

            });
          });
          $(document).on('change', '.Ship-ShipToAddress', function ()
          {
            var val = $(this).val();
            var addrid = parentAddrJSON[val];
            SiebelJS.Log(addrid);
            if (this.id == "Ship-Default-BillToAddress")
            {
              if (val != "ADD NEW ADDRESS")
              {
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                var fieldnames = "Ship To Contact Id,Ship To Address Id";
                var fieldvalues = "";
                fieldvalues = conId + ',' + addrid;
                SiebelJS.Log(fieldvalues);
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("BO", "Order Entry (Sales)");
                inPS.SetProperty("BC", "Order Entry - Line Items");
                inPS.SetProperty("FieldsArray", fieldnames);
                inPS.SetProperty("ValuesArray", fieldvalues);
                //SADDALA for Defect.no 561 removed extra searchspec
                //inPS.SetProperty("SearchSpecification","[Order Header Id] = '" + orderid + "' AND [Ship To Contact Id] = '" + conId + "'AND EXISTS([Product Line]<>'DELIVERY') AND [Product Type Code]<>'"+ProductTypeCode+"'" );
                inPS.SetProperty("SearchSpecification", "([Order Header Id] = '" + orderid + "' AND (([Fulfillment Status Code]='In Progress') OR ([SC Revisable]='Revisable' AND ([Request To Cancel] IS NULL OR [Request To Cancel]='N'))))");
                Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
                outPS = Bservice.InvokeMethod("Insert", inPS);
                var ai = {};
                ai.async = false;
                ai.selfbusy = true;
                ai.scope = this;
                ai.mask = true;
                ai.opdecode = true;
                ai.errcb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                  SiebelJS.Log("In 3750 Refresh BC Error");
                };
                ai.cb = function ()
                {
                  //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                  SiebelJS.Log("In 3574 Refresh BC Call Back");
                };
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");
                var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                GetAddressList(conId);
                addressLine = AttachAddresses(addrid);
                for (var i = 0; i < orderrcd.length; i++)
                {

                  SiebelJS.Log(conId + "   bujyhb" + orderrcd[i]["Ship To Contact Id"]);
                  $("#" + (i + 1) + "Ship-ShipToAddress").html(addressLine);
                }
              }
            }
            else
            {
              if (val != "ADD NEW ADDRESS")
              {
                SiebelJS.Log("entered");
                //SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetSelection(Addr_line_row_id);
                $("#s_" + appletSeq + "_l tr#" + Addr_line_row_id + "").trigger("click");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].InvokeMethod("WriteRecord");
              }
            }
            if (val == "ADD NEW ADDRESS")
            {
              accAddr = "N";
              if (this.id == "Ship-Default-BillToAddress")
              {
                NewAddrLineLevel = "N";
              }
              else
              {
                NewAddrLineLevel = 'Y';
              }
              if (isShipToAcc == "Y")
              {
                accAddr = "Y";
                NewAddrLineLevel = 'Y';
              }
              $("#SC-add-address").modal(
              {
                backdrop: 'static'
              });
            }
            else
            {
              if (AddrServiceLevel[addrid] == "")
              {
                var Bservice = '',
                  inPS = '',
                  outPS = '';
                inPS = SiebelApp.S_App.NewPropertySet();
                outPS = SiebelApp.S_App.NewPropertySet();
                inPS.SetProperty("Id", addrid);
                Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
                outPS = Bservice.InvokeMethod("GetHDEligibility", inPS);
              }
            }
            //30Sep24;SL;re-evaluate delivery tiers
            updateShipping("", true, ""); //remove the delivery tier options
            getDeliveryTierOptions(orderid); //evaluate delivery tiers

          });
          $(document).on('change', '[id$="Delivery-Tier"]', function (evt) //20Sep24;SL;Added for Tiered Delivery
            {
              var strSelectedTier = this.selectedOptions[0].innerText;
              var elemId = $(this).attr("id");
              var strOrdAddrId, strOrderId, recSetLen, strLineItemAddrId, fieldnames, fieldvalues;
              var Bservice, inPS, outPS;

              if (elemId == "Delivery-Tier" || elemId == "acc-Delivery-Tier")
              { //copy delivery tier onto the line items with matching ship address
                strLineItemAddrId = "";

                strOrdAddrId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Ship To Address Id");
                strOrderId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Id");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("RefreshBusComp");

                updateShipping(strSelectedTier, false, strOrdAddrId);
              }
              else
              {
                $("#s_" + appletSeq + "_l tr#" + elemId.match(/^(\d+)/g)[0]).trigger("click");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetFieldValue("Shipping", strSelectedTier);
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("WriteRecord");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("RefreshBusComp");
              }
            });
          //Start:code for on change of ship to Account Address
          $(document).on('change', '#scship-Acc-adr', function ()
          {
            var val = $(this).val();
            var addrid = parentAddrJSON[val];
            SiebelJS.Log(addrid);
            if (val != "ADD NEW ADDRESS")
            {
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("Ship To Address Id", addrid);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
              ShipToContactRecordSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
              var fieldnames = "Ship To Address Id";
              var fieldvalues = "";
              fieldvalues = addrid;
              SiebelJS.Log(fieldvalues);
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("BO", "Order Entry (Sales)");
              inPS.SetProperty("BC", "Order Entry - Line Items");
              inPS.SetProperty("FieldsArray", fieldnames);
              inPS.SetProperty("ValuesArray", fieldvalues);
              //SADDALA for Defect.no 561 removed extra searchspec
              //inPS.SetProperty("SearchSpecification","[Order Header Id] = '" + orderid + "' AND [Ship To Contact Id] = '" + conId + "'AND EXISTS([Product Line]<>'DELIVERY') AND [Product Type Code]<>'"+ProductTypeCode+"'" );
              inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND [Fulfillment Status Code]='In Progress'");
              Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
              outPS = Bservice.InvokeMethod("Insert", inPS);
              var orderrcd = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
              addressLine = AttachAddresses(addrid);
              for (var i = 0; i < orderrcd.length; i++)
              {
                $("#" + (i + 1) + "Ship-ShipToAddress").html(addressLine);
              }
            }
            if (val == "ADD NEW ADDRESS")
            {
              accAddr = "Y";
              NewAddrLineLevel = "N";
              $("#SC-add-address").modal(
              {
                backdrop: 'static'
              });
            }

            if (AddrServiceLevel[addrid] == "")
            {
              var Bservice = '',
                inPS = '',
                outPS = '';
              inPS = SiebelApp.S_App.NewPropertySet();
              outPS = SiebelApp.S_App.NewPropertySet();
              inPS.SetProperty("Id", addrid);
              Bservice = SiebelApp.S_App.GetService("SC HD Delivery Eligibility"); //get service
              outPS = Bservice.InvokeMethod("GetHDEligibility", inPS);
            }
            updateShipping("", true, ""); //remove the delivery tier options
            getDeliveryTierOptions(orderid); //evaluate delivery tiers
          });
          //End:code for on change of ship to Account Address
          $(document).on('click', '.new-Add-Address', function ()
          {
            SiebelJS.Log("add new address is selected");
          })
        } //End of BindEvents
        //Start:Markup for Contact Search
        function contactSearchMarkup()
        {
          if (scAccountOrder)
            csearchfields = SC_OUI_Definitions.contactAccountsearchfields();
          else
            csearchfields = SC_OUI_Definitions.contactsearchfields();
          searchCount = 2
          next = 1
          var markup = "";
          markup += ' 						<div class="modal-header" >';
          markup += '                            <button type="button" class="close SC-close-popup blue-bg" data-dismiss="modal"></button>';
          markup += '                            <div class="header-content no-padding">';
          markup += '                                <div class="sc-head-title sc-set-top">';
          markup += '                                    <div class="sc-icon-text sc-top-padding">';
          markup += '                                        <div>';
          markup += '                                            <img src="images/custom/sc-logo.png" class="sc-order-icon">';
          markup += '                                        </div>';
          markup += '                                    </div>';
          markup += '                                    <div class="container SC-search-container row no-top-padding">';
          markup += '                                        <div class="col-lg-2 col-md-2 no-padding">';
          markup += '                                            <p class="SC-search-title margin-top SC-search-color">Search Contacts</p>';
          markup += '                                        </div>';
          markup += '                                        <div class="col-lg-10 col-md-10" id="searchfields">';
          markup += '                                            <form name="search">';
          markup += '                            <div id="field">';
          markup += '                                <select class="select-box margin-top sc-contact-select-box" autocomplete="off" id="field0" name="prof1">';
          for (i = 0; i < csearchfields.length; i++)
          {
            if (i == 0)
            {
              markup += '                                    <option id="' + csearchfields[i] + '" value="' + csearchfields[i] + '" selected="selected">' + csearchfields[i] + '</option>';
            }
            else
            {
              markup += '                                    <option id="' + csearchfields[i] + '" value="' + csearchfields[i] + '">' + csearchfields[i] + '</option>';
            }
          }
          markup += '                                                    </select>';
          markup += '                                                    <input type="text" id="ifield0" class="search-box con-search-box margin-top text-color" autocomplete="off">';
          markup += '                                                    <div id="b1" class="add-more margin-top "></div>';
          markup += '                                                </div>';
          markup += '                            <div id="field">';
          markup += '                                <select class="select-box margin-top sc-contact-select-box" autocomplete="off" id="field1" name="prof1">';
          for (i = 0; i < csearchfields.length; i++)
          {
            if (i == 1)
            {
              markup += '                                    <option id="' + csearchfields[i] + '" value="' + csearchfields[i] + '" selected="selected">' + csearchfields[i] + '</option>';
            }
            else
            {
              markup += '                                    <option id="' + csearchfields[i] + '" value="' + csearchfields[i] + '">' + csearchfields[i] + '</option>';
            }
          }
          markup += '                                                    </select>';
          markup += '                                                    <input type="text" id="ifield1" class="search-box con-search-box margin-top text-color" autocomplete="off">';
          markup += '                                                    <div id="b1" class="add-more margin-top"><span class="glyphicon glyphicon-plus-sign icon-img ship-icon-img add-item" style="display:none" id="referredaddicon"></span></div>';
          markup += '                                                </div>';
          markup += '                                            </form>';
          markup += '                                        </div>';
          markup += '                                    </div>';
          markup += '                                    <div class="sc-search-box SC-search-top-padding">';
          markup += '                                        <button class="SC-SO-search-button SC-disabled" type="button" id="sc-ship-con-search">Search</button>';
          markup += '                                    </div>';
          markup += '                                </div>';
          markup += '                            </div>';
          markup += '                        </div>';
          markup += '                        <div class="modal-body">';
          markup += '                            <div class="SC-table-with-scroll-main" id="SC-table-search-contact-body">';
          var criteria_markup = SC_OUI_Markups.InitialMessage(pm, "contacts");
          markup += criteria_markup;
          markup += '                            </div>';
          markup += '<div class="container"> ';
          markup += '	<div class="pagination sc-pagination pull-right" id="shipping-contact-pagination" style="display:none">';
          markup += '	</div>';
          markup += '</div>'
          markup += '                        </div>';
          markup += '                        <div class="modal-footer">';
          markup += '                            <div class="SC-button">';
          if (scAccountOrder)
            markup += '                                <button id="SC-select-Accountcontact-shipping" class="SC-disabled">Select Contact</button>';
          else
            markup += '                                <button id="SC-select-contact-shipping" class="SC-disabled">Select Contact</button>';
          markup += '                            </div>';
          markup += '                        </div>';
          $("#shipping-order-search").html(markup);
          // hiding the dropdown values
          $(".sc-contact-select-box").each(function ()
          {
            var value = $(this).val();
            for (var i = 0; i < sFields.length; i++)
            {
              if (value != sFields[i])
              {
                $("#" + $(this).attr("id") + " option[value='" + sFields[i] + "']").wrap("<span>");
              }
            }
            $("#" + $(this).attr("id") + " option[value='" + value + "']").attr('selected', 'selected');
          });
        }
        //End:Markup for Contact Search	
        function referralcontactSearchMarkup()
        {
          refsearchfields = SC_OUI_Definitions.referralcontactsearchfields();
          searchCount = 2;
          next = 1;
          sFields = ['Last Name', 'Postal Code'];
          var markup = "";
          markup += ' 						<div class="modal-header" >';
          markup += '                            <button type="button" class="close SC-close-popup blue-bg" id="SC-close-referredby"></button>';
          markup += '                            <div class="header-content no-padding">';
          markup += '                                <div class="sc-head-title sc-set-top">';
          markup += '                                    <div class="sc-icon-text sc-top-padding">';
          markup += '                                        <div>';
          markup += '                                            <img src="images/custom/sc-logo.png" class="sc-order-icon">';
          markup += '                                        </div>';
          markup += '                                    </div>';
          markup += '                                    <div class="container SC-search-container row no-top-padding">';
          markup += '                                        <div class="col-lg-2 col-md-2 no-padding">';
          markup += '                                            <p class="SC-search-title margin-top SC-search-color">Search Contacts</p>';
          markup += '                                        </div>';
          markup += '                                        <div class="col-lg-10 col-md-10" id="searchfields">';
          markup += '                                            <form name="search">';
          markup += '                            <div id="field">';
          markup += '                                <select class="select-box margin-top sc-ref-select-box" autocomplete="off" id="cfield0" name="prof1">';
          for (i = 0; i < refsearchfields.length; i++)
          {
            if (i == 0)
            {
              markup += '                                    <option id="' + refsearchfields[i] + '" value="' + refsearchfields[i] + '" selected="selected">' + refsearchfields[i] + '</option>';
            }
            else
            {
              markup += '                                    <option id="' + refsearchfields[i] + '" value="' + refsearchfields[i] + '">' + refsearchfields[i] + '</option>';
            }
          }
          markup += '                                                    </select>';
          markup += '                                                    <input type="text" id="rcfield0" class="search-box sc-referral-search-box margin-top text-color" autocomplete="off">';
          markup += '                                                    <div id="b1" class="add-more margin-top "></div>';
          markup += '                                                </div>';
          markup += '                            <div id="field">';
          markup += '                                <select class="select-box margin-top sc-ref-select-box" autocomplete="off" id="cfield1" name="prof1">';
          for (i = 0; i < refsearchfields.length; i++)
          {
            if (i == 1)
            {
              markup += '                                    <option id="' + refsearchfields[i] + '" value="' + refsearchfields[i] + '" selected="selected">' + refsearchfields[i] + '</option>';
            }
            else
            {
              markup += '                                    <option id="' + refsearchfields[i] + '" value="' + refsearchfields[i] + '">' + refsearchfields[i] + '</option>';
            }
          }
          markup += '                                                    </select>';
          markup += '                                                    <input type="text" id="rcfield1" class="search-box sc-referral-search-box margin-top text-color" autocomplete="off">';
          markup += '                                                    <div id="b1" class="add-more margin-top"><span class="glyphicon glyphicon-plus-sign icon-img reff-icon-img add-item" id="referredaddicon" style="display:none"></span></div>';
          markup += '                                                </div>';
          markup += '                                            </form>';
          markup += '                                        </div>';
          markup += '                                    </div>';
          markup += '                                    <div class="sc-search-box SC-search-top-padding">';
          markup += '                                        <button class="SC-SO-search-button SC-disabled" type="button" id="sc-referredby-con-search">Search</button>';
          markup += '                                    </div>';
          markup += '                                </div>';
          markup += '                            </div>';
          markup += '                        </div>';
          markup += '                        <div class="modal-body">';
          markup += '                            <div class="SC-table-with-scroll-main" id="SC-table-search-referredbycontact-body">';
          markup += '                            <div class="SC-noresults-container clearfix no-padding margin-top">';
          markup += '                               <div class="text-block">';
          markup += '                                    <p>Please enter search criteria to begin search</p>';
          markup += '                                </div>';
          markup += '                            </div>';
          markup += '                            </div>';
          markup += '<div class="container"> ';
          markup += '	<div class="pagination sc-pagination pull-right" id="referredby-contact-pagination" style="display:none">';
          markup += '	</div>';
          markup += '</div>'
          markup += '                        </div>';
          markup += '                        <div class="modal-footer">';
          markup += '                            <div class="SC-button">';
          markup += '                                <button id="SC-select-con-referredby" class="SC-disabled">Select Contact</button>';
          markup += '                            </div>';
          markup += '                        </div>';
          $("#Referral-Contact-search").html(markup);
          // hiding the dropdown values
          $(".sc-ref-select-box").each(function ()
          {
            var value = $(this).val();
            for (var i = 0; i < sFields.length; i++)
            {
              if (value != sFields[i])
              {
                $("#" + $(this).attr("id") + " option[value='" + sFields[i] + "']").wrap("<span>");
              }
            }
            $("#" + $(this).attr("id") + " option[value='" + value + "']").attr('selected', 'selected');
          });
        }

        //Start:Search contacts
        function searchContact()
        {
          $("body").trigger('Custom.Start');
          var searchObj = [];
          var finalObj = {};
          $("select[id*='field']").each(function ()
          {
            var fname = $(this).val();
            var fvalue = $(this).next().val();
            fvalue = $.trim(fvalue);
            var phonespec = "";
            if (fname !== "" && fvalue !== "" && fvalue !== undefined && fname !== undefined)
            {
              if (fname == "Phone Number")
              {
                var phone = ["Cellular Phone #", "Work Phone #", "Home Phone #"];
                for (i = 0; i < phone.length; i++)
                {
                  if (i < phone.length - 1)
                  {
                    phonespec = phonespec + "[" + phone[i] + "] Like '" + fvalue + "' OR "
                  }
                  else
                  {
                    phonespec = phonespec + "[" + phone[i] + "] Like '" + fvalue + "'";
                  }
                }
                searchObj.push(
                {
                  "field_name": "Cellular Phone #",
                  "value": phonespec
                });
              }
              else if (fname == "Customer Number" || fname == "Employee Number")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": fname,
                  "value": fvalue
                });
              }
              else if (fname == "Postal Code")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": "Personal Postal Code",
                  "value": fvalue
                });
              }
              else if (fname == "City")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": "Personal City",
                  "value": fvalue
                });
              }
              else if (fname == "State")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": "Personal State",
                  "value": fvalue
                });
              }
              else if (fname == "Address (Mail To)")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": "Personal Street Address",
                  "value": fvalue
                });
              }
              else if (fname == "Email Address")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": "Primary Email Address",
                  "value": fvalue
                });
              }
              else
              {
                //SNARRA 20/07/2018: Added code for appostrophe text field values
                fvalue = '"' + fvalue.toUpperCase() + '*"';
                searchObj.push(
                {
                  "field_name": fname,
                  "value": fvalue
                });
              }
            }
          });

          if (searchObj.length > 0)
          {
            for (var i = 0; i < searchObj.length; i++)
            {
              finalObj[searchObj[i].field_name] = searchObj[i].value;
            }
          }

          FieldQueryPair = finalObj;
          if (scAccountOrder)
          {
            SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Account Contact Shipping List OUI");
            ContactAccountSearch_GetRecordSearch();
          }
          else
            SC_OUI_Methods.ExecuteListAppletFrame(SiebelConstant, FieldQueryPair, "SC Contact Shipping List OUI");

        }
        //End:Search contacts
        //START:Ref Search Contacts
        function refSearchContact()
        {
          referredsearchfields();
          $("body").trigger('Custom.Start');
          var searchObj = [];
          var finalObj = {};
          $("select[id*='field']").each(function ()
          {
            var fname = $(this).val();
            var fvalue = $(this).next().val();
            fvalue = $.trim(fvalue);
            var phonespec = "";
            if (fname !== "" && fvalue !== "" && fvalue !== undefined && fname !== undefined)
            {
              if (fname == "Phone Number")
              {
                //var phone=["Cellular Phone #","Work Phone #","Home Phone #"];
                var phone = ["Primary Contact Cellular Phone #", "Primary Contact Home Phone #", "Primary Contact Work Phone #"];
                for (i = 0; i < phone.length; i++)
                {
                  if (i < phone.length - 1)
                  {
                    phonespec = phonespec + "[" + phone[i] + "] Like '" + fvalue + "' OR "
                  }
                  else
                  {
                    phonespec = phonespec + "[" + phone[i] + "] Like '" + fvalue + "'";
                  }
                }
                searchObj.push(
                {
                  "field_name": "Cellular Phone #",
                  "value": phonespec
                });
              }
              else if (fname == "Customer Number")
              {
                fvalue = fvalue + "*";
                searchObj.push(
                {
                  "field_name": fname,
                  "value": fvalue
                });
              }
              else if (fname == "Email Address")
              {
                fvalue = fvalue;
                searchObj.push(
                {
                  "field_name": fname,
                  "value": fvalue
                });
              }
              else
              {
                fvalue = fvalue.toUpperCase() + "*";
                //SJAKKIDI: Start Added for appostrophe text field values
                fvalue = '"' + fvalue + '"';
                //SJAKKIDI: End Added for appostrophe text field values
                searchObj.push(
                {
                  "field_name": fname,
                  "value": fvalue
                });
              }
            }
          });

          if (searchObj.length > 0)
          {
            for (var i = 0; i < searchObj.length; i++)
            {
              finalObj[searchObj[i].field_name] = searchObj[i].value;
            }
          }

          FieldQueryPair = finalObj;
          localStorage.setItem("RefBY", "Y");
          SC_OUI_Methods.ExecuteListAppletFrame(SiebelConstant, FieldQueryPair, "SC LOY Member List Applet");

        }
        //END:Ref Search Contacts
        function searchfields()
        {
          $("input[type=text]").each(function ()
          {
            $(this).attr("value", $(this).val());
          });

          $("select option").each(function ()
          {
            if ($(this).attr("selected") == "selected")
              $(this).attr("selected", "true");
            else
              $(this).removeAttr("selected");
          });
        }

        function referredsearchfields()
        {
          $("#sc-referral-search-box").each(function ()
          {
            $(this).attr("value", $(this).val());
          });

          $("#sc-ref-select-box").each(function ()
          {
            if ($(this).attr("selected") == "selected")
              $(this).attr("selected", "true");
            else
              $(this).removeAttr("selected");
          });
        }
        //Start:ignore the error codes for on clcik of verify button
        function verfiyErrorCodes()
        {
          var OrderErrors = [];
          FieldQueryPair = {
            "Id": ""
          };
          SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Validation Message - Order Item List Applet");
          validatemessageorderitem = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Order Item List Applet"].GetBusComp().GetRecordSet();
          SiebelJS.Log("validatemessage::" + JSON.stringify(validatemessageorderitem));
          SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Validation Message - Order List Applet");
          validatemessageorderlist = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Order List Applet"].GetBusComp().GetRecordSet();
          SiebelJS.Log("validatemessage::" + JSON.stringify(validatemessageorderlist));
          SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Validation Message - Payments List Applet");
          validatemessagepaymentlist = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Payments List Applet"].GetBusComp().GetRecordSet();
          OrderErrors = OrderErrors.concat(validatemessageorderitem);
          OrderErrors = OrderErrors.concat(validatemessageorderlist);
          OrderErrors = OrderErrors.concat(validatemessagepaymentlist);
          for (var err = 0; err < OrderErrors.length; err++)
          {
            if (ignoreErrorCodes.indexOf(OrderErrors[err]["Message Code"]) == -1)
              return 1;
          }
          return 0;
        }
        //End:ignore the error codes for on clcik of verify button
        function setValidationErrors()
        {
          var OrderErrors = [];
          var OrderDetailserr = "";
          var lineDetailserr = "";
          var shippingerr = "";
          var contacterr = "";
          var lineDetailserrlen = 0;
          var orderDetailserrlen = 0;
          var shippingerrlen = 0;
          var contacterrlen = 0;
          var scerrormarkup = "";
          scerrormarkup = SCSalesCreateMarkup.SCOrderErrorBlock();
          $("#SC-error-block").html(scerrormarkup);
          if ($("#SC-error-block").is(":visible"))
            $("#CommunicationPanelContainer").css("cssText", "padding-top: 132px !important;");
          $("#SC-SO-CF-failure").modal(
          {
            backdrop: 'static'
          });
          $("#SC-SO-CF-failure").css(
          {
            "display": "flex",
            "justify-content": "center",
            "align-items": "center"
          });
          $(".modal-backdrop").css('background', '#ffffff');
          $("#SC-SO-CF-verify").modal('hide');
          $("#SC-SO-CF-failure").css(
          {
            "display": "",
            "justify-content": "",
            "align-items": ""
          });
          //Start: nullfying the pervious errors
          $("#orderdetailserrno").html('');
          $("#orderdetailserrors").html('');
          $("#linedetailserrno").html('');
          $("#linedetailserrors").html('');
          $("#shippingserrno").html('');
          $("#shippingserros").html('');
          $("#contacterrorno").html('');
          $("#contacterrors").html('');
          //End: nullfying the pervious errors

          FieldQueryPair = {
            "Id": ""
          };
          SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Validation Message - Order Item List Applet");
          validatemessageorderitem = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Order Item List Applet"].GetBusComp().GetRecordSet();
          SiebelJS.Log("validatemessage::" + JSON.stringify(validatemessageorderitem));

          SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Validation Message - Order List Applet");
          validatemessageorderlist = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Order List Applet"].GetBusComp().GetRecordSet();
          SiebelJS.Log("validatemessage::" + JSON.stringify(validatemessageorderlist));

          SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Validation Message - Payments List Applet");
          validatemessagepaymentlist = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Validation Message - Payments List Applet"].GetBusComp().GetRecordSet();
          SiebelJS.Log("validatemessage::" + JSON.stringify(validatemessagepaymentlist));

          OrderErrors = OrderErrors.concat(validatemessageorderitem);
          OrderErrors = OrderErrors.concat(validatemessageorderlist);
          OrderErrors = OrderErrors.concat(validatemessagepaymentlist);
          var mappingerrorcodes = "";
          mappingerrorcodes = SCErrorCodes.SalesorderErrorCodeMapping();
          $("#SC-error-block").show();
          if ($("#SC-error-block").is(":visible"))
            $("#CommunicationPanelContainer").css("cssText", "padding-top: 132px !important;");
          shippingerr += '<a href="#Default-Shipping" class="SC-shipping-error" style="text-decoration: none">';
          for (var err = 0; err < OrderErrors.length; err++)
          {
            bRefreshShipMethod = (OrderErrors[err]["Message Code"] == "TD-01") ? true : bRefreshShipMethod; //SL;Added for Tier Delivery;DF-1975
            if (mappingerrorcodes[OrderErrors[err]["Message Code"]] == "LineDetailsError")
            {
              if (OrderErrors[err].hasOwnProperty('SC Line Number'))
                lineDetailserr += '<li>' + '#' + OrderErrors[err]["SC Line Number"] + '-' + OrderErrors[err]["Message Text"] + '</li>';
              else
                lineDetailserr += '<li>' + OrderErrors[err]["Message Text"] + '</li>';
              lineDetailserrlen += 1;

            }
            else if (mappingerrorcodes[OrderErrors[err]["Message Code"]] == "OrderHeaderError")
            {
              if (OrderErrors[err].hasOwnProperty('SC Line Number'))
                OrderDetailserr += '<li>' + '#' + OrderErrors[err]["SC Line Number"] + '-' + OrderErrors[err]["Message Text"] + '</li>';
              else
                OrderDetailserr += '<li>' + OrderErrors[err]["Message Text"] + '</li>';
              orderDetailserrlen += 1;

            }
            else if (mappingerrorcodes[OrderErrors[err]["Message Code"]] == "ShippingError")
            {
              if (OrderErrors[err].hasOwnProperty('SC Line Number'))
                shippingerr += '<li>' + '#' + OrderErrors[err]["SC Line Number"] + '-' + OrderErrors[err]["Message Text"] + '</li>';
              else
                shippingerr += '<li>' + OrderErrors[err]["Message Text"] + '</li>';
              shippingerrlen += 1;
            }
            else if (mappingerrorcodes[OrderErrors[err]["Message Code"]] == "ContactError")
            {
              if (OrderErrors[err].hasOwnProperty('SC Line Number'))
                contacterr += '<li>' + '#' + OrderErrors[err]["SC Line Number"] + '-' + OrderErrors[err]["Message Text"] + '</li>';
              else
                contacterr += '<li>' + OrderErrors[err]["Message Text"] + '</li>';
              contacterrlen += 1;
            }
          }

          shippingerr += '</a>';

          if (orderDetailserrlen == 0)
          {
            $("#SC-select-oder-item").html('<img src="images/custom/done_mini.png"/>');
            $("#SC-label-select-Orderdetails-item").css(
            {
              "pointer-events": 'none'
            });
          }
          else
          {
            $("#orderdetailserrno").html(orderDetailserrlen + ' ERRORS FOUND');
            $("#orderdetailserrors").html(OrderDetailserr);
            $("#SC-label-select-Orderdetails-item").css(
            {
              "pointer-events": 'all'
            });
          }
          if (lineDetailserrlen == 0)
          {
            $("#SC-select-line-item").html('<img src="images/custom/done_mini.png"/>');
            $("#SC-label-select-linedetail-item").css(
            {
              "pointer-events": 'none'
            });
          }
          else
          {
            $("#linedetailserrno").html(lineDetailserrlen + ' ERRORS FOUND');
            $("#linedetailserrors").html(lineDetailserr);
            $("#SC-label-select-linedetail-item").css(
            {
              "pointer-events": 'all'
            });
          }
          if (shippingerrlen == 0)
          {
            $("#SC-select-ship-item").html('<img src="images/custom/done_mini.png"/>');
            $("#SC-label-select-shipping-item").css(
            {
              "pointer-events": 'none'
            });
          }
          else
          {
            $("#shippingserrno").html(shippingerrlen + ' ERRORS FOUND');
            $("#shippingserros").html(shippingerr);
            $("#SC-label-select-shipping-item").css(
            {
              "pointer-events": 'all'
            });
          }
          if (contacterrlen == 0)
          {
            $("#SC-select-contact-item").html('<img src="images/custom/done_mini.png"/>');
            $("#SC-label-select-contact-item").css(
            {
              "pointer-events": 'none'
            });
          }
          else
          {
            $("#contacterrorno").html(contacterrlen + ' ERRORS FOUND');
            $("#contacterrors").html(contacterr);
            $("#SC-label-select-contact-item").css(
            {
              "pointer-events": 'all'
            });
          }
          //document.getElementById("SC-CF-failure-button").focus();
          //$('#SC-CF-failure-button').focus();

          //SC-CF-failure-button

        }

        function GetAddressList(conId_Global)
        {
          var search_Spec = "[Contact Id] = '" + conId_Global + "' AND ([End Date] IS NULL  OR [End Date] > TODAY())";
          var Fields = "Id,Address Name,SC HD Eligible,SC HD Service Level,City,Postal Code,State,Street Address";
          addList = SC_OUI_Methods.GetContactAddressesList("Contact", "FINS Contact Address", search_Spec, Fields);
          SiebelJS.Log("addList is:" + addList);
        }

        function GetAccountAddressList(AccId_Global)
        {

          var search_Spec = "[Account Id] = '" + AccId_Global + "'";
          var Fields = "Id,Address Name,SC HD Eligible,SC HD Service Level,City,Postal Code,State,Street Address";
          addList = SC_OUI_Methods.GetContactAddressesList("Account", "CUT Address for Account/Contact", search_Spec, Fields);
          SiebelJS.Log("addList is:" + addList);


        }

        function getCommonElements(arrays) //10Oct24;SL;Added for Tiered Delivery
        {
          if (arrays.length === 0)
            return [];
          return arrays.reduce((common, array) =>
          {
            return common.filter(element => array.includes(element));
          });
        }

        function validateDeliveryTiers() //30Oct24;SL;Added for tier delivery
        {
          var oliRecSet, numOfRec = 0;
          var ps_TierDelivery;
          var bDeliveryTier = true,
            strReturnVal = true;

          $('[id$="Delivery-Tier"]').not('#Delivery-Tier').each(function ()
          {
            if ($(this).val() == "")
            {
              bDeliveryTier = false;
            }
          });
          if (bDeliveryTier)
          {
            ps_TierDelivery = SiebelApp.S_App.NewPropertySet();
            oliRecSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
            numOfRec = oliRecSet.length;
            for (var i = 0; i < numOfRec; i++)
            {
              if (oliRecSet[i]['Ship Method'] == "Home Delivery" && oliRecSet[i]['Product Line'] != 'DELIVERY' && oliRecSet[i]['Product Line'] != 'SERVICE' && oliRecSet[i]["Product Type Code"] != ProductTypeCode[0] && ((oliRecSet[i]['Fulfillment Status Code'] == 'In Progress') || (oliRecSet[i]['SC Revisable'] == 'Revisable' && (oliRecSet[i]['Request To Cancel'] == "" || oliRecSet[i]['Request To Cancel'] == 'N'))))
              {
                if (!ps_TierDelivery.PropertyExists(oliRecSet[i]["Ship To Address Id"]))
                {
                  ps_TierDelivery.SetProperty(oliRecSet[i]["Ship To Address Id"], oliRecSet[i]["Shipping"]);
                }
                else
                {
                  if (ps_TierDelivery.GetProperty(oliRecSet[i]["Ship To Address Id"]) != oliRecSet[i]["Shipping"])
                  {
                    strReturnVal = false;
                    break;
                  }
                }
              }
            }
            ps_TierDelivery = null;
          }
          return strReturnVal;
        }

        function updateShipping(value, bEmptyDeliveryTier, strOrdAddrId) //10Oct24;SL;Added for Tiered Delivery
        {
          var lineItemRecSet, numOfRec = 0;
          var strLineItemAddrId = "",
            strDeliveryTier;
          var bAddressMatch = false;
          var psSelectedTier;
          lineItemRecSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet()
          numOfRec = lineItemRecSet.length;
          if (bEmptyDeliveryTier)
          {
            $('[id$="Delivery-Tier"]').empty(); //remove the delivery tier options
          }
          psSelectedTier = SiebelApp.S_App.NewPropertySet();
          for (var i = 0; i < numOfRec; i++)
          {
            bAddressMatch = false;
            if (!bEmptyDeliveryTier) //delivery tier at shipping header is updated;so update delivery tier at line items with matching address
            {
              strLineItemAddrId = parentAddrJSON[$("#" + (i + 1) + "Ship-ShipToAddress").val()];
              if (strOrdAddrId == strLineItemAddrId)
                bAddressMatch = true;
            }
            if ((bEmptyDeliveryTier || bAddressMatch) && lineItemRecSet[i]['Ship Method'] == "Home Delivery" && lineItemRecSet[i]['Product Line'] != 'DELIVERY' && lineItemRecSet[i]['Product Line'] != 'SERVICE' && lineItemRecSet[i]["Product Type Code"] != ProductTypeCode[0] && ((lineItemRecSet[i]['Fulfillment Status Code'] = 'In Progress') || (lineItemRecSet[i]['SC Revisable'] = 'Revisable' && lineItemRecSet[i]['Request To Cancel'] != 'Y')))
            {
              $("#" + (i + 1) + "Delivery-Tier").val(jsonDeliveryTier[value]); //Set the value at line item
              $("#s_" + appletSeq + "_l tr#" + (i + 1)).trigger("click");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetFieldValue("Shipping", value);
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("WriteRecord");
              SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("RefreshBusComp");
            }
            if (value == "Upd_NonShip_Lines") //called from validate-order;update non-shippable line with the delivery tier chosen for shippable line;
            {
              if (lineItemRecSet[i]['Ship Method'] == "Home Delivery" && lineItemRecSet[i]['Product Line'] != 'DELIVERY' && lineItemRecSet[i]['Product Line'] != 'SERVICE' && lineItemRecSet[i]["Product Type Code"] != ProductTypeCode[0] && ((lineItemRecSet[i]['Fulfillment Status Code'] = 'In Progress') || (lineItemRecSet[i]['SC Revisable'] = 'Revisable' && lineItemRecSet[i]['Request To Cancel'] != 'Y'))) //store the delivery tier of shippable line
              {
                if (!psSelectedTier.PropertyExists(lineItemRecSet[i]["Ship To Address Id"]))
                {
                  psSelectedTier.SetProperty(lineItemRecSet[i]["Ship To Address Id"], lineItemRecSet[i]["Shipping"]);
                }
              }
              if (lineItemRecSet[i]['Ship Method'] == "Home Delivery" && (lineItemRecSet[i]['Product Line'] == 'DELIVERY' || lineItemRecSet[i]['Product Line'] == 'SERVICE') && psSelectedTier.PropertyExists(lineItemRecSet[i]["Ship To Address Id"]) && ((lineItemRecSet[i]['Fulfillment Status Code'] = 'In Progress') || (lineItemRecSet[i]['SC Revisable'] = 'Revisable' && lineItemRecSet[i]['Request To Cancel'] != 'Y')))
              {
                strDeliveryTier = psSelectedTier.GetProperty(lineItemRecSet[i]["Ship To Address Id"]);
                $("#s_" + appletSeq + "_l tr#" + (i + 1)).trigger("click");
                var bWriteRec = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "WriteRecord");
                if (bWriteRec)
                {
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetFieldValue("Shipping", strDeliveryTier);
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("WriteRecord");
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("RefreshBusComp");
                }
              }
            }
          }
          psSelectedTier = null;
        }

        function getDeliveryTierOptions(orderId) //17Sep24;SL;Added for Tiered Delivery
        {
          var tierOptions = '';
          var strEligibleTiers;
          var objService = '',
            inputPS = '',
            outputPS = '';
          var lineItemRecSet, orderRecSet;
          var strEligibleTierArray = [];
          var ps_AddrNode, strPropName, strPropValue;
          var lineDeliveryTiers_list = [],
            groupLineTDs_list = [];
          var strLineIds = "";
          var options;
          var Defalult_ship_AddrId;
          var elemId;
          if (orderId != null && orderId != "") //Get the tier options for line item
          {
            if ($('#Ship-to-Account-button').hasClass('p-item-active'))
            {
              elemId = "acc-Delivery-Tier";
            }
            else
            {
              elemId = "Delivery-Tier";
            }
            inputPS = SiebelApp.S_App.NewPropertySet();
            outputPS = SiebelApp.S_App.NewPropertySet();
            inputPS.SetProperty("Order Id", orderId);
            Defalult_ship_AddrId = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("Ship To Address Id")
            if (Defalult_ship_AddrId != null && Defalult_ship_AddrId != "" && Defalult_ship_AddrId != "No Match Row Id")
            {
              objService = SiebelApp.S_App.GetService("SC Order Management Service");
              outputPS = objService.InvokeMethod("GetDeliveryTier", inputPS);
              sTierEligbleVal = outputPS.GetChild(0).GetProperty("strTierFlag_Mkt");
              if (outputPS.GetChild(0).GetChildByType('Address') != null)
              {
                ps_AddrNode = outputPS.GetChild(0).GetChildByType('Address');
                if (ps_AddrNode.GetChildCount() > 0)
                {
                  for (var i = 0; i < ps_AddrNode.GetChildCount(); i++)
                  {
                    strLineIds = "";
                    strPropName = ps_AddrNode.GetChild(i).GetFirstProperty(); //Line id

                    while (strPropName != "" && strPropName != null)
                    {
                      strLineIds = (strLineIds == "") ? strPropName : (strLineIds + "," + strPropName);
                      strPropValue = ps_AddrNode.GetChild(i).GetProperty(strPropName); //get eligible tiers associated to each line under the same address
                      lineDeliveryTiers_list = strPropValue.split(","); //array of eligible tiers for a line
                      if (lineDeliveryTiers_list.length > 0)
                      {
                        groupLineTDs_list.push(lineDeliveryTiers_list); //array of arrays - group of eligible tier arrays 
                      }
                      strPropName = ps_AddrNode.GetChild(i).GetNextProperty();
                    }
                    strEligibleTierArray = getCommonElements(groupLineTDs_list); //get common delivery tiers
                    lineItemRecSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry - Line Items Form Applet"].GetBusComp().GetRecordSet();
                    for (var j = 0; j < lineItemRecSet.length; j++) //apply delivery tiers for corresponding lines
                    {
                      if (lineItemRecSet[j]['Ship Method'] == "Home Delivery" && lineItemRecSet[j]['Product Line'] != 'DELIVERY' && lineItemRecSet[j]['Product Line'] != 'SERVICE' && lineItemRecSet[j]["Product Type Code"] != ProductTypeCode[0] && strLineIds.indexOf(lineItemRecSet[j]["Id"]) > -1) //populate delivery tiers for all the HD eligible lines
                      {
                        tierOptions = '<option value=""></option>';
                        if (strEligibleTierArray.length == 0 || (strEligibleTierArray.length == 1 && strEligibleTierArray[0] == "")) //If no common eligible tier
                        {
                          $("#s_" + appletSeq + "_l tr#" + (j + 1)).trigger("click");
                          SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetBusComp().SetFieldValue("Shipping", "Home Delivery");
                          SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("WriteRecord");
                          tierOptions += '<option value="Home Delivery" selected>Home Delivery</option>'; //DF-1975;default to Home Delivery
                          $('[id="' + (j + 1) + 'Delivery-Tier"]').addClass("SC-readonly");
                        }
                        for (var k = 0; k < strEligibleTierArray.length; k++)
                        {
                          var tierValue = strEligibleTierArray[k];
                          if (tierValue != "")
                          {
                            tierOptions += '<option value="' + jsonDeliveryTier[tierValue] + '"';
                            if (lineItemRecSet[j]["Shipping"] == tierValue)
                              tierOptions += 'selected>';
                            else
                              tierOptions += '>';
                            tierOptions += tierValue + '</option>';
                          }
                        }
                        $('[id="' + (j + 1) + 'Delivery-Tier"]').html(tierOptions);
                        //below lines to sort the dropdown
                        options = $('[id="' + (j + 1) + 'Delivery-Tier"] option');
                        options.sort((a, b) => a.value.localeCompare(b.value));
                        $('[id="' + (j + 1) + 'Delivery-Tier"]').empty().append(options); //update the sorted options
                      }
                    }
                    orderRecSet = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetRecordSet();
                    if (ps_AddrNode.GetChild(i).GetType() == orderRecSet[0]["Ship To Address Id"]) //apply deliver tier at shipping header
                    {
                      $('#' + elemId).html(tierOptions);
                      //below lines to sort the dropdown
                      options = $('#' + elemId + ' option');
                      options.sort((a, b) => a.value.localeCompare(b.value));
                      $('#' + elemId).empty().append(options); //update the sorted options
                    }
                  }
                }
                else
                  $('#' + elemId).empty(); //DF-1859  
              }
            }
            else
              SiebelJS.Log("Shipping Address Unavailable!!");
          }
        }
        //Start: Funtion to get the all addresses of the billingTo contact
        function AttachAddresses(Addrid)
        {

          var addressLine = '';
          for (var j = 0; j < addList.length; j++)
          {
            if (addList[j] != "")
            {
              var addr_JSON = JSON.parse(addList[j]);
              var DetailAddlist = {};
              //parentAddrJSON[addr_JSON["Address Name"]] = addr_JSON["Id"];
              // parentJSON[addr_JSON["Id"]] = addr_JSON["Address Name"];
              var scmpltaddrval = addr_JSON["Street Address"] + "," + addr_JSON["City"] + "," + addr_JSON["State"] + "," + addr_JSON["Postal Code"];
              parentAddrJSON[scmpltaddrval] = addr_JSON["Id"];
              parentJSON[addr_JSON["Id"]] = scmpltaddrval;
              AddrHDEligible[addr_JSON["Id"]] = addr_JSON["SC HD Eligible"];
              AddrServiceLevel[addr_JSON["Id"]] = addr_JSON["SC HD Service Level"];
            }

          }
          if (parentJSON.hasOwnProperty(Addrid))
            addressLine += '<option>' + parentJSON[Addrid] + '</option>';
          else
            addressLine += '<option></option>';
          for (var j = 0; j < addList.length; j++)
          {
            if (addList[j] != "")
            {
              var addr_JSON = JSON.parse(addList[j]);
              if (addr_JSON["Id"] != Addrid)
              {
                //addressLine += '<option>' + addr_JSON["Address Name"] + '</option>';
                addressLine += '<option>' + addr_JSON["Street Address"] + "," + addr_JSON["City"] + "," + addr_JSON["State"] + "," + addr_JSON["Postal Code"] + '</option>';
              }
            }
          }
          if (addressLine == '')
            addressLine += '<option></option>';

          addressLine += '<span class="new-Add-Address"><option class="new-add">ADD NEW ADDRESS</option></span>';
          //$(".Ship-ShipToAddress").html("");


          return addressLine
        }

        function AttachLineAddresses(PrimaryAddr)
        {

          var addressLine = '';
          addressLine += '<option>' + PrimaryAddr + '</option>';
          for (var j = 0; j < addList.length; j++)
          {
            if (addList[j] != "")
            {
              var addr_JSON = JSON.parse(addList[j]);
              if (PrimaryAddr != addr_JSON["Address Name"])
              {
                //addressLine += '<option>' + addr_JSON["Address Name"] + '</option>';
                addressLine += '<option>' + addr_JSON["Street Address"] + "," + addr_JSON["City"] + "," + addr_JSON["State"] + "," + addr_JSON["Postal Code"] + '</option>';
                //parentJSON[addr_JSON["Id"]] = addr_JSON["Address Name"];
                parentJSON[addr_JSON["Id"]] = addr_JSON["Street Address"] + "," + addr_JSON["City"] + "," + addr_JSON["State"] + "," + addr_JSON["Postal Code"];
                SiebelJS.Log(parentJSON);
              }
            }
          }
          if (addressLine == '')
            addressLine += '<option></option>';
          addressLine += '<span class="new-Add-Address"><option class="new-add">ADD NEW ADDRESS</option></span>';
          SiebelJS.Log(addressLine);


          return addressLine;

        }
        //SBOORLA:code for verfying the regisrty location with MobilePOSNumbers
        function VerifyPOSLocation()
        {
          var storenumber = "",
            storeuser = "";
          var mystoreNumber = "";
          salelocationnumber = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().GetFieldValue("SC Location Store Number");
          storenumber = SiebelApp.S_App.GetProfileAttr("MachineInfo");
          storeuser = SiebelApp.S_App.GetProfileAttr("SC Store User");
          if (storenumber != "" && storenumber != undefined)
          {
            storenumber = storenumber.split('_');
            storenumber = storenumber[0];
          }
          //Start:remove this code once disa installation is done in all machines
          else
            return 2;
          //End:remove this code once disa installation is done in all machines
          if (disaflag === "Y" && storeuser === "Y")
          {
            mystoreNumber = SiebelApp.S_App.GetProfileAttr("SC Store Number");
            if (POSRegArray.indexOf(storenumber) != -1)
            {
              if (salelocationnumber != mystoreNumber)
              {
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Location Change", "Y");
                SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
                $("#SC-SO-CF-verify").modal('hide');
                $("#SC-SO-CF-verify").css(
                {
                  "display": "",
                  "justify-content": "",
                  "align-items": ""
                });
                $("#SC-SO-store-location").modal(
                {
                  backdrop: 'static'
                });
                $("#SC-SO-store-location").css(
                {
                  "display": "flex",
                  "justify-content": "center",
                  "align-items": "center"
                });
                $(".modal-backdrop").css('background', '#ffffff');
                return 1;
              }
            }
            else
            {
              $("#SC-SO-CF-verify").modal('hide');
              $("#SC-SO-CF-verify").css(
              {
                "display": "",
                "justify-content": "",
                "align-items": ""
              });
              $("#SC-SO-my-store").modal(
              {
                backdrop: 'static'
              });
              $("#SC-SO-my-store").css(
              {
                "display": "flex",
                "justify-content": "center",
                "align-items": "center"
              });
              $(".modal-backdrop").css('background', '#ffffff');
              return 0;
            }
            return 2;
          }
          else
          {
            return 2;
          }
        }
        //Start:Function to get lineitem 
        function getordersummarylineitems(outPS)
        {
          poleJSON = [];
          subpoleJSON = [];
          var markup = "";
          var startprice = "";
          var discounts = "";
          var netprice = "";
          var tax = "";
          var pricewithtax = "";
          var addonstartprice = "";
          var addondiscount = "";
          var addontax = "";
          var addonprice = "";
          var addonpricewithtax = "";
          SiebelJS.Log(outPS);

          for (var pr = 0; pr < outPS.GetChild(0).GetChildCount(); pr++)
          {
            startprice = outPS.GetChild(0).GetChild(pr).GetProperty("Start Price") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("Start Price")) : 0.00;
            discounts = outPS.GetChild(0).GetChild(pr).GetProperty("SC Total Line Discounts") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("SC Total Line Discounts")) : 0.00;
            netprice = outPS.GetChild(0).GetChild(pr).GetProperty("NRC Sub Total") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("Item Price - Display")) : 0.00;
            var qty = outPS.GetChild(0).GetChild(pr).GetProperty("Quantity Requested");
            netprice = (netprice * qty).toFixed(2);
            discounts = (discounts * qty).toFixed(2);
            startprice = (startprice * qty).toFixed(2);
            tax = outPS.GetChild(0).GetChild(pr).GetProperty("Tax Amount") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("Tax Amount")) : 0.00;
            pricewithtax = outPS.GetChild(0).GetChild(pr).GetProperty("SC Line Total NRC") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetProperty("SC Line Total NRC")) : 0.00;
            if (outPS.GetChild(0).GetChild(pr).GetProperty("Request To Cancel") != "Y" && outPS.GetChild(0).GetChild(pr).GetProperty("Product Line") != "DELIVERY" && outPS.GetChild(0).GetChild(pr).GetProperty("Product Type Code") != ProductTypeCode)
            {
              markup += '                                <div class="cart-item clearfix no-margin-bottom20">';
              markup += '                                    <div class="SC-SO-Prod-items">';
              markup += '                                        <div class="title-sku less-padding">';
              markup += '                                            <div class="delete-title">';
              markup += '                                                <p class="product-title no-margin">' + outPS.GetChild(0).GetChild(pr).GetProperty("SC Calc Long Description") + '</p>';
              markup += '                                            </div>';
              markup += '                                            <span class="SKU no-padding">SKU#' + outPS.GetChild(0).GetChild(pr).GetProperty("Part Number") + '</span>';
              markup += '                                        </div>';
              markup += '                                        <div class="header-items header-width header-padding">';
              markup += '                                            <div class="header-item header-first-item-width">';
              markup += '                                                <p class="item-title">Quantity</p>';
              markup += '                                                <p class="item-value">' + outPS.GetChild(0).GetChild(pr).GetProperty("Quantity Requested") + '</p>';
              markup += '                                            </div>';
              markup += '                                            <div class="header-item header-first-item-width">';
              markup += '                                                <p class="item-title">START PRICE</p>';
              markup += '                                                <p class="item-value">$' + (startprice).toString().replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
              markup += '                                            </div>';
              markup += '                                            <div class="header-item header-first-item-width">';
              markup += '                                                <p class="item-title">DISCOUNTS</p>';
              markup += '                                                <p class="item-value">$' + (discounts).toString().replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
              markup += '                                            </div>';
              markup += '                                            <div class="header-item header-first-item-width">';
              markup += '                                                <p class="item-title">NET PRICE</p>';
              markup += '                                                <p class="item-value">$' + (netprice).toString().replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
              markup += '                                            </div>';
              markup += '                                            <div class="header-item header-first-item-width">';
              markup += '                                                <p class="item-title">TAX</p>';
              markup += '                                                <p class="item-value">$' + tax.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
              markup += '                                            </div>';
              markup += '                                            <div class="header-item header-last-item-width">';
              markup += '                                                <p class="item-title">PRICE WITH TAX</p>';
              markup += '                                                <p class="item-value">$' + pricewithtax.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
              markup += '                                            </div>';
              markup += '                                        </div>';
              markup += '                                    </div>';
              //SiebelJS.Log(outPS.GetChild(0).GetChild(pr).GetChildCount());
              if (outPS.GetChild(0).GetChild(pr).GetChildCount() != 0)
              {
                markup += '                                    <div class="SC-SO-Prod-addon-items-block">';
                markup += '                                        <span class="no-padding">Add-ons</span>';
              }
              for (var childpr = 0; childpr < outPS.GetChild(0).GetChild(pr).GetChildCount(); childpr++)
              {
                addonstartprice = outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Start Price") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Start Price")) : 0.00;
                addondiscount = outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("SC Total Line Discounts") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("SC Total Line Discounts")) : 0.00;
                addontax = outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Tax Amount") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Tax Amount")) : 0.00;
                addonprice = outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Item Price - Display") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Item Price - Display")) : 0.00;
                addonpricewithtax = outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("SC Line Total NRC") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("SC Line Total NRC")) : 0.00;

                markup += '                                        <div class="SC-SO-Prod-addon-item SC-SO-no-margin no-padding">';
                markup += '                                            <div class="SC-SO-Prod-addon-item-name">';
                markup += '                                                <p class="no-padding">' + outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("SC Calc Long Description") + '</p>';
                markup += '                                            </div>';
                markup += '                                            <div class="SC-SO-Prod-items">';
                markup += '                                                <div class="header-items header-width">';
                markup += '                                                    <div class="header-item header-first-item-width">';
                markup += '                                                        <p class="item-value">' + outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Quantity Requested") + '</p>';
                markup += '                                                    </div>';
                markup += '                                                    <div class="header-item header-first-item-width">';
                markup += '                                                        <p class="item-value">$' + addonstartprice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
                markup += '                                                    </div>';
                markup += '                                                    <div class="header-item header-first-item-width">';
                markup += '                                                        <p class="item-value">$' + addondiscount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
                markup += '                                                    </div>';
                markup += '                                                    <div class="header-item header-first-item-width">';
                markup += '                                                        <p class="item-value">$' + addonprice.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
                markup += '                                                    </div>';
                markup += '                                                    <div class="header-item header-first-item-width">';
                markup += '                                                        <p class="item-value">$' + addontax.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
                markup += '                                                    </div>';
                markup += '                                                    <div class="header-item header-last-item-width">';
                markup += '                                                        <p class="item-value">$' + addonpricewithtax.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,') + '</p>';
                markup += '                                                    </div>';
                markup += '                                                </div>';
                markup += '                                            </div>';
                markup += '                                        </div>';

              }
              if (outPS.GetChild(0).GetChild(pr).GetChildCount() != 0)
                markup += '                                    </div>';
            }
            //SBOORLA:Added code for Pole Display
            if (outPS.GetChild(0).GetChild(pr).GetProperty("Request To Cancel") != "Y" && outPS.GetChild(0).GetChild(pr).GetProperty("Product Type Code") != ProductTypeCode)
            {
              if (outPS.GetChild(0).GetChild(pr).GetProperty("Product Line") != "DELIVERY")
              {
                poleJSON.push(
                {
                  "Command": "Ready",
                  "ProductDesc": outPS.GetChild(0).GetChild(pr).GetProperty("SC Calc Long Description"),
                  "Quantity": outPS.GetChild(0).GetChild(pr).GetProperty("Quantity Requested"),
                  "Price": netprice
                });
              }
              else
              {
                subpoleJSON.push(
                {
                  "Command": "Ready",
                  "ProductDesc": outPS.GetChild(0).GetChild(pr).GetProperty("SC Calc Long Description"),
                  "Quantity": outPS.GetChild(0).GetChild(pr).GetProperty("Quantity Requested"),
                  "Price": netprice
                });
              }
              for (var childpr = 0; childpr < outPS.GetChild(0).GetChild(pr).GetChildCount(); childpr++)
              {
                var poleNetprice = outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Item Price - Display") != "" ? parseFloat(outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Item Price - Display")) : 0.00;
                poleJSON.push(
                {
                  "Command": "Ready",
                  "ProductDesc": outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("SC Calc Long Description"),
                  "Quantity": outPS.GetChild(0).GetChild(pr).GetChild(childpr).GetProperty("Quantity Requested"),
                  "Price": poleNetprice
                });
              }
            }
            markup += '                                </div>';
          }
          if (sP2PEFlag != "Y")
          {
            for (var p = 0; p < subpoleJSON.length; p++)
            {
              poleJSON.push(
              {
                "Command": "Ready",
                "ProductDesc": subpoleJSON[p]["ProductDesc"],
                "Quantity": subpoleJSON[p]["Quantity"],
                "Price": subpoleJSON[p]["Price"]
              });

            }
          }
          SiebelJS.Log("Subpole Json:" + subpoleJSON);
          return markup;
        }
        ////end:Function to get lineitem
        function Get_OrderShipToLineItems(lineItemsRecordSet, shiplineitemrcdset)
        {
          var lineItemsList = '';
          var k = 1;
          var bInvokeTD = "N"; //SL;09Nov24;Added for Tier Delivery
          if (ShipToContactRecordSet[0]["Ship To Contact Id"] != null && ShipToContactRecordSet[0]["Ship To Contact Id"] != "" && ShipToContactRecordSet[0]["Ship To Contact Id"] != "undefined" && ShipToContactRecordSet[0]["Ship To Contact Id"] != "No Match Row Id")
            GetAddressList(ShipToContactRecordSet[0]["Ship To Contact Id"]);
          SiebelJS.Log("Total Line Items Count: " + lineItemsRecordSet.length);
          for (var i = 0; i < lineItemsRecordSet.length; i++)
          {
            //if(i==0 && shiplineitemrcdset[i]["Ship To Contact Id"]!=null&&shiplineitemrcdset[i]["Ship To Contact Id"]!=""&&shiplineitemrcdset[i]["Ship To Contact Id"]!="undefined"&&shiplineitemrcdset[i]["Ship To Contact Id"]!="No Match Row Id")
            //GetAddressList(shiplineitemrcdset[i]["Ship To Contact Id"]);
            if ((scAccountOrder || lineItemsRecordSet[i]["Product Line"] != 'DELIVERY') && shiplineitemrcdset[i]["Product Type Code"] != ProductTypeCode)
            {
              var lineItem = '';
              var ScReadonly = "N";
              /*if(shiplineitemrcdset[i]["Fulfillment Status Code"]=="Booked"||shiplineitemrcdset[i]["Fulfillment Status Code"]=="Closed"||shiplineitemrcdset[i]["Fulfillment Status Code"]=="Completed"||shiplineitemrcdset[i]["Fulfillment Status Code"]=="Cancelled")
				{
					ScReadonly="Y";
				}
				if(ScReadonly=="N"){*/

              //if((shiplineitemrcdset[i]["SC Revisable"]=="Revisable" && shiplineitemrcdset[i]["Request To Cancel"]!="Y")|| shiplineitemrcdset[i]["Fulfillment Status Code"] == "In Progress"){
              if (lineItemsRecordSet[i]["SC Address Revisable"] == "N")
              {
                if (shiplineitemrcdset[i]["Fulfillment Status Code"] == "In Progress")
                {
                  lineItem += '	<div class="table-row">';
                }
                else
                {
                  lineItem += '	<div class="table-row sn-bookedlines-readonly">';
                }
                lineItem += '		<div class="column minitr">' + shiplineitemrcdset[i]["Line Number"] + '</div>';
                //Column1
                lineItem += '		<div class="column bigtr">' + shiplineitemrcdset[i]["SC Long Description"] + '</div>';
                //Column2
                lineItem += '		<div class="column bigtr">';
                //if(ScReadonly=="Y")
                //lineItem += '			<select class="Ship-ShippingMethod-lineitem shipping-dropdown Ship-ShippingMethod SC-readonly" id="' + (i+1) + 'Ship-ShippingMethod">';
                //else
                lineItem += '			<select class="Ship-ShippingMethod-lineitem shipping-dropdown Ship-ShippingMethod" id="' + (i + 1) + 'Ship-ShippingMethod">';
                if (lineItemsRecordSet[i]["Ship Method"] != "")
                {
                  if (lovArray_ShipMethods.includes(lineItemsRecordSet[i]["Ship Method"]))
                    lineItem += '<option>' + lineItemsRecordSet[i]["Ship Method"] + '</option>';
                  else
                    lineItem += '<option hidden>' + lineItemsRecordSet[i]["Ship Method"] + '</option>';
                }
                else
                  lineItem += '<option></option>';
                for (var j = 0; j < lovArray_ShipMethods.length; j++)
                {
                  if (lovArray_ShipMethods[j] != lineItemsRecordSet[i]["Ship Method"])
                    lineItem += '<option>' + lovArray_ShipMethods[j] + '</option>';
                }
                //$('#'+i +'Ship-ShippingMethod').val(lineItemsRecordSet[i]["Ship Method"]);
                lineItem += '			</select>';
                lineItem += '		</div>';
                //column3
                if (shiplineitemrcdset[i]["Shipping"] != null && shiplineitemrcdset[i]["Shipping"] != undefined)
                {
                  //17Sep24;SL;Modified below for Tiered Delivery
                  if (shippingItemsRecordSet[i]['Ship Method'] == "Home Delivery")
                  {
                    bInvokeTD = (bInvokeTD == "N") ? "Y" : bInvokeTD;
                  }
                  if (shippingItemsRecordSet[i]['Ship Method'] == "Home Delivery" && shippingItemsRecordSet[i]['Product Line'] != "SERVICE")
                  {
                    lineItem += '		<div class="column bigtr">';
                    lineItem += '			<select class="shipping-dropdown" id="' + (i + 1) + 'Delivery-Tier">';
                    lineItem += '			</select>';
                    lineItem += '		</div>';
                  }
                  else
                  {
                    lineItem += '   <div class="column bigtr">' + shiplineitemrcdset[i]["Shipping"] + '</div>';
                  }
                }
                else
                {
                  lineItem += '   <div class="column bigtr"> </div>';
                }
                //Column3
                lineItem += '		<div class="column bigtr">';
                //if(ScReadonly=="Y")
                //lineItem += '			<select class="Ship-ShipToAddress-lineitem shipping-dropdown SC-readonly" id="sc-Ship-ShipToAddress">';
                //else 
                lineItem += '			<select class="Ship-ShipToAddress-lineitem shipping-dropdown Ship-ShipToAddress" id="' + (i + 1) + 'Ship-ShipToAddress">';
                //GetAddressList(shiplineitemrcdset[i]["Ship To Contact Id"]);
                //lineaddress=AttachLineAddresses(shiplineitemrcdset[i]["SC Ship To Address Name"]);
                if (shiplineitemrcdset[i]["Ship To Contact Id"] != null && shiplineitemrcdset[i]["Ship To Contact Id"] != "" && shiplineitemrcdset[i]["Ship To Contact Id"] != "undefined" && shiplineitemrcdset[i]["Ship To Contact Id"] != "No Match Row Id")
                {
                  //GetAddressList(shiplineitemrcdset[i]["Ship To Contact Id"]);
                  lineaddress = AttachAddresses(shiplineitemrcdset[i]["Ship To Address Id"]);
                  lineItem += lineaddress;
                }
                lineItem += '			</select>';
                lineItem += '		</div>';

                //Column4
                lineItem += '		<div class="column bigtr contact-popover">';
                //SPATIBANDLA :changed code for defect 616
                var dataContent_Ch_Ad_Contact = "<div><div class='titles' id='Ship_NewContact'>New Contact</div><div class='titles' id='ship_ChangeContact'>Change Contact</div></div>";
                lineItem += '			<img src="images/custom/profile_round_grey.png"  class="sc-shipping-icon-con sc-table-img SC-readonly" id="' + (i + 1) + 'Ship-ShipToContactImg" data-toggle="popover" data-html="true" tooltip-append-to-body="true" data-content="' + dataContent_Ch_Ad_Contact + '" data-original-title="" title="">';
                if (shiplineitemrcdset[i]["Ship To Contact Id"] != null && shiplineitemrcdset[i]["Ship To Contact Id"] != "" && shiplineitemrcdset[i]["Ship To Contact Id"] != "undefined" && shiplineitemrcdset[i]["Ship To Contact Id"] != "No Match Row Id")
                {
                  var shipcontactname = shiplineitemrcdset[i]["Ship To First Name"] + " " + shiplineitemrcdset[i]["Ship To Last Name"];
                  //if(ScReadonly=="Y")
                  //lineItem += '			<input type="" name="" class="shipping-input contact total-width SC-readonly" id="' + (i+1) + 'Ship-ShipToContact" value="' +shipcontactname  + '">';
                  //else
                  lineItem += '			<input type="" name="" class="shipping-input contact total-width ShipToContactlineitem SC-readonly" id="' + (i + 1) + 'Ship-ShipToContact" value="' + shipcontactname + '">';
                }
                else
                  lineItem += '			<input type="" name="" class="shipping-input contact total-width ShipToContactlineitem SC-readonly" id="' + (i + 1) + 'Ship-ShipToContact" value="">';
                lineItem += '		</div>';

                //Column5

                lineItem += '		<div class="column bigtr">';
                if (shiplineitemrcdset[i]["Ship To Contact Id"] != null && shiplineitemrcdset[i]["Ship To Contact Id"] != "" && shiplineitemrcdset[i]["Ship To Contact Id"] != "undefined" && shiplineitemrcdset[i]["Ship To Contact Id"] != "No Match Row Id")
                {
                  var linelevelMbNum = shiplineitemrcdset[i]["SC Preferred Contact"];
                  if (linelevelMbNum != '' && linelevelMbNum.match(/^\d+$/) && linelevelMbNum.length == 10)
                  {
                    var USFormt_mblNum = '';
                    USFormt_mblNum = "(" + linelevelMbNum.substring(0, linelevelMbNum.length - 7) + ") " + linelevelMbNum.substring(3, linelevelMbNum.length - 4) + "-" + linelevelMbNum.substring(6, linelevelMbNum.length);
                    linelevelMbNum = USFormt_mblNum;
                  } //if(ScReadonly=="Y")
                  //lineItem += '			<input type="" name="" class="shipping-input total-width Ship-ShipToContactPhNum SC-readonly" maxlength="14" id="' + (i+1) + 'Ship-ShipToContactPhNum" value="' + linelevelMbNum + '">';
                  //else
                  lineItem += '			<input type="" name="" class="shipping-input total-width Ship-ShipToContactPhNum Ship-ShipToContactPhNum-lineitem" maxlength="14" id="' + (i + 1) + 'Ship-ShipToContactPhNum" value="' + linelevelMbNum + '">';
                }
                else
                  lineItem += '			<input type="" name="" class="shipping-input total-width Ship-ShipToContactPhNum Ship-ShipToContactPhNum-lineitem" id="' + (i + 1) + 'Ship-ShipToContactPhNum" value="">';
                lineItem += '		</div>';
                //new column
                if (lineItemsRecordSet[i]["ATP Status As Of Date"] != null && lineItemsRecordSet[i]["ATP Status As Of Date"] != undefined)
                {
                  lineItem += '   <div class="column smalltr" id="' + (i + 1) + 'Ship-ShippingLineItemATP">' + lineItemsRecordSet[i]["ATP Status As Of Date"] + '</div>';
                }
                else
                {
                  lineItem += '   <div class="column smalltr" id="' + (i + 1) + 'Ship-ShippingLineItemATP"> </div>';
                }
                //Column6
                /*lineItem += '		<div class="column bigtr reqShipDateTD">';
                lineItem += '			<img src="images/custom/calendar.png" class="sc-shipping-icon-cal sc-table-img Ship-Details-Calander" id="' + (i + 1) + 'Ship-Details-Calander">';
                var Reqshipdate = "";
                if (shiplineitemrcdset[i]["Due Date"] != "null" && shiplineitemrcdset[i]["Due Date"] != "")
                    Reqshipdate = shiplineitemrcdset[i]["Due Date"].split(' ')[0];

                if (lineItemsRecordSet[i]["Ship Method"] != "Recd At Store") {
                    //if(ScReadonly=="Y")
                    //lineItem += '			<input type="" name="" class="shipping-input date total-width SC-readonly" id="' + (i+1) + 'defaultRequestShipDate" value="' + Reqshipdate + '">';
                    //else
                    lineItem += '			<input type="" name="" class="shipping-input date total-width defaultRequestShipDate reqShipDateTDSN" id="' + (i + 1) + 'defaultRequestShipDate" value="' + Reqshipdate + '">';
                } else
                    lineItem += '			<input type="" name="" class="shipping-input date total-width SC-readonly SN-fields-readonly reqShipDateTDSN" id="' + (i + 1) + 'defaultRequestShipDate" value="">';
                lineItem += '		</div>';*/
                lineItem += '	</div>';


                lineItemsList += lineItem;
              }
            } //END OF IF 

            k = k + 1;
          } //END OF FOR LOOP
          $("#TBody-Ship-Details-LineItems").html(lineItemsList);
          $("#TBody-Ship-Details-LineItems").find(".sn-bookedlines-readonly").find(".reqShipDateTDSN").addClass("SC-readonly");
          $("#TBody-Ship-Details-LineItems").find(".sn-bookedlines-readonly").find(".Ship-ShipToContactPhNum-lineitem").addClass("SC-readonly");
          $("#TBody-Ship-Details-LineItems").find(".sn-bookedlines-readonly").find(".Ship-ShippingMethod").addClass("SC-readonly");
          $("#TBody-Ship-Details-LineItems").find(".SC-readonly").addClass("SN-fields-readonly");
          if (bInvokeTD == "Y") //08Oct24;SL;Added for Tiered Delivery
          {
            getDeliveryTierOptions(orderid);
          }
          //SYERUVA: Added code to make deliveryPhone readonly - STRY0104341
          /* if(!($(".Ship-ShipToContactPhNum").hasClass("SN-fields-readonly")))
              $(".Ship-ShipToContactPhNum").addClass("SN-fields-readonly SC-readonly"); */
          //Start: Showing - Hiding Pop over for Change/Add Contact
          $(".SC-shipping-table .table-row .contact-popover Img").popover(
          {
            trigger: "click",
            placement: "bottom",
          });
          $(document).on('click', ".SC-shipping-table .table-row .contact-popover Img", function (e)
          {

            //var con_id = 

            $(".SC-shipping-table .table-row .contact-popover img").not(this).popover('hide');
            $(this).addClass("credit-active");

          });
          //End: Showing - Hiding Pop over for Change/Add Contact
        };

        function Get_OrderShipToLineItemsAccount(lineItemsRecordSet, shiplineitemrcdset)
        {
          var lineItemsList = '';
          var k = 1;
          var bInvokeTD = "N"; //SL;09Nov24;Added for Tier Delivery
          SiebelJS.Log("Total Line Items Count: " + lineItemsRecordSet.length);
          GetAccountAddressList(ShipToContactRecordSet[0]["Bill To Account Id"]);
          SiebelJS.Log("Total Line Items Count: " + lineItemsRecordSet.length);
          for (var i = 0; i < lineItemsRecordSet.length; i++)
          {
            //if(i==0)
            //GetAccountAddressList(ShipToContactRecordSet[i]["Bill To Account Id"]);
            if (shiplineitemrcdset[i]["Product Type Code"] != ProductTypeCode)
            {
              var lineItem = '';
              var ScReadonly = "N";
              //if((shiplineitemrcdset[i]["SC Revisable"]=="Revisable" && shiplineitemrcdset[i]["Request To Cancel"]!="Y" )|| shiplineitemrcdset[i]["Fulfillment Status Code"] == "In Progress"){
              if (lineItemsRecordSet[i]["SC Address Revisable"] == "N")
              {
                if (shiplineitemrcdset[i]["Fulfillment Status Code"] == "In Progress")
                {
                  lineItem += '	<div class="table-row">';
                }
                else
                {
                  lineItem += '	<div class="table-row sn-bookedlines-readonly">';
                }
                lineItem += '		<div class="column minitr">' + shiplineitemrcdset[i]["Line Number"] + '</div>';
                //Column1
                lineItem += '		<div class="column bigtr">' + shiplineitemrcdset[i]["SC Long Description"] + '</div>';
                //Column2
                lineItem += '		<div class="column bigtr">';
                lineItem += '			<select class="Ship-ShippingMethod-lineitem shipping-dropdown Ship-ShippingMethod" id="' + (i + 1) + 'Ship-ShippingMethod">';
                if (lineItemsRecordSet[i]["Ship Method"] != "")
                {
                  if (lovArray_ShipMethods.includes(lineItemsRecordSet[i]["Ship Method"]))
                    lineItem += '<option>' + lineItemsRecordSet[i]["Ship Method"] + '</option>';
                  else
                    lineItem += '<option hidden>' + lineItemsRecordSet[i]["Ship Method"] + '</option>';
                }
                else
                  lineItem += '<option></option>';
                for (var j = 0; j < lovArray_ShipMethods.length; j++)
                {
                  if (lovArray_ShipMethods[j] != lineItemsRecordSet[i]["Ship Method"])
                    lineItem += '<option>' + lovArray_ShipMethods[j] + '</option>';
                }
                lineItem += '			</select>';
                lineItem += '		</div>';
                //SL;12Nov24;Added below for Tier Delivery
                if (shiplineitemrcdset[i]["Shipping"] != null && shiplineitemrcdset[i]["Shipping"] != undefined)
                {
                  //09Nov24;SL;Modified below for Tiered Delivery
                  if (shippingItemsRecordSet[i]['Ship Method'] == "Home Delivery")
                  {
                    bInvokeTD = (bInvokeTD == "N") ? "Y" : bInvokeTD;
                  }
                  if (shiplineitemrcdset[i]['Ship Method'] == "Home Delivery" && shiplineitemrcdset[i]['Product Line'] != "SERVICE" && shiplineitemrcdset[i]['Product Line'] != "DELIVERY")
                  {
                    lineItem += '		<div class="column bigtr">';
                    lineItem += '			<select class="shipping-dropdown" id="' + (i + 1) + 'Delivery-Tier">';
                    lineItem += '			</select>';
                    lineItem += '		</div>';
                  }
                  else
                  {
                    lineItem += '   <div class="column bigtr">' + shiplineitemrcdset[i]["Shipping"] + '</div>';
                  }
                }
                else
                {
                  lineItem += '   <div class="column bigtr"> </div>';
                }
                //Column3
                lineItem += '		<div class="column bigtr">';
                lineItem += '			<select class="Ship-ShipToAddress-lineitem shipping-dropdown Ship-ShipToAddress" id="' + (i + 1) + 'Ship-ShipToAddress">';
                //GetAddressList(shiplineitemrcdset[i]["Ship To Contact Id"]);
                //lineaddress=AttachLineAddresses(shiplineitemrcdset[i]["SC Ship To Address Name"]);
                //GetAddressList(shiplineitemrcdset[i]["Ship To Contact Id"]);
                lineaddress = AttachAddresses(shiplineitemrcdset[i]["Ship To Address Id"]);
                lineItem += lineaddress;
                lineItem += '			</select>';
                lineItem += '		</div>';

                //Column4
                lineItem += '		<div class="column bigtr contact-popover">';
                //SPATIBANDLA :changed code for defect 616
                var dataContent_Ch_Ad_Contact = "<div><div class='titles' id='Ship_NewContact'>New Contact</div><div class='titles' id='ship_ChangeContact'>Change Contact</div></div>";
                lineItem += '			<img src="images/custom/profile_round_grey.png"  class="sc-shipping-icon-con sc-table-img SC-readonly" id="' + (i + 1) + 'Ship-ShipToContactImg" data-toggle="popover" data-html="true" tooltip-append-to-body="true" data-content="' + dataContent_Ch_Ad_Contact + '" data-original-title="" title="">';


                lineItem += '			<input type="" name="" class="shipping-input contact total-width ShipToContactlineitem SC-readonly" id="' + (i + 1) + 'Ship-ShipToContact" value="' + ShipToContactRecordSet[0]["Bill To Account"] + '">';
                lineItem += '		</div>';

                //Column5

                lineItem += '		<div class="column bigtr">';

                var linelevelMbNum = shiplineitemrcdset[i]["SC Preferred Contact"];
                if (linelevelMbNum != '' && linelevelMbNum.match(/^\d+$/) && linelevelMbNum.length == 10)
                {
                  var USFormt_mblNum = '';
                  USFormt_mblNum = "(" + linelevelMbNum.substring(0, linelevelMbNum.length - 7) + ") " + linelevelMbNum.substring(3, linelevelMbNum.length - 4) + "-" + linelevelMbNum.substring(6, linelevelMbNum.length);
                  linelevelMbNum = USFormt_mblNum;
                }
                lineItem += '			<input type="" name="" class="shipping-input total-width Ship-ShipToContactPhNum Ship-ShipToContactPhNum-lineitem" maxlength="14" id="' + (i + 1) + 'Ship-ShipToContactPhNum" value="' + linelevelMbNum + '">';

                lineItem += '		</div>';
                //new column
                if (lineItemsRecordSet[i]["ATP Status As Of Date"] != null && lineItemsRecordSet[i]["ATP Status As Of Date"] != undefined)
                {
                  lineItem += '   <div class="column smalltr" id="' + (i + 1) + 'Ship-ShippingLineItemATP">' + lineItemsRecordSet[i]["ATP Status As Of Date"] + '</div>';
                }
                else
                {
                  lineItem += '   <div class="column smalltr" id="' + (i + 1) + 'Ship-ShippingLineItemATP"> </div>';
                }
                //Column6
                lineItem += '		<div class="column bigtr reqShipDateTD">';
                lineItem += '			<img src="images/custom/calendar.png" class="sc-shipping-icon-cal sc-table-img Ship-Details-Calander" id="' + (i + 1) + 'Ship-Details-Calander">';
                var Reqshipdate = "";
                if (shiplineitemrcdset[i]["Due Date"] != "null" && shiplineitemrcdset[i]["Due Date"] != "")
                  Reqshipdate = shiplineitemrcdset[i]["Due Date"].split(' ')[0];

                if (lineItemsRecordSet[i]["Ship Method"] != "Recd At Store")
                {

                  lineItem += '			<input type="" name="" class="shipping-input date total-width defaultRequestShipDate reqShipDateTDSN" id="' + (i + 1) + 'defaultRequestShipDate" value="' + Reqshipdate + '">';
                }
                else
                  lineItem += '			<input type="" name="" class="shipping-input date total-width SC-readonly reqShipDateTDSN" id="' + (i + 1) + 'defaultRequestShipDate" value="">';
                lineItem += '		</div>';
                lineItem += '	</div>';


                lineItemsList += lineItem;
              }
            } //END OF IF 

            k = k + 1;
          } //END OF FOR LOOP
          $("#TBody-Ship-Details-LineItems").html(lineItemsList);
          $("#TBody-Ship-Details-LineItems").find(".sn-bookedlines-readonly").find(".reqShipDateTDSN").addClass("SC-readonly");
          $("#TBody-Ship-Details-LineItems").find(".sn-bookedlines-readonly").find(".Ship-ShipToContactPhNum-lineitem").addClass("SC-readonly");
          $("#TBody-Ship-Details-LineItems").find(".sn-bookedlines-readonly").find(".Ship-ShippingMethod").addClass("SC-readonly");
          $("#TBody-Ship-Details-LineItems").find(".SC-readonly").addClass("SN-fields-readonly");
          if (bInvokeTD == "Y") //08Oct24;SL;Added for Tiered Delivery
          {
            getDeliveryTierOptions(orderid);
          }
          //SYERUVA: Added code to make deliveryPhone readonly - STRY0104341
          /* if(!($(".Ship-ShipToContactPhNum").hasClass("SN-fields-readonly")))
              $(".Ship-ShipToContactPhNum").addClass("SN-fields-readonly SC-readonly"); */

        };

        function ContactAccountSearch_GetRecordSearch()
        {
          var AccountContactPM = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Account Contact Shipping List OUI"].GetPModel().GetRenderer().GetPM();
          var AccconSearch_RS = AccountContactPM.Get("GetRecordSet");
          var rcdLen = "";
          var newRecord = '';
          var ContactDetails = "";
          newRecord += '                                <table class="SC-table" id="SC-table-search-contact">';
          newRecord += '                                    <thead>';
          newRecord += '                                        <tr>';
          newRecord += '                                            <th class="sort-by" id="sp-lastname">last name</th>';
          newRecord += '                                            <th class="sort-by" id="sp-firstname">first name</th>';
          newRecord += '                                            <th class="sort-by" id="sp-address">address</th>';
          newRecord += '                                            <th class="sort-by" id="sp-city">city</th>';
          newRecord += '                                            <th class="sort-by" id="sp-state">state</th>';
          newRecord += '                                            <th class="sort-by" id="sp-zipcode">zipcode</th>';
          newRecord += '                                        </tr>';
          newRecord += '                                    </thead>';
          newRecord += '                                    <tbody>';
          rcdLen = AccconSearch_RS.length;
          for (var loop = 0; loop < rcdLen; loop++)
          {
            ContactDetails = "";
            ContactDetails = AccconSearch_RS[loop]["Primary Personal Address Id"] + '_' + AccconSearch_RS[loop]["Contact Id"] + '_' + AccconSearch_RS[loop]["First Name"] + '_' + AccconSearch_RS[loop]["Last Name"] + '_' + AccconSearch_RS[loop]["Cellular Phone #"];
            newRecord += '		<tr id="SC-Conta-Search-Rcd' + loop + '">';
            newRecord += '      <td><span style="display:none" id="' + loop + 'shiprcdset">' + ContactDetails + '</span>' + AccconSearch_RS[loop]["Last Name"] + '</td>';
            newRecord += '      <td>' + AccconSearch_RS[loop]["First Name"] + '</td>';
            newRecord += '      <td>' + AccconSearch_RS[loop]["Personal Street Address"] + '</td>';
            newRecord += '      <td>' + AccconSearch_RS[loop]["Personal City"] + '</td>';
            newRecord += '      <td>' + AccconSearch_RS[loop]["Personal State"] + '</td>';
            newRecord += '      <td>' + AccconSearch_RS[loop]["Personal Postal Code"] + '</td>';
            newRecord += '  </tr>';
          }
          newRecord += '                                    </tbody>';
          newRecord += '                                </table>';
          if (AccconSearch_RS.length == 0)
          {
            if (sChangeContactClicked == "Y")
            {
              //sChangeContactClicked="N";
              var noresults_markup = "";
              noresults_markup += ' <div class="SC-noresults-container clearfix no-padding margin-top">';
              noresults_markup += '                <div class="text-block">';
              noresults_markup += '                    <p>No Contacts found</p>';
              noresults_markup += '                </div>';
              noresults_markup += '            </div>';
              $("#SC-table-search-contact-body").html(noresults_markup);
            }
            else
            {
              markup = SC_OUI_Markups.ResultsMessage(AccountContactPM, FieldQueryPair, "contacts");
              $("#SC-table-search-contact-body").html(markup);
            }
          }
          else
          {

            $("#shipping-contact-pagination").show();
            SC_OUI_Methods.PrimaryButton(AccountContactPM, 'shipping-contact-pagination');
            $('#SC-table-search-contact-body').html(newRecord);
          }
        }

        function DeliveryTypePopup()
        {
          var sOrderRevisionNum = parseInt(ShipToContactRecordSet[0]["Revision"]);
          var pEligibleAddresses = SiebelApp.S_App.NewPropertySet();
          var inPS = "",
            outPS = "",
            Bservice = "",
            bEligibleAdderCount = 0,
            bReOptionEligibleAdderCount = 0,
            iEligibleAdderCount = 0;
          inPS = SiebelApp.S_App.NewPropertySet();
          outPS = SiebelApp.S_App.NewPropertySet();
          inPS.SetProperty("OrderId", orderid);
          if (sTierEligbleVal == "N")
          {
            Bservice = SiebelApp.S_App.GetService("SC Order Management Service");
            outPS = Bservice.InvokeMethod("CheckProductEligibilty", inPS);
            pEligibleAddresses = outPS.GetChild(0).GetChildByType('EligibleAddresses');
            iEligibleAdderCount = parseInt(pEligibleAddresses.GetProperty('EligibleAdder_Count'));
            bReOptionEligibleAdderCount = parseInt(pEligibleAddresses.GetProperty('ReOptionEligAddrs_Cnt'));
          }
          //if(pEligibleAddresses.GetChildCount()){
          if (iEligibleAdderCount)
          {
            var deliveryTypeMarkup = SCOrderShipMarkup.SelectDeliveryType(pEligibleAddresses);
            $("#custommaskoverlay").hide();
            $("#SC-Delivery-Type").html(deliveryTypeMarkup);
            $("#SC-Delivery-Type").modal(
            {
              backdrop: 'static'
            });
            $("#SC-Delivery-Type").css(
            {
              "display": "flex",
              "justify-content": "center",
              "align-items": "center"
            });
            $(".modal-backdrop").css('background', '#ffffff');
          }
          else if (bReOptionEligibleAdderCount && sOrderRevisionNum > 1)
          {
            $("#SC-SO-CF-verify").modal('hide');
            var deliveryTypeMarkup = SCOrderShipMarkup.ReSelectDeliveryTypeOption(pEligibleAddresses);
            $("#custommaskoverlay").hide();
            $("#SC-Delivery-Type").html(deliveryTypeMarkup);
            $("#SC-Delivery-Type").modal(
            {
              backdrop: 'static'
            });
            $("#SC-Delivery-Type").css(
            {
              "display": "flex",
              "justify-content": "center",
              "align-items": "center"
            });
            $(".modal-backdrop").css('background', '#ffffff');
          }
          else
          {
            var fieldvalues = "Home Delivery";
            var fieldnames = "Shipping";
            var Bservice = '',
              inPS = '',
              outPS = '';
            inPS = SiebelApp.S_App.NewPropertySet();
            outPS = SiebelApp.S_App.NewPropertySet();
            inPS.SetProperty("BO", "Order Entry (Sales)");
            inPS.SetProperty("BC", "Order Entry - Line Items");
            inPS.SetProperty("FieldsArray", fieldnames);
            Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service
            inPS.SetProperty("ValuesArray", fieldvalues);
            //inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND ([Fulfillment Status Code] <> 'Closed' OR [Fulfillment Status Code] <> 'Cancelled') AND [Ship Method] = 'Home Delivery' AND [Request To Cancel] <> 'Y'");
            //07Oct24;SL;Tier Delivery - Added Shipping criteria to the search spec;
            inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND ([Fulfillment Status Code] = 'In Progress' OR [SN Address Update Flag]='Y') AND [Ship Method] = 'Home Delivery' AND [Request To Cancel] <> 'Y' AND ([Shipping] = 'Home Delivery' OR [Shipping] IS NULL)");
            outPS = Bservice.InvokeMethod("Insert", inPS);
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Freight Calculated Flag", "N");
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
            var inPropSet = CCFMiscUtil_CreatePropSet();
            var ai = {};
            ai.async = true;
            ai.selfbusy = true;
            ai.scope = this;
            ai.mask = true;
            ai.opdecode = true;
            ai.errcb = function ()
            {
              //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
              SiebelJS.Log("In validate Error");
            };
            ai.cb = function ()
            {
              //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
              SiebelJS.Log("In Validate Call Back");
              $("#SC-Delivery-Type").modal('hide');
              var canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
              var canInvokeVerify = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "QuotesAndOrdersValidate");
              if (canInvokeVerify)
              {
                $("#SC-SO-CF-verify").modal(
                {
                  backdrop: 'static'
                });
                $("#SC-SO-CF-verify").css(
                {
                  "display": "flex",
                  "justify-content": "center",
                  "align-items": "center"
                });
                $(".modal-backdrop").css('background', '#ffffff');
                $("#custommaskoverlay").show();
                setTimeout(function ()
                {
                  //SCVerify = 'Y';
                  var inPropSet = CCFMiscUtil_CreatePropSet();
                  var ai = {};
                  ai.async = true;
                  ai.selfbusy = true;
                  ai.scope = this;
                  ai.mask = true;
                  ai.opdecode = true;
                  ai.errcb = function ()
                  {
                    //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                    SiebelJS.Log("In validate Error");
                  };
                  ai.cb = function ()
                  {
                    //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                    SiebelJS.Log("In Validate Call Back");
                    SCVerify = 'Y';
                    var inPropSet1 = CCFMiscUtil_CreatePropSet();
                    var a1i = {};
                    a1i.async = true;
                    a1i.selfbusy = true;
                    a1i.scope = this;
                    a1i.mask = true;
                    a1i.opdecode = true;
                    a1i.errcb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                      SiebelJS.Log("In validate Error");
                    };
                    a1i.cb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                      SiebelJS.Log("In Validate Call Back");
                    };
                    SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet1, a1i);
                  };
                  SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", inPropSet, ai);
                }, 100);
              }
              else if (canInvokeCalculate)
              {
                $("#SC-SO-CF-verify").modal(
                {
                  backdrop: 'static'
                });
                $("#SC-SO-CF-verify").css(
                {
                  "display": "flex",
                  "justify-content": "center",
                  "align-items": "center"
                });
                $(".modal-backdrop").css('background', '#ffffff');
                $("#custommaskoverlay").show();
                setTimeout(function ()
                {
                  var canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
                  if (canInvokeCalculate)
                  {
                    SCfrieghtCalculation = 'Y';
                    var inPropSet = CCFMiscUtil_CreatePropSet();
                    var ai = {};
                    ai.async = true;
                    ai.selfbusy = true;
                    ai.scope = this;
                    ai.mask = true;
                    ai.opdecode = true;
                    ai.errcb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                      SiebelJS.Log("In validate Error");
                    };
                    ai.cb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                      SiebelJS.Log("In Validate Call Back");
                    };
                    SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "SC Calculate Shipping", inPropSet, ai);
                  }
                }, 100);
              }
              else
              {
                SiebelJS.Log("Not able to invoke SC Freight Calculate")
              }
            };
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
          }

          $(document).on('click', '.SC-order-DelType input', function (e)
          {
            e.stopImmediatePropagation();
            var cnt = 0;
            $(".SC-order-DelType input[type=radio]:checked").each(function ()
            {
              cnt = cnt + 1;
            });
            if (cnt == iEligibleAdderCount)
            {
              $("#update-delivery-type").removeClass("SC-disabled");
              $("#update-delivery-type").attr("style", "background: #F63 !important;border: #F63 !important;");
            }
            else
            {
              $("#update-delivery-type").addClass("SC-disabled");
              $("#update-delivery-type").attr("style", "background: #808080!important;border: #808080	!important;");
            }
          });


          $(document).on('click', '.SC-order-ReDelType input', function (e)
          {
            e.stopImmediatePropagation();
            var cnt = 0;
            $(".SC-order-ReDelType input[type=radio]:checked").each(function ()
            {
              cnt = cnt + 1;
            });
            if (cnt == bReOptionEligibleAdderCount)
            {
              $("#update-delivery-type").removeClass("SC-disabled");
              $("#update-delivery-type").attr("style", "background: #F63 !important;border: #F63 !important;");
            }
            else
            {
              $("#update-delivery-type").addClass("SC-disabled");
              $("#update-delivery-type").attr("style", "background: #808080!important;border: #808080	!important;");
            }
          });


          $(document).on('click', '#update-delivery-type-cancel', function (e)
          {
            e.stopImmediatePropagation();
            $("#SC-Delivery-Type").modal('hide');
            $("#SC-SO-CF-verify").modal(
            {
              backdrop: 'static'
            });
            $("#SC-SO-CF-verify").css(
            {
              "display": "flex",
              "justify-content": "center",
              "align-items": "center"
            });
            $(".modal-backdrop").css('background', '#ffffff');
            $("#custommaskoverlay").show();
            setTimeout(function ()
            {
              var inPropSet = CCFMiscUtil_CreatePropSet();
              var ai = {};
              ai.async = true;
              ai.selfbusy = true;
              ai.scope = this;
              ai.mask = true;
              ai.opdecode = true;
              ai.errcb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                SiebelJS.Log("In validate Error");
              };
              ai.cb = function ()
              {
                //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                SiebelJS.Log("In Validate Call Back");
                $("#SC-Delivery-Type").modal('hide');
                var canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
                var canInvokeVerify = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "QuotesAndOrdersValidate");
                if (canInvokeVerify)
                {
                  $("#SC-SO-CF-verify").modal(
                  {
                    backdrop: 'static'
                  });
                  $("#SC-SO-CF-verify").css(
                  {
                    "display": "flex",
                    "justify-content": "center",
                    "align-items": "center"
                  });
                  $(".modal-backdrop").css('background', '#ffffff');
                  $("#custommaskoverlay").show();
                  setTimeout(function ()
                  {
                    //SCVerify = 'Y';
                    var inPropSet = CCFMiscUtil_CreatePropSet();
                    var ai = {};
                    ai.async = true;
                    ai.selfbusy = true;
                    ai.scope = this;
                    ai.mask = true;
                    ai.opdecode = true;
                    ai.errcb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                      SiebelJS.Log("In validate Error");
                    };
                    ai.cb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                      SiebelJS.Log("In Validate Call Back");
                      SCVerify = 'Y';
                      var inPropSet1 = CCFMiscUtil_CreatePropSet();
                      var a1i = {};
                      a1i.async = true;
                      a1i.selfbusy = true;
                      a1i.scope = this;
                      a1i.mask = true;
                      a1i.opdecode = true;
                      a1i.errcb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                        SiebelJS.Log("In validate Error");
                      };
                      a1i.cb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                        SiebelJS.Log("In Validate Call Back");
                      };
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet1, a1i);
                    };
                    SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", inPropSet, ai);
                  }, 100);
                }
                else if (canInvokeCalculate)
                {
                  $("#SC-SO-CF-verify").modal(
                  {
                    backdrop: 'static'
                  });
                  $("#SC-SO-CF-verify").css(
                  {
                    "display": "flex",
                    "justify-content": "center",
                    "align-items": "center"
                  });
                  $(".modal-backdrop").css('background', '#ffffff');
                  $("#custommaskoverlay").show();
                  setTimeout(function ()
                  {
                    var canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
                    if (canInvokeCalculate)
                    {
                      SCfrieghtCalculation = 'Y';
                      var inPropSet = CCFMiscUtil_CreatePropSet();
                      var ai = {};
                      ai.async = true;
                      ai.selfbusy = true;
                      ai.scope = this;
                      ai.mask = true;
                      ai.opdecode = true;
                      ai.errcb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                        SiebelJS.Log("In validate Error");
                      };
                      ai.cb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                        SiebelJS.Log("In Validate Call Back");
                      };
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "SC Calculate Shipping", inPropSet, ai);
                    }
                  }, 100);
                }
                else
                {
                  SiebelJS.Log("Not able to invoke SC Freight Calculate")
                }
              };
            })

          });


          $(document).on('click', '#update-delivery-type-option', function (e)
          {
            e.stopImmediatePropagation();
            setTimeout(function ()
            {
              var deliveryTypeMarkup = SCOrderShipMarkup.ReSelectDeliveryType(pEligibleAddresses);
              $("#SC-Delivery-Type").html(deliveryTypeMarkup);

            }, 100);
          });

          $(document).on('click', '#update-delivery-type', function (e)
          {
            e.stopImmediatePropagation();
            var addressId = "",
              sHUBName, sRegionName;
            var fieldvalues = "";
            var fieldnames = "Shipping";
            var Bservice = '',
              inPS = '',
              outPS = '';
            inPS = SiebelApp.S_App.NewPropertySet();
            outPS = SiebelApp.S_App.NewPropertySet();
            inPS.SetProperty("BO", "Order Entry (Sales)");
            inPS.SetProperty("BC", "Order Entry - Line Items");
            inPS.SetProperty("FieldsArray", fieldnames);
            Bservice = SiebelApp.S_App.GetService("SC Custom Query Simplified"); //get service

            for (var i = 0; i < pEligibleAddresses.GetChildCount(); i++)
            {
              addressId = pEligibleAddresses.GetChild(i).GetValue();
              var ele = document.getElementsByName(addressId);
              for (var j = 0; j < ele.length; j++)
              {
                if (ele[j].checked)
                {
                  pEligibleAddresses.GetChild(i).SetProperty("SC New Delivery Type", ele[j].value);
                  //if(pEligibleAddresses.GetChild(i).GetProperty("SC Delivery Type") !== ele[j].value){
                  sRegionName = pEligibleAddresses.GetChild(i).GetProperty("Group");
                  sHUBName = pEligibleAddresses.GetChild(i).GetProperty("Ship From Location")
                  //fieldvalues = ele[j].value+ ','+sRegionName+ ',' +sHUBName;
                  fieldvalues = ele[j].value;
                  inPS.SetProperty("ValuesArray", fieldvalues);
                  //07Oct24;SL;Tier Delivery - Added Shipping criteria to the search spec;
                  inPS.SetProperty("SearchSpecification", "[Order Header Id] = '" + orderid + "'AND ([Fulfillment Status Code] <> 'Closed' OR [Fulfillment Status Code] <> 'Cancelled') AND [Ship To Address Id]='" + addressId + "' AND [Ship Method] = 'Home Delivery' AND [Request To Cancel] <> 'Y' AND ([Shipping] = 'Home Delivery' OR [Shipping] IS NULL)");
                  outPS = Bservice.InvokeMethod("Insert", inPS);
                  //}
                }
              }
            }
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetBusComp().SetFieldValue("SC Freight Calculated Flag", "N");
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].InvokeMethod("WriteRecord");
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].InvokeMethod("RefreshBusComp");

            FieldQueryPair = {
              "Id": "IS NOT NULL"
            };
            SC_OUI_Methods.ExecuteListAppletFramesync(SiebelConstant, FieldQueryPair, "SC Order Entry Line Item List Applet");

            //SCCalcualteFrieghtandTax();
            var inPropSet = CCFMiscUtil_CreatePropSet();
            var ai = {};
            ai.async = true;
            ai.selfbusy = true;
            ai.scope = this;
            ai.mask = true;
            ai.opdecode = true;
            ai.errcb = function ()
            {
              //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
              SiebelJS.Log("In validate Error");
            };
            ai.cb = function ()
            {
              //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
              SiebelJS.Log("In Validate Call Back");
              $("#SC-Delivery-Type").modal('hide');
              setTimeout(function ()
              {
                var canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
                var canInvokeVerify = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "QuotesAndOrdersValidate");
                if (canInvokeVerify)
                {
                  $("#SC-SO-CF-verify").modal(
                  {
                    backdrop: 'static'
                  });
                  $("#SC-SO-CF-verify").css(
                  {
                    "display": "flex",
                    "justify-content": "center",
                    "align-items": "center"
                  });
                  $(".modal-backdrop").css('background', '#ffffff');
                  $("#custommaskoverlay").show();
                  setTimeout(function ()
                  {
                    SCVerify = 'Y';
                    var inPropSet = CCFMiscUtil_CreatePropSet();
                    var ai = {};
                    ai.async = true;
                    ai.selfbusy = true;
                    ai.scope = this;
                    ai.mask = true;
                    ai.opdecode = true;
                    ai.errcb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                      SiebelJS.Log("In validate Error");
                    };
                    ai.cb = function ()
                    {
                      //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                      SiebelJS.Log("In Validate Call Back");
                    };
                    SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Sales Order Entry Form Applet OUI"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "QuotesAndOrdersValidate", inPropSet, ai);
                  }, 100);
                }
                else if (canInvokeCalculate)
                {
                  $("#SC-SO-CF-verify").modal(
                  {
                    backdrop: 'static'
                  });
                  $("#SC-SO-CF-verify").css(
                  {
                    "display": "flex",
                    "justify-content": "center",
                    "align-items": "center"
                  });
                  $(".modal-backdrop").css('background', '#ffffff');
                  $("#custommaskoverlay").show();
                  setTimeout(function ()
                  {
                    var canInvokeCalculate = SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("CanInvokeMethod", "SC Calculate Shipping");
                    if (canInvokeCalculate)
                    {
                      SCfrieghtCalculation = 'Y';
                      var inPropSet = CCFMiscUtil_CreatePropSet();
                      var ai = {};
                      ai.async = true;
                      ai.selfbusy = true;
                      ai.scope = this;
                      ai.mask = true;
                      ai.opdecode = true;
                      ai.errcb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call fails
                        SiebelJS.Log("In validate Error");
                      };
                      ai.cb = function ()
                      {
                        //Code occurs here for the method that Siebel Open UI runs if the AJAX call is successful
                        SiebelJS.Log("In Validate Call Back");
                      };
                      SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "SC Calculate Shipping", inPropSet, ai);
                    }
                  }, 100);
                }
                else
                {
                  SiebelJS.Log("Not able to invoke SC Freight Calculate")
                }
              }, 100);
            };
            SiebelApp.S_App.GetActiveView().GetAppletMap()["SC Order Entry Line Item List Applet"].GetPModel().GetRenderer().GetPM().ExecuteMethod("InvokeMethod", "RefreshBusComp", inPropSet, ai);
          });
        }

        function getPOSNumbers()
        {
          //SBOORLA:Added code for defect 864
          var eventid = "";
          var SCStoreNumber = SC_OUI_Methods.SCGetProfileAttrValue("SC Store Number");
          var SCStoreNumber = ShipToContactRecordSet[0]["SC Store Number"];
          var Custom_Service = "",
            Input_BS = "",
            Out_BS = "";
          Custom_Service = SiebelApp.S_App.GetService("SC Custom Query");
          Input_BS = SiebelApp.S_App.NewPropertySet();
          Out_BS = SiebelApp.S_App.NewPropertySet();
          searchfields = "Id";
          Input_BS.SetProperty("BO", "Internal Division");
          Input_BS.SetProperty("BC", "Internal Division");
          Input_BS.SetProperty("SearchSpecification", "[SC Store Number] = '" + SCStoreNumber + "'");
          Input_BS.SetProperty("SortSpecification", "");
          Input_BS.SetProperty("ReqNoOfRecords", "");
          Input_BS.SetProperty("FieldsArray", searchfields);
          Out_BS = Custom_Service.InvokeMethod("Query", Input_BS);
          var Child_BS = Out_BS.GetChild(0);
          var BS_Data = Child_BS.GetProperty("OutputRecordSet");
          if (BS_Data != "}")
          {
            var ResArray = new Array;
            ResArray = BS_Data.split(";");

            jsonRes = JSON.parse(ResArray[0]);
            eventid = jsonRes["Id"];
            SiebelJS.Log("jsonSK" + jsonRes["Id"]);
          }
          if (eventid != "")
          {
            var Custom_Service = "",
              Input_BS = "",
              Out_BS = "";
            Custom_Service = SiebelApp.S_App.GetService("SC Custom Query");
            Input_BS = SiebelApp.S_App.NewPropertySet();
            Out_BS = SiebelApp.S_App.NewPropertySet();
            searchfields = "Mobile POS Registers";
            Input_BS.SetProperty("BO", "Internal Division");
            Input_BS.SetProperty("BC", "SC Mobile POS Registers");
            Input_BS.SetProperty("SearchSpecification", "[Account ID] = '" + eventid + "'");
            Input_BS.SetProperty("SortSpecification", "");
            Input_BS.SetProperty("ReqNoOfRecords", "");
            Input_BS.SetProperty("FieldsArray", searchfields);
            Out_BS = Custom_Service.InvokeMethod("Query", Input_BS);
            var Child_BS = Out_BS.GetChild(0);
            var BS_Data = Child_BS.GetProperty("OutputRecordSet");
            if (BS_Data != "}")
            {
              var ResArray = new Array;
              ResArray = BS_Data.split(";");
              for (var i = 0; i < ResArray.length; i++)
              {
                jsonRes = JSON.parse(ResArray[i]);
                SiebelJS.Log(jsonRes["Mobile POS Registers"]);
                POSRegArray[i] = jsonRes["Mobile POS Registers"];
              }

            }
          }
        }

        SCiPadOrderShipToItemListAppletPR.prototype.EndLife = function ()
        {
          SiebelAppFacade.SCiPadOrderShipToItemListAppletPR.superclass.EndLife.apply(this, arguments);
          localStorage.setItem("ComingFromPayments", "");
          SiebelJS.Log("Shipping - EndLife");
          $(document).unbind();
          $(document).unbind("keyup");
        } //End of EndLife

        return SCiPadOrderShipToItemListAppletPR;
      }());
      return "SiebelAppFacade.SCiPadOrderShipToItemListAppletPR";
    })
}